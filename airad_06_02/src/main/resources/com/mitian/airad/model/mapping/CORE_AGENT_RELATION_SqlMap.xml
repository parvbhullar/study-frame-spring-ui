<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="CORE_AGENT_RELATION">
    <resultMap class="com.mitian.airad.model.CoreAgentRelation" id="ibatorgenerated_BaseResultMap">
        <!--
            WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify. This element was
            generated on Thu Jan 20 16:39:10 CST 2011.
        -->
        <result column="RELATION_ID" jdbcType="INTEGER" property="relationId" />
        <result column="MEMBER_ID" jdbcType="LONG" property="memberId" />
        <result column="ADVERTISER_NUM" jdbcType="INTEGER" property="advertiserNum" />
        <result column="ADD_TIME" jdbcType="TIMESTAMP" property="addTime" />
        <result column="ADD_OPER" jdbcType="VARCHAR" property="addOper" />
        <result column="UPD_TIME" jdbcType="TIMESTAMP" property="updTime" />
        <result column="DEL_OPER" jdbcType="VARCHAR" property="delOper" />
        <result column="DEL_TIME" jdbcType="TIMESTAMP" property="delTime" />
        <result column="DEL_FLAG" jdbcType="CHAR" property="delFlag" />
        <result column="RELATION_STATUS" jdbcType="CHAR" property="relationStatus" />
    </resultMap>
    <resultMap id="ibatorgenerated_BaseResultMap_ext_advertiser" class="com.mitian.airad.model.CoreAgentRelation"
        extends="ibatorgenerated_BaseResultMap">
        <result column="EMAIL" jdbcType="VARCHAR" property="email" />
    </resultMap>
    <resultMap id="ibatorgenerated_selectAdvertiser" class="com.mitian.airad.model.CoreMemberInfo">
        <result column="MEMBER_ID" jdbcType="LONG" property="memberId" />
        <result column="EMAIL" property="email" jdbcType="VARCHAR"/>
        <result column="ACTIVE_TIME" property="activeTime" jdbcType="TIMESTAMP"/>
        <result column="OFFER" property="offer" jdbcType="DECIMAL"/>
        <result column="SHOW_NUM" property="showNum" jdbcType="DECIMAL"/>
        <result column="CLICK_NUM" property="clickNum" jdbcType="DECIMAL"/>
        <result column="RELATION_ID" property="relationId" jdbcType="INTEGER"/>
    </resultMap>

     <!-- 根据时间段统计代理商下面所有的广告商 -->
    <select id="ibatorgenerated_selectAdvertiserByTimeSlot" resultMap="ibatorgenerated_selectAdvertiser" parameterClass="java.util.HashMap">
          select a.MEMBER_ID MEMBER_ID,a.ADD_TIME ACTIVE_TIME,a.RELATION_ID RELATION_ID,a.EMAIL,IFNULL(b.OFFER,0) OFFER,IFNULL(b.SHOW_NUM,0)SHOW_NUM,IFNULL(b.CLICK_NUM,0)CLICK_NUM from 
        (select c.MEMBER_ID,c.ADD_TIME,c.RELATION_ID,c.ADVERTISER_NUM,d.EMAIL from CORE_AGENT_RELATION c
        left join CORE_MEMBER_INFO d on d.MEMBER_ID=c.ADVERTISER_NUM where c.MEMBER_ID=#memberId# and (c.DEL_FLAG  is null OR c.DEL_FLAG !='1'))
        a left join 
        (select AGENT_ID,SUM(OFFER) OFFER,SUM(SHOW_NUM) SHOW_NUM,SUM(CLICK_NUM) CLICK_NUM,ADD_TIME from STAT_AGENT where AGENT_ID=#memberId# 
         <isNotNull prepend="and" property="startTime">
        <![CDATA[
             ADD_TIME>=#startTime#
        ]]>
        </isNotNull>
        <isNotNull prepend="and" property="endTime">
        <![CDATA[
             ADD_TIME <= #endTime#
        ]]>
        </isNotNull>
        group by ADVERTISER_ID)b
        on a.MEMBER_ID=b.AGENT_ID where a.MEMBER_ID=#memberId# 
        <dynamic prepend="order by">
          OFFER
        </dynamic>
         <isNotEmpty property="fromRecord">
         limit $fromRecord$,$pageSize$
        </isNotEmpty>
    </select>

    <!-- 根据代理商id查询代理商下面所有的广告商 -->
    <select id="ibatorgenerated_selectAdvertiser" resultMap="ibatorgenerated_selectAdvertiser" parameterClass="java.util.HashMap">
          select a.MEMBER_ID MEMBER_ID,a.ADD_TIME ACTIVE_TIME,a.RELATION_ID RELATION_ID,a.EMAIL,IFNULL(b.OFFER,0) OFFER,IFNULL(b.SHOW_NUM,0)SHOW_NUM,IFNULL(b.CLICK_NUM,0)CLICK_NUM from 
        (select c.MEMBER_ID,c.ADD_TIME,c.RELATION_ID,c.ADVERTISER_NUM,d.EMAIL from CORE_AGENT_RELATION c
        left join CORE_MEMBER_INFO d on d.MEMBER_ID=c.ADVERTISER_NUM where c.MEMBER_ID=#memberId# and (c.DEL_FLAG  is null OR c.DEL_FLAG !='1'))
        a left join 
        (select AGENT_ID,SUM(OFFER) OFFER,SUM(SHOW_NUM) SHOW_NUM,SUM(CLICK_NUM) CLICK_NUM from STAT_AGENT where AGENT_ID=#memberId# group by ADVERTISER_ID)b
        on a.MEMBER_ID=b.AGENT_ID where a.MEMBER_ID=#memberId#
        <isNotEmpty prepend="AND" property="email">
          a.EMAIL like '%$email$%'
        </isNotEmpty>
        <dynamic prepend="order by">
        <isNotEmpty property="descFlag">
           ACTIVE_TIME DESC
        </isNotEmpty>
        <isEmpty property="descFlag">
           ACTIVE_TIME ASC
        </isEmpty>
        </dynamic>
         <isNotEmpty property="fromRecord">
          limit $fromRecord$,$pageSize$
        </isNotEmpty>
    </select>
    <!-- 根据代理商id查询代理商下面所有的广告商 -->
    <select id="ibatorgenerated_selectAllAdvertiser" resultMap="ibatorgenerated_BaseResultMap_ext_advertiser"
        parameterClass="java.util.HashMap"> select a.RELATION_ID, a.MEMBER_ID, a.ADVERTISER_NUM, a.ADD_TIME, a.ADD_OPER,
        a.UPD_TIME, a.DEL_OPER, a.DEL_TIME, a.DEL_FLAG, a.RELATION_STATUS,c.EMAIL from CORE_MEMBER_INFO c ,
        CORE_AGENT_RELATION a left join CORE_MEMBER_INFO b on a.MEMBER_ID =b.MEMBER_ID where
        c.MEMBER_ID=a.ADVERTISER_NUM and a.MEMBER_ID =#memberId#
        <isNotEmpty prepend="AND" property="email"> b.EMAIL like '%$email$%'</isNotEmpty>
    </select>
    <select id="ibatorgenerated_selectByPrimaryKey" parameterClass="com.mitian.airad.model.CoreAgentRelation"
        resultMap="ibatorgenerated_BaseResultMap"> select RELATION_ID, MEMBER_ID, ADVERTISER_NUM, ADD_TIME, ADD_OPER, UPD_TIME, DEL_OPER, DEL_TIME,
        DEL_FLAG, RELATION_STATUS from CORE_AGENT_RELATION where RELATION_ID = #relationId:INTEGER#</select>
    <delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="com.mitian.airad.model.CoreAgentRelation">
        <!--
            WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify. This element was
            generated on Thu Jan 20 16:39:10 CST 2011.
        -->
        delete from CORE_AGENT_RELATION where RELATION_ID = #relationId:INTEGER#
    </delete>
    <insert id="ibatorgenerated_insert" parameterClass="com.mitian.airad.model.CoreAgentRelation">
        <!--
            WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify. This element was
            generated on Thu Jan 20 16:39:10 CST 2011.
        -->
        insert into CORE_AGENT_RELATION (RELATION_ID, MEMBER_ID, ADVERTISER_NUM, ADD_TIME, ADD_OPER, UPD_TIME, DEL_OPER,
        DEL_TIME, DEL_FLAG, RELATION_STATUS) values (#relationId:INTEGER#, #memberId:LONG#, #advertiserNum:INTEGER#,
        #addTime:TIMESTAMP#, #addOper:VARCHAR#, #updTime:TIMESTAMP#, #delOper:VARCHAR#, #delTime:TIMESTAMP#,
        #delFlag:CHAR#, #relationStatus:CHAR#)
    </insert>
    <insert id="ibatorgenerated_insertSelective" parameterClass="com.mitian.airad.model.CoreAgentRelation">
        <!--
            WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify. This element was
            generated on Thu Jan 20 16:39:10 CST 2011.
        -->
        insert into CORE_AGENT_RELATION
        <dynamic prepend="(">
            <isNotNull prepend="," property="relationId"> RELATION_ID</isNotNull>
            <isNotNull prepend="," property="memberId"> MEMBER_ID</isNotNull>
            <isNotNull prepend="," property="advertiserNum"> ADVERTISER_NUM</isNotNull>
            <isNotNull prepend="," property="addTime"> ADD_TIME</isNotNull>
            <isNotNull prepend="," property="addOper"> ADD_OPER</isNotNull>
            <isNotNull prepend="," property="updTime"> UPD_TIME</isNotNull>
            <isNotNull prepend="," property="delOper"> DEL_OPER</isNotNull>
            <isNotNull prepend="," property="delTime"> DEL_TIME</isNotNull>
            <isNotNull prepend="," property="delFlag"> DEL_FLAG</isNotNull>
            <isNotNull prepend="," property="relationStatus"> RELATION_STATUS</isNotNull>
            )
        </dynamic>
        values
        <dynamic prepend="(">
            <isNotNull prepend="," property="relationId"> #relationId:INTEGER#</isNotNull>
            <isNotNull prepend="," property="memberId"> #memberId:LONG#</isNotNull>
            <isNotNull prepend="," property="advertiserNum"> #advertiserNum:INTEGER#</isNotNull>
            <isNotNull prepend="," property="addTime"> #addTime:TIMESTAMP#</isNotNull>
            <isNotNull prepend="," property="addOper"> #addOper:VARCHAR#</isNotNull>
            <isNotNull prepend="," property="updTime"> #updTime:TIMESTAMP#</isNotNull>
            <isNotNull prepend="," property="delOper"> #delOper:VARCHAR#</isNotNull>
            <isNotNull prepend="," property="delTime"> #delTime:TIMESTAMP#</isNotNull>
            <isNotNull prepend="," property="delFlag"> #delFlag:CHAR#</isNotNull>
            <isNotNull prepend="," property="relationStatus"> #relationStatus:CHAR#</isNotNull>
            )
        </dynamic>
    </insert>
    <update id="ibatorgenerated_updateByPrimaryKeySelective" parameterClass="com.mitian.airad.model.CoreAgentRelation">
        <!--
            WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify. This element was
            generated on Thu Jan 20 16:39:10 CST 2011.
        -->
        update CORE_AGENT_RELATION
        <dynamic prepend="set">
            <isNotNull prepend="," property="memberId"> MEMBER_ID = #memberId:LONG#</isNotNull>
            <isNotNull prepend="," property="advertiserNum"> ADVERTISER_NUM = #advertiserNum:INTEGER#</isNotNull>
            <isNotNull prepend="," property="addTime"> ADD_TIME = #addTime:TIMESTAMP#</isNotNull>
            <isNotNull prepend="," property="addOper"> ADD_OPER = #addOper:VARCHAR#</isNotNull>
            <isNotNull prepend="," property="updTime"> UPD_TIME = #updTime:TIMESTAMP#</isNotNull>
            <isNotNull prepend="," property="delOper"> DEL_OPER = #delOper:VARCHAR#</isNotNull>
            <isNotNull prepend="," property="delTime"> DEL_TIME = #delTime:TIMESTAMP#</isNotNull>
            <isNotNull prepend="," property="delFlag"> DEL_FLAG = #delFlag:CHAR#</isNotNull>
            <isNotNull prepend="," property="relationStatus"> RELATION_STATUS = #relationStatus:CHAR#</isNotNull>
        </dynamic>
        where RELATION_ID = #relationId:INTEGER#
    </update>
    <update id="ibatorgenerated_updateByPrimaryKey" parameterClass="com.mitian.airad.model.CoreAgentRelation">
        <!--
            WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify. This element was
            generated on Thu Jan 20 16:39:10 CST 2011.
        -->
        update CORE_AGENT_RELATION set MEMBER_ID = #memberId:LONG#, ADVERTISER_NUM = #advertiserNum:INTEGER#,
        ADD_TIME = #addTime:TIMESTAMP#, ADD_OPER = #addOper:VARCHAR#, UPD_TIME = #updTime:TIMESTAMP#, DEL_OPER =
        #delOper:VARCHAR#, DEL_TIME = #delTime:TIMESTAMP#, DEL_FLAG = #delFlag:CHAR#, RELATION_STATUS =
        #relationStatus:CHAR# where RELATION_ID = #relationId:INTEGER#
    </update>
</sqlMap>