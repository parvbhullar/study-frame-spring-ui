<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="CORE_CAMPAIGN" >
  <resultMap id="ibatorgenerated_BaseResultMap" class="com.mitian.airad.model.CoreCampaign" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Jan 25 17:53:17 CST 2011.
    -->
    <result column="CAMPAIGN_ID" property="campaignId" jdbcType="INTEGER" />
    <result column="MEMBER_ID" property="memberId" jdbcType="LONG" />
    <result column="CAMPAIGN_NAME" property="campaignName" jdbcType="VARCHAR" />
    <result column="START_TIME" property="startTime" jdbcType="TIMESTAMP" />
    <result column="END_TIME" property="endTime" jdbcType="TIMESTAMP" />
    <result column="BUGGET_DAY" property="buggetDay" jdbcType="DECIMAL" />
    <result column="PUB_KIND" property="pubKind" jdbcType="CHAR" />
    <result column="CAMPAIGN_STATE" property="campaignState" jdbcType="VARCHAR" />
    <result column="SUSPEND_TYPE" property="suspendType" jdbcType="CHAR" />
    <result column="BLOCKING" property="blocking" jdbcType="CHAR" />
    <result column="ADD_OPER" property="addOper" jdbcType="VARCHAR" />
    <result column="ADD_TIME" property="addTime" jdbcType="TIMESTAMP" />
    <result column="UPD_OPER" property="updOper" jdbcType="VARCHAR" />
    <result column="UPD_TIME" property="updTime" jdbcType="TIMESTAMP" />
    <result column="DEL_OPER" property="delOper" jdbcType="VARCHAR" />
    <result column="DEL_TIME" property="delTime" jdbcType="TIMESTAMP" />
    <result column="DEL_FLAG" property="delFlag" jdbcType="CHAR" />
  </resultMap>
   <resultMap id="ibatorgenerated_BaseResultMap_campaignDetial" class="com.mitian.airad.model.CoreCampaign">
    <result column="SUSPEND_TYPE" property="suspendType" jdbcType="CHAR" />
    <result column="BUGGET_DAY" property="buggetDay" jdbcType="DECIMAL" />
    <result column="CAMPAIGN_ID" property="campaignId" jdbcType="INTEGER" />
    <result column="MEMBER_ID" property="memberId" jdbcType="LONG" />
    <result column="CAMPAIGN_NAME" property="campaignName" jdbcType="VARCHAR" />
    <result column="START_TIME" property="startTime" jdbcType="TIMESTAMP" />
    <result column="CNT" property="count" jdbcType="INTEGER" />
    <result column="CLICK_NUM" property="clickNum" jdbcType="INTEGER" />
    <result column="SHOW_NUM" property="showNum" jdbcType="INTEGER" />
    <result column="OFFER" property="avgAdOffer" jdbcType="DECIMAL" />
    <result column="SUM_OFFER" property="sumAdOffer" jdbcType="DECIMAL" />
    <result column="CLICK_RATE" property="clickRate" jdbcType="INTEGER" />
  </resultMap>
  <select id="ibatorgenerated_selectByPrimaryKey" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.mitian.airad.model.CoreCampaign" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Jan 25 17:53:17 CST 2011.
    -->
    select CAMPAIGN_ID, MEMBER_ID, CAMPAIGN_NAME, START_TIME, END_TIME, BUGGET_DAY, PUB_KIND,
      CAMPAIGN_STATE, SUSPEND_TYPE, BLOCKING, ADD_OPER, ADD_TIME, UPD_OPER, UPD_TIME, DEL_OPER,
      DEL_TIME, DEL_FLAG
    from CORE_CAMPAIGN
    where CAMPAIGN_ID = #campaignId:INTEGER# and MEMBER_ID=#memberId:LONG# 
  </select>
  <delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="com.mitian.airad.model.CoreCampaign" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Jan 25 17:53:17 CST 2011.
    -->
    delete from CORE_CAMPAIGN
    where CAMPAIGN_ID = #campaignId:INTEGER# and MEMBER_ID=#memberId:LONG#
  </delete>
  <insert id="ibatorgenerated_insert" parameterClass="com.mitian.airad.model.CoreCampaign" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Jan 25 17:53:17 CST 2011.
    -->
      
    insert into CORE_CAMPAIGN (CAMPAIGN_ID, MEMBER_ID, CAMPAIGN_NAME, START_TIME, END_TIME,
      BUGGET_DAY, PUB_KIND, CAMPAIGN_STATE, SUSPEND_TYPE, BLOCKING, ADD_OPER, ADD_TIME, UPD_OPER,
      UPD_TIME, DEL_OPER, DEL_TIME, DEL_FLAG)
    values (#campaignId:INTEGER#, #memberId:LONG#, #campaignName:VARCHAR#, #startTime:TIMESTAMP#,
      #endTime:TIMESTAMP#, #buggetDay:DECIMAL#, #pubKind:CHAR#, #campaignState:VARCHAR#,
      #suspendType:CHAR#, #blocking:CHAR#, #addOper:VARCHAR#, #addTime:TIMESTAMP#,
      #updOper:VARCHAR#, #updTime:TIMESTAMP#, #delOper:VARCHAR#, #delTime:TIMESTAMP#,
      #delFlag:CHAR#)
  </insert>
  <insert id="ibatorgenerated_insertSelective" parameterClass="com.mitian.airad.model.CoreCampaign" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Jan 25 17:53:17 CST 2011.
    -->
    insert into CORE_CAMPAIGN
    <dynamic prepend="(" >
      <isNotNull prepend="," property="memberId" >
        MEMBER_ID
      </isNotNull>
      <isNotNull prepend="," property="campaignName" >
        CAMPAIGN_NAME
      </isNotNull>
      <isNotNull prepend="," property="startTime" >
        START_TIME
      </isNotNull>
      <isNotNull prepend="," property="endTime" >
        END_TIME
      </isNotNull>
      <isNotNull prepend="," property="buggetDay" >
        BUGGET_DAY
      </isNotNull>
      <isNotNull prepend="," property="pubKind" >
        PUB_KIND
      </isNotNull>
      <isNotNull prepend="," property="campaignState" >
        CAMPAIGN_STATE
      </isNotNull>
      <isNotNull prepend="," property="suspendType" >
        SUSPEND_TYPE
      </isNotNull>
      <isNotNull prepend="," property="blocking" >
        BLOCKING
      </isNotNull>
      <isNotNull prepend="," property="addOper" >
        ADD_OPER
      </isNotNull>
      <isNotNull prepend="," property="addTime" >
        ADD_TIME
      </isNotNull>
      <isNotNull prepend="," property="updOper" >
        UPD_OPER
      </isNotNull>
      <isNotNull prepend="," property="updTime" >
        UPD_TIME
      </isNotNull>
      <isNotNull prepend="," property="delOper" >
        DEL_OPER
      </isNotNull>
      <isNotNull prepend="," property="delTime" >
        DEL_TIME
      </isNotNull>
      <isNotNull prepend="," property="delFlag" >
        DEL_FLAG
      </isNotNull>
      <isNotNull prepend="," property="endTimeFlag" >
        END_TIME
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(" >
      <isNotNull prepend="," property="memberId" >
        #memberId:LONG#
      </isNotNull>
      <isNotNull prepend="," property="campaignName" >
        #campaignName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="startTime" >
        #startTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="endTime" >
        #endTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="buggetDay" >
        #buggetDay:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="pubKind" >
        #pubKind:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="campaignState" >
        #campaignState:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="suspendType" >
        #suspendType:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="blocking" >
        #blocking:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="addOper" >
        #addOper:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="addTime" >
        #addTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="updOper" >
        #updOper:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="updTime" >
        #updTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="delOper" >
        #delOper:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="delTime" >
        #delTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="delFlag" >
        #delFlag:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="endTimeFlag" >
         #endTime:TIMESTAMP#
      </isNotNull>
      )
    </dynamic>
     <selectKey resultClass="int" keyProperty="campaignId" type="post" >
               SELECT @@IDENTITY AS ID
           </selectKey> 
<!--    <selectKey resultClass="Long" type="post" keyProperty="id" >  -->
<!--        select LAST_INSERT_ID()-->
<!--    </selectKey>  -->
     <!-- selectKey resultClass="int" keyProperty="id" type="post" >
            SELECT @@IDENTITY AS ID
       </selectKey --> 
  </insert>
  <update id="ibatorgenerated_updateByPrimaryKeySelective" parameterClass="com.mitian.airad.model.CoreCampaign" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Jan 25 17:53:17 CST 2011.
    -->
    update CORE_CAMPAIGN
    <dynamic prepend="set" >
      <isNotNull prepend="," property="campaignName" >
        CAMPAIGN_NAME = #campaignName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="startTime" >
        START_TIME = #startTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="endTime" >
        END_TIME = #endTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="buggetDay" >
        BUGGET_DAY = #buggetDay:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="pubKind" >
        PUB_KIND = #pubKind:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="campaignState" >
        CAMPAIGN_STATE = #campaignState:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="suspendType" >
        SUSPEND_TYPE = #suspendType:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="blocking" >
        BLOCKING = #blocking:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="addOper" >
        ADD_OPER = #addOper:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="addTime" >
        ADD_TIME = #addTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="updOper" >
        UPD_OPER = #updOper:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="updTime" >
        UPD_TIME = #updTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="delOper" >
        DEL_OPER = #delOper:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="delTime" >
        DEL_TIME = #delTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="delFlag" >
        DEL_FLAG = #delFlag:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="endTimeFlag" >
        END_TIME= #endTime:TIMESTAMP#
      </isNotNull>
    </dynamic>
    where CAMPAIGN_ID = #campaignId:INTEGER# AND  MEMBER_ID = #memberId:LONG# and (DEL_FLAG  is null OR DEL_FLAG !='1')
  </update>
  <update id="ibatorgenerated_updateByPrimaryKey" parameterClass="com.mitian.airad.model.CoreCampaign" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Jan 25 17:53:17 CST 2011.
    -->
    update CORE_CAMPAIGN
    set MEMBER_ID = #memberId:LONG#,
      CAMPAIGN_NAME = #campaignName:VARCHAR#,
      START_TIME = #startTime:TIMESTAMP#,
      END_TIME = #endTime:TIMESTAMP#,
      BUGGET_DAY = #buggetDay:DECIMAL#,
      PUB_KIND = #pubKind:CHAR#,
      CAMPAIGN_STATE = #campaignState:VARCHAR#,
      SUSPEND_TYPE = #suspendType:CHAR#,
      BLOCKING = #blocking:CHAR#,
      ADD_OPER = #addOper:VARCHAR#,
      ADD_TIME = #addTime:TIMESTAMP#,
      UPD_OPER = #updOper:VARCHAR#,
      UPD_TIME = #updTime:TIMESTAMP#,
      DEL_OPER = #delOper:VARCHAR#,
      DEL_TIME = #delTime:TIMESTAMP#,
      DEL_FLAG = #delFlag:CHAR#
    where CAMPAIGN_ID = #campaignId:INTEGER#  AND  MEMBER_ID = #memberId:LONG# and (DEL_FLAG  is null OR DEL_FLAG !='1')
  </update>
  <!-- 查询时间段所有统计分页（条数） -->
  <select id="findCount" resultClass="java.lang.Integer" parameterClass="java.util.HashMap">
      select count(*) from CORE_CAMPAIGN where DEL_FLAG!=1 AND MEMBER_ID=#memberId#
       <isNotNull prepend="and" property="campaignName">
           CAMPAIGN_NAME like '%$campaignName$%' 
           <isNotNull property="escape">
           $escape$
           </isNotNull>
       </isNotNull>
 </select>
  <!-- 查询时间段所有统计分页 -->
  <select id="selectStatisticByTimeSlot" resultMap="ibatorgenerated_BaseResultMap_campaignDetial" parameterClass="java.util.HashMap">
          SELECT 
         T.SUSPEND_TYPE SUSPEND_TYPE,
         T.CAMPAIGN_ID CAMPAIGN_ID,
         T.MEMBER_ID MEMBER_ID,
         T.CAMPAIGN_NAME CAMPAIGN_NAME,
         T.START_TIME START_TIME,
         IFNULL(T.BUGGET_DAY,0) BUGGET_DAY,
         IFNULL(T.CNT,0) CNT,
         IFNULL(SUM(A.SHOW_NUM),0) SHOW_NUM,
         CASE WHEN IFNULL(SUM(A.CLICK_NUM),0)>0 
         THEN SUM(A.CLICK_MONEY)/SUM(A.CLICK_NUM)
         ELSE 0 END OFFER
         ,IFNULL(SUM(A.CLICK_NUM),0) CLICK_NUM,
         IFNULL(SUM(A.CLICK_MONEY)+SUM(A. SHOW_MONEY),0) SUM_OFFER,
         CASE WHEN IFNULL(SUM(A.SHOW_NUM),0)>0 
         THEN SUM(A.CLICK_NUM)/SUM(A.SHOW_NUM)
         ELSE 0 END CLICK_RATE
        FROM (
            SELECT A.CAMPAIGN_ID CAMPAIGN_ID
            ,A.CAMPAIGN_NAME CAMPAIGN_NAME
            ,A.ADD_TIME ADD_TIME
            ,COUNT(B.AD_ID) CNT
            ,A.BUGGET_DAY BUGGET_DAY
            ,A.SUSPEND_TYPE SUSPEND_TYPE
            ,A.MEMBER_ID MEMBER_ID
            ,A.START_TIME START_TIME,A.DEL_FLAG DEL_FLAG
            FROM CORE_CAMPAIGN A
            LEFT JOIN CORE_AD B ON A.CAMPAIGN_ID = B.CAMPAIGN_ID AND B.DEL_FLAG!=1 GROUP BY A.CAMPAIGN_ID
        ) T
        LEFT JOIN STAT_AD A ON A.CAMPAIGN_ID = T.CAMPAIGN_ID 
        <isNotNull prepend="and" property="startTime">
        <![CDATA[
             A.ADD_TIME>=#startTime#
        ]]>
        </isNotNull>
        <isNotNull prepend="and" property="endTime">
        <![CDATA[
             A.ADD_TIME <= #endTime#
        ]]>
        </isNotNull>
        WHERE (T.DEL_FLAG  is null OR T.DEL_FLAG !='1')
        <dynamic>
        <isNotNull prepend="and" property="memberId">
           T.MEMBER_ID=#memberId#
        </isNotNull>
        <isNotEmpty prepend="and" property="campaignName">
           T.CAMPAIGN_NAME like '%$campaignName$%'
     </isNotEmpty>
         </dynamic>
         GROUP BY T.CAMPAIGN_ID
         <dynamic prepend=" order by "> 
            <isNotEmpty property="descFlag">
               T.START_TIME DESC
            </isNotEmpty>
            <isEmpty property="descFlag">
               T.START_TIME ASC
            </isEmpty>
        </dynamic>  
        <isNotEmpty property="fromRecord">
        limit $fromRecord$,$pageSize$
        </isNotEmpty>
      </select>
  
  <!-- 查询所有分页 -->
  <select id="selectAll" resultMap="ibatorgenerated_BaseResultMap_campaignDetial" parameterClass="java.util.HashMap">
         SELECT 
         T.SUSPEND_TYPE SUSPEND_TYPE,
         T.CAMPAIGN_ID CAMPAIGN_ID,
         T.MEMBER_ID MEMBER_ID,
         T.CAMPAIGN_NAME CAMPAIGN_NAME,
         T.START_TIME START_TIME,
         IFNULL(T.BUGGET_DAY,0) BUGGET_DAY,
         IFNULL(T.CNT,0) CNT,
         IFNULL(SUM(A.SHOW_NUM),0) SHOW_NUM,
         CASE WHEN IFNULL(SUM(A.CLICK_NUM),0)>0 
         THEN SUM(A.CLICK_MONEY)/SUM(A.CLICK_NUM)
         ELSE 0 END OFFER
         ,IFNULL(SUM(A.CLICK_NUM),0) CLICK_NUM,
         IFNULL(SUM(A.CLICK_MONEY)+SUM(A. SHOW_MONEY),0) SUM_OFFER,
         CASE WHEN IFNULL(SUM(A.SHOW_NUM),0)>0 
         THEN SUM(A.CLICK_NUM)/SUM(A.SHOW_NUM)
         ELSE 0 END CLICK_RATE
        FROM (
            SELECT A.CAMPAIGN_ID CAMPAIGN_ID
            ,A.CAMPAIGN_NAME CAMPAIGN_NAME
            ,A.ADD_TIME ADD_TIME
            ,COUNT(B.AD_ID) CNT
            ,A.BUGGET_DAY BUGGET_DAY
            ,A.SUSPEND_TYPE SUSPEND_TYPE
            ,A.MEMBER_ID MEMBER_ID
            ,A.START_TIME START_TIME,A.DEL_FLAG DEL_FLAG
            FROM CORE_CAMPAIGN A
            LEFT JOIN  CORE_AD B        
            ON A.MEMBER_ID=B.MEMBER_ID and A.CAMPAIGN_ID = B.CAMPAIGN_ID AND (B.DEL_FLAG  is null OR B.DEL_FLAG !='1') GROUP BY A.CAMPAIGN_ID
        ) T
        LEFT JOIN STAT_AD A ON A.CAMPAIGN_ID = T.CAMPAIGN_ID 
        where T.DEL_FLAG!=1 AND   T.MEMBER_ID=#memberId#
        <isNotEmpty prepend="and" property="campaignName">
           T.CAMPAIGN_NAME like '%$campaignName$%' 
            <isNotNull property="escape">
           $escape$
           </isNotNull>
        </isNotEmpty>
     GROUP BY T.CAMPAIGN_ID
     <dynamic prepend=" order by "> 
        <isNotEmpty property="descFlag">
           T.START_TIME DESC
        </isNotEmpty>
        <isEmpty property="descFlag">
           T.START_TIME ASC
        </isEmpty>
    </dynamic>  
    <isNotEmpty property="fromRecord">
    limit $fromRecord$,$pageSize$
    </isNotEmpty>
 </select>
 
 <select id="findByNameList" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.mitian.airad.model.CoreCampaign">
      select CAMPAIGN_ID, MEMBER_ID, CAMPAIGN_NAME, START_TIME, END_TIME, BUGGET_DAY, PUB_KIND,
      CAMPAIGN_STATE, SUSPEND_TYPE, BLOCKING, ADD_OPER, ADD_TIME, UPD_OPER, UPD_TIME,
      DEL_OPER, DEL_TIME, DEL_FLAG
      from CORE_CAMPAIGN  where   MEMBER_ID=#memberId#
      <dynamic>
        <isNotNull prepend="and" property="campaignName">
           CAMPAIGN_NAME like '%$campaignName$%' 
        </isNotNull>
     </dynamic>
 </select>
 
  <!-- 根据条件查询 -->
  <select id="querybycondition" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.mitian.airad.model.CoreCampaign">
      select CAMPAIGN_ID, MEMBER_ID, CAMPAIGN_NAME, START_TIME, END_TIME, BUGGET_DAY, PUB_KIND,
      CAMPAIGN_STATE, SUSPEND_TYPE, BLOCKING, ADD_OPER, ADD_TIME, UPD_OPER, UPD_TIME,
      DEL_OPER, DEL_TIME, DEL_FLAG
      from CORE_CAMPAIGN where (DEL_FLAG  is null OR DEL_FLAG !='1') AND MEMBER_ID=#memberId:LONG#
     <dynamic>
        <isNotNull prepend="and" property="campaignName">
           CAMPAIGN_NAME like '%$campaignName$%' 
        </isNotNull>
         <isNotNull prepend="and" property="startTime">
        <![CDATA[
             START_TIME<=#startTime#
        ]]>
        </isNotNull>
        <isNotNull prepend="and" property="endTime">
        <![CDATA[
             END_TIME >= #endTime#
        ]]>
        </isNotNull>
     </dynamic>
     <dynamic prepend=" order by "> 
        <isNotNull property="addTime"> 
        $addTime$  
        </isNotNull> 
     </dynamic>  
  </select>
  <!-- 后台 -->
  <!--活动列表  -->
    <select id="queryCampaignList" resultClass="com.mitian.airad.model.CoreCampaign" parameterClass="java.util.HashMap">
        SELECT IFNULL(C.CAMPAIGN_ID,'') campaignId,IFNULL(C.CAMPAIGN_NAME,'') campaignName,IFNULL(C.START_TIME,'') startTime
        ,IFNULL(C.END_TIME,null) endTime,IFNULL(T.SHOWNUM,0) showNum,IFNULL(T.CLICKNUM,0) clickNum,
        IFNULL(T.CLICKRATE,0) clickRate,COUNT(IFNULL(B.AD_GROUP_ID,0)) count,IFNULL(C.BUGGET_DAY,0) buggetDay
        ,SUM(IFNULL(A.AVGOFFER,0)) avgAdOffer,SUM(IFNULL(A.SUMOFFER,0)) sumadoffer,SUM(IFNULL(A.CHECKADNUM,0)) checkAdNum,
        SUM(IFNULL(A.ADNUM,0)) adNum,SUM(IFNULL(A.NOCHECKADNUM,0)) noCheckAdNum
        FROM CORE_CAMPAIGN C
        LEFT JOIN  CORE_AD_GROUP B ON C.CAMPAIGN_ID = B.CAMPAIGN_ID
        LEFT JOIN ( 
        SELECT AVG(T.AD_OFFER) AVGOFFER,SUM(T.AD_OFFER) SUMOFFER,T.AD_GROUP_ID,
        SUM(T.CHECKADNUM) CHECKADNUM,SUM(T.ADNUM) ADNUM,SUM(T.NOCHECKADNUM) NOCHECKADNUM
        FROM
        (SELECT AD_OFFER,AD_GROUP_ID,
        CASE WHEN FLAG='1' THEN COUNT(FLAG) ELSE 0 END CHECKADNUM,
        CASE WHEN FLAG='4' THEN COUNT(FLAG) ELSE 0 END ADNUM,
        CASE WHEN FLAG='3' THEN COUNT(FLAG) ELSE 0 END NOCHECKADNUM
        FROM CORE_AD GROUP BY AD_ID ) T
        GROUP BY AD_GROUP_ID
        ) A ON A.AD_GROUP_ID= B.AD_GROUP_ID
        LEFT JOIN 
        (
        SELECT SUM(A.SHOW_NUM) SHOWNUM,SUM(A.CLICK_NUM) CLICKNUM,
        CASE WHEN IFNULL(SUM(A.CLICK_NUM),0)>0 
        THEN SUM(A.CLICK_NUM)/SUM(A.SHOW_NUM)
        ELSE 0 END CLICKRATE,A.CAMPAIGN_NAME,A.CAMPAIGN_ID
        from STAT_AD A GROUP BY A.CAMPAIGN_ID
        )T ON T.CAMPAIGN_ID= C.CAMPAIGN_ID and (C.DEL_FLAG  is null OR C.DEL_FLAG !='1') 
     <dynamic>
        <isNotNull prepend="and" property="campaignName">
           C.CAMPAIGN_NAME like '%$campaignName$%' 
            <isNotNull property="escape">
           $escape$
           </isNotNull>
        </isNotNull>
         <isNotNull prepend="and" property="startTime">
        <![CDATA[
             C.START_TIME<=#startTime#
        ]]>
        </isNotNull>
        <isNotNull prepend="and" property="endTime">
        <![CDATA[
             C.END_TIME >= #endTime#
        ]]>
        </isNotNull>
     </dynamic>
     GROUP BY C.CAMPAIGN_ID 
    <dynamic prepend=" order by "> 
        <isNotEmpty property="descFlag">
            <isNotEmpty property="addTime">
             C.ADD_TIME
            </isNotEmpty>
            <isNotEmpty property="avgAdOffer">
             avgAdOffer
            </isNotEmpty>
             <isNotEmpty property="showNum">
             showNum
            </isNotEmpty>
            <isNotEmpty property="clickNum">
             clickNum
            </isNotEmpty>
              <isNotEmpty property="clickRate">
             clickRate
            </isNotEmpty>
            DESC
        </isNotEmpty>
        <isNotEmpty property="asceFlag">
            <isNotEmpty property="addTime">
              C.ADD_TIME
            </isNotEmpty>
            <isNotEmpty property="avgAdOffer">
             A.AVGOFFER
            </isNotEmpty>
             <isNotEmpty property="showNum">
             showNum
            </isNotEmpty>
            <isNotEmpty property="clickNum">
             clickNum
            </isNotEmpty>
              <isNotEmpty property="clickRate">
             clickRate
            </isNotEmpty>
           ASC
        </isNotEmpty>
    </dynamic> 
    <dynamic>
       <isNotEmpty property="fromRecord">
          limit $fromRecord$,$pageSize$
       </isNotEmpty>
    </dynamic>
  </select>
</sqlMap>