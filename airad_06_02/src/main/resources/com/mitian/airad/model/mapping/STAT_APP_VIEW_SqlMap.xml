<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="STAT_APP_VIEW" >
  <resultMap id="ibatorgenerated_BaseResultMap" class="com.mitian.airad.model.StatAppView" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Mar 01 13:18:20 CST 2011.
    -->
    <result column="APP_CODE" property="appCode" jdbcType="VARCHAR" />
    <result column="APP_NAME" property="appName" jdbcType="VARCHAR" />
    <result column="CLICK_NUM" property="clickNum" jdbcType="INTEGER" />
    <result column="SHOW_NUM" property="showNum" jdbcType="INTEGER" />
    <result column="OFFER" property="offer" jdbcType="DECIMAL" />
    <result column="MAX_NUM" property="maxNum" jdbcType="INTEGER" />
    <result column="AD_NUM" property="adNum" jdbcType="INTEGER" />
    <result column="REQTIME" property="reqtime" jdbcType="VARCHAR" />
    <result column="CLICK_RATE" property="clickRate" jdbcType="INTEGER" />
    <result column="PUT_RATE" property="putRate" jdbcType="DECIMAL" />
    <result column="APP_ID" property="appId" jdbcType="VARCHAR" />
  </resultMap>
  <!-- 详细列表 -->
  <select id="findByTimeList" parameterClass="java.util.Map" resultMap="ibatorgenerated_BaseResultMap">
        select APP_ID,APP_CODE,APP_NAME,CLICK_NUM,SHOW_NUM,OFFER,MAX_NUM,AD_NUM,REQTIME,CLICK_RATE,PUT_RATE from STAT_APP_VIEW
        <dynamic prepend="where">
            <isNotEmpty prepend="and" property="inAppId">
                APP_ID in ($inAppId$)
            </isNotEmpty>
            <isNotEmpty prepend="and" property="startTime">
         <![CDATA[REQTIME >= #startTime# ]]>
            </isNotEmpty>
            <isNotEmpty prepend="and" property="endTime">
        <![CDATA[ REQTIME <= #endTime# ]]>
            </isNotEmpty>
        </dynamic>
        <dynamic prepend="order by">
          <isNotEmpty property="descFlag">
                 REQTIME DESC
          </isNotEmpty>
          <isNotEmpty property="asceFlag">
                 REQTIME ASC
          </isNotEmpty>
        </dynamic>
         limit #fromRecord#,#pageSize#
    </select>
    <!-- 应用总条数 -->
    <select id="selectCount" parameterClass="java.util.Map" resultClass="java.lang.Integer">
       select COUNT(*) count from STAT_APP_VIEW
        <dynamic prepend="where">
            <isNotEmpty prepend="and" property="inAppId">
                APP_ID in ($inAppId$)
            </isNotEmpty>
            <isNotEmpty prepend="and" property="startTime">
         <![CDATA[REQTIME >= #startTime# ]]>
            </isNotEmpty>
            <isNotEmpty prepend="and" property="endTime">
        <![CDATA[ REQTIME <= #endTime# ]]>
            </isNotEmpty>
        </dynamic>
    </select>
    <!-- 图表统计 -->
    <select id="findTotalByTime" parameterClass="java.util.Map"  resultClass="com.mitian.airad.model.StatAppView">
         select REQTIME reqtime,SUM(OFFER) offer,SUM(MAX_NUM) maxNum,SUM(SHOW_NUM) showNum,SUM(CLICK_NUM) clickNum,SUM(PUT_RATE) putRate,SUM(CLICK_RATE) clickRate
        from STAT_APP_VIEW
        <dynamic prepend="where">
            <isNotEmpty prepend="and" property="inAppId">
                APP_ID in ($inAppId$)
            </isNotEmpty>
            <isNotEmpty prepend="and" property="startTime">
         <![CDATA[REQTIME >= #startTime# ]]>
            </isNotEmpty>
            <isNotEmpty prepend="and" property="endTime">
        <![CDATA[ REQTIME <= #endTime# ]]>
            </isNotEmpty>
        </dynamic>
        group by REQTIME
    </select>
    <!-- 根据应用名称查找 -->
    <select id="selectByAppName" parameterClass="java.util.Map"   resultClass="com.mitian.airad.model.StatAppView">
        select APP_CODE,APP_NAME,SUM(OFFER) offer,SUM(MAX_NUM) maxNum,SUM(SHOW_NUM) showNum,SUM(CLICK_NUM) clickNum,SUM(PUT_RATE) putRate,SUM(CLICK_RATE) clickRate FROM STAT_APP_VIEW 
        where APP_CODE=#appCode#
        <dynamic>
            <isNotEmpty prepend="and" property="startTime">
          <![CDATA[REQTIME >= #startTime# ]]>
            </isNotEmpty>
            <isNotEmpty prepend="and" property="endTime">
          <![CDATA[ REQTIME <= #endTime# ]]>
            </isNotEmpty>
        </dynamic>
        GROUP BY APP_CODE
    </select>
</sqlMap>