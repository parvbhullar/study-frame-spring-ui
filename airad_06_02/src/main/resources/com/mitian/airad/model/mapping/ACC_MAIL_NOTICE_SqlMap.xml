<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="ACC_MAIL_NOTICE" >
  <resultMap id="ibatorgenerated_BaseResultMap" class="com.mitian.airad.model.AccMailNotice" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sat Feb 26 09:48:12 CST 2011.
    -->
    <result column="MAIL_NOTICE_ID" property="mailNoticeId" jdbcType="INTEGER" />
    <result column="ACCOUNT_BLANCE" property="accountBlance" jdbcType="INTEGER" />
    <result column="MEMBER_ID" property="memberId" jdbcType="LONG" />
    <result column="LAST_SEND_TIME" property="lastSendTime" jdbcType="TIMESTAMP" />
    <result column="REMIND_FLAG" property="remindFlag" jdbcType="CHAR" />
    <result column="MAIL_ADDR" property="mailAddr" jdbcType="VARCHAR" />
  </resultMap>
  <resultMap id="ibatorgenerated_ResultMapView" class="com.mitian.airad.model.AccMailNotice"  >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Mar 01 16:26:22 CST 2011.
    -->
    <result column="EMAIL" property="email" jdbcType="VARCHAR" />
    <result column="MEMBER_ID" property="memberId" jdbcType="LONG" />
    <result column="AGENT_BLANCE" property="agentBlance" jdbcType="DECIMAL" />
    <result column="COUPON_BLANCE" property="couponBlance" jdbcType="DECIMAL" />
    <result column="ACCEPT_BLANCE" property="acceptBlance" jdbcType="DECIMAL" />
    <result column="MAIL_ADDR" property="mailAddr" jdbcType="VARCHAR" />
    <result column="ACCOUNT_BLANCE" property="accountBlance" jdbcType="INTEGER" />
    
  </resultMap>
 <!-- 查询所有启用了通知 未删除的用户的少量信息 -->
  <select id="ibatorgenerated_selectAll" resultMap="ibatorgenerated_ResultMapView" >
  select b.member_id,b.ACCOUNT_BLANCE,c.email,b.mail_addr,a.agent_blance,a.COUPON_BLANCE,a.accept_blance from
   ACCOUNT_INFO_VIEW a,ACC_MAIL_NOTICE b,CORE_MEMBER_INFO c where a.MEMBER_ID=b.MEMBER_ID and  c.MEMBER_ID=b.MEMBER_ID
  and b.REMIND_FLAG='1' and c.DEL_FLAG='0'
  </select>
    
    <resultMap class="com.mitian.airad.model.AccMailNotice"  id="noticeAll" extends="ibatorgenerated_BaseResultMap">
    <result column="NOTICE_TYPE" property="noticeType"  jdbcType="INTEGER" />
    <result column="NOTICE_TYPE_VALUE" property="noticeTypeValue" jdbcType="INTEGER" />
     <result column="TRIGGER_TYPE" property="triggerType" jdbcType="INTEGER" />
    <result column="UPDATE_ID" property="updateId" jdbcType="LONG" />
    <result column="UPDATE_TIME" property="updateTime" jdbcType="TIMESTAMP" />
    </resultMap>
   <select id="selectByMemberId" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.mitian.airad.model.AccMailNotice" >
    <!--
      根据会员id查询通知信息  wangzhongwei
    -->
    select MAIL_NOTICE_ID, ACCOUNT_BLANCE, MEMBER_ID, LAST_SEND_TIME, REMIND_FLAG, MAIL_ADDR,
    NOTICE_TYPE,NOTICE_TYPE_VALUE,TRIGGER_TYPE,UPDATE_ID,UPDATE_TIME
    from ACC_MAIL_NOTICE
    where MEMBER_ID = #memberId:LONG#
  </select>
  <delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="com.mitian.airad.model.AccMailNotice" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sat Feb 26 09:48:12 CST 2011.
    -->
    delete from ACC_MAIL_NOTICE
    where MAIL_NOTICE_ID = #mailNoticeId:INTEGER#
  </delete>
  <insert id="insert" parameterClass="com.mitian.airad.model.AccMailNotice" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sat Feb 26 09:48:12 CST 2011.
    -->
    insert into ACC_MAIL_NOTICE (MAIL_NOTICE_ID, ACCOUNT_BLANCE, MEMBER_ID, LAST_SEND_TIME,
      REMIND_FLAG, MAIL_ADDR,NOTICE_TYPE,NOTICE_TYPE_VALUE,TRIGGER_TYPE, UPDATE_ID, UPDATE_TIME)
    values (#mailNoticeId:INTEGER#, #accountBlance:INTEGER#, #memberId:LONG#,
      #lastSendTime:TIMESTAMP#, #remindFlag:CHAR#, #mailAddr:VARCHAR#,#noticeType:INTEGER#,#noticeTypeValue:INTEGER#, 
       #triggerType:VARCHAR#,#updateId:LONG#, #updateTime:TIMESTAMP#)
  </insert>
    
    <update id="updateRemindFlag" parameterClass="com.mitian.airad.model.AccMailNotice" >
     update ACC_MAIL_NOTICE set
      REMIND_FLAG = #remindFlag:CHAR#,  
        UPDATE_ID= #updateId:LONG#,
     UPDATE_TIME=#updateTime:TIMESTAMP#
      where MAIL_NOTICE_ID = #mailNoticeId:INTEGER#
    </update>
    
  <update id="update" parameterClass="com.mitian.airad.model.AccMailNotice" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sat Feb 26 09:48:12 CST 2011.
    -->
    update ACC_MAIL_NOTICE 
    set  ACCOUNT_BLANCE = #accountBlance:INTEGER#,
    MEMBER_ID = #memberId:LONG#, 
     REMIND_FLAG = #remindFlag:CHAR#,  
     MAIL_ADDR = #mailAddr:VARCHAR#,
     NOTICE_TYPE = #noticeType:INTEGER#,
     NOTICE_TYPE_VALUE = #noticeTypeValue:INTEGER#,
     TRIGGER_TYPE = #triggerType:VARCHAR#,
     UPDATE_ID= #updateId:LONG#,
     UPDATE_TIME=#updateTime:TIMESTAMP#
    where MAIL_NOTICE_ID = #mailNoticeId:INTEGER#
  </update>
  
  <select id="getCountByNoticeType"  parameterClass="com.mitian.airad.model.AccMailNotice" resultClass="Long">
  select count(*) from ACC_MAIL_NOTICE where NOTICE_TYPE=#noticeType:INTEGER# and REMIND_FLAG='1' and TRIGGER_TYPE=#triggerType:CHAR#
  </select>
  <resultMap class="com.mitian.airad.model.AccMailNotice"  id="accMailNotice4job" extends="ibatorgenerated_BaseResultMap">
    <result column="NOTICE_TYPE" property="noticeType" jdbcType="INTEGER" />
    <result column="NOTICE_TYPE_VALUE" property="noticeTypeValue" jdbcType="INTEGER" />
    <result column="TRIGGER_TYPE" property="triggerType" jdbcType="VARCHAR" />
    <result column="ACCEPT_BLANCE" property="acceptBlance" jdbcType="DECIMAL" />
  </resultMap>
  <select id="getListByNoticeTypeAndTriggerType"  resultMap="accMailNotice4job" parameterClass="com.mitian.airad.model.AccMailNotice" >
   select a.MAIL_NOTICE_ID, a.ACCOUNT_BLANCE, a.MEMBER_ID, a.LAST_SEND_TIME, a.REMIND_FLAG, 
   a.MAIL_ADDR,a.NOTICE_TYPE,a.NOTICE_TYPE_VALUE,a.TRIGGER_TYPE,b.ACCEPT_BLANCE
    from ACC_MAIL_NOTICE a ,ACCOUNT_INFO_VIEW b
    where a.MEMBER_ID=b.MEMBER_ID 
    and a.NOTICE_TYPE=#noticeType:INTEGER# 
    and a.REMIND_FLAG='1' 
    and a.TRIGGER_TYPE=#triggerType:CHAR# order by a.MEMBER_ID limit #offset:INTEGER#,#limit:INTEGER#
  </select>
</sqlMap>