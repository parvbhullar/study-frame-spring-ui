<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="ACCOUNT_INFO_VIEW" >
  <resultMap id="ibatorgenerated_BaseResultMap" class="com.mitian.airad.model.AccountInfoView" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Feb 22 13:53:49 CST 2011.
    -->
    <result column="MEMBER_ID" property="memberId" jdbcType="LONG" />
    <result column="COUNT_ACCOUNT" property="countAccount" jdbcType="DECIMAL" />
    <result column="COUNT_COUPON" property="countCoupon" jdbcType="DECIMAL" />
    <result column="COUNT_AGENT" property="countAgent" jdbcType="DECIMAL" />
    <result column="COUNT_PAY" property="countPay" jdbcType="DECIMAL" />
    <result column="ADVERTISER_PAY" property="advertiserPay" jdbcType="DECIMAL" />
    <result column="AGENT_PAY" property="agentPay" jdbcType="DECIMAL" />
    <result column="COUPON_PAY" property="couponPay" jdbcType="DECIMAL" />
    <result column="INCOME" property="income" jdbcType="DECIMAL" />
    <result column="COUNT_CONVERT" property="countConvert" jdbcType="DECIMAL" />
    <result column="COUNT_CASH" property="countCash" jdbcType="DECIMAL" />
    <result column="ACCEPT_CASH" property="acceptCash" jdbcType="DECIMAL" />
    <result column="UNACCEPT_CASH" property="unacceptCash" jdbcType="DECIMAL" />
    <result column="ACCEPT_BLANCE" property="acceptBlance" jdbcType="DECIMAL" />
    <result column="COUPON_BLANCE" property="couponBlance" jdbcType="DECIMAL" />
    <result column="AGENT_BLANCE" property="agentBlance" jdbcType="DECIMAL" />
    <result column="INCOME_BLANCE" property="incomeBlance" jdbcType="DECIMAL" />
  </resultMap>
   <resultMap id="ibatorgenerated_BaseResultMap_findByMemberId" class="com.mitian.airad.model.AccountInfoView">
    <result column="EMAIL" property="email" jdbcType="VARCHAR" />
    <result column="COUNT_AGENT" property="countAgent" jdbcType="DECIMAL" />
    <result column="AGENT_BLANCE" property="agentBlance" jdbcType="DECIMAL" />
   </resultMap>
  <!-- 查询一定范围内数据（根据多个memberId） -->
  <select id="findByMemberId" resultMap="ibatorgenerated_BaseResultMap_findByMemberId" parameterClass="java.util.HashMap">
     select a.EMAIL EMAIL,b.COUNT_AGENT COUNT_AGENT,b.AGENT_BLANCE AGENT_BLANCE FROM
    (select c.MEMBER_ID,c.ADVERTISER_NUM,d.EMAIL from CORE_AGENT_RELATION c  left join CORE_MEMBER_INFO d on d.MEMBER_ID=c.ADVERTISER_NUM where c.MEMBER_ID=#memberId# and (c.DEL_FLAG  is null OR c.DEL_FLAG !='1'))a 
    left join ACCOUNT_INFO_VIEW b on a.ADVERTISER_NUM=b.MEMBER_ID
     <dynamic prepend="where">
    <isNotEmpty prepend="AND" property="email">
          EMAIL like '%$email$%'
   </isNotEmpty></dynamic>
  </select>
  <!-- 根据条件查询 -->
  <select id="findByAccountInfo" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.mitian.airad.model.AccountInfoView">
        SELECT
          IFNULL(`A`.`MEMBER_ID`,-(1)) AS `MEMBER_ID`,
          IFNULL(SUM(`B`.`RECHRANG`),0) AS `COUNT_ACCOUNT`,
          IFNULL(SUM(`B`.`CUNPON`),0) AS `COUNT_COUPON`,
          IFNULL(SUM(`B`.`AGENT`),0) AS `COUNT_AGENT`,
          IFNULL(SUM(`B`.`COUNTPAY`),0) AS `COUNT_PAY`,
          IFNULL(SUM(`B`.`ADDERPAY`),0) AS `ADVERTISER_PAY`,
          IFNULL(SUM(`B`.`AGENTPAY`),0) AS `AGENT_PAY`,
          IFNULL(SUM(`B`.`CUNPONPAY`),0) AS `COUPON_PAY`,
          IFNULL(SUM(`B`.`INCOME`),0) AS `INCOME`,
          IFNULL(SUM(`B`.`COUNTCONVERT1`),0) AS `COUNT_CONVERT`,
          IFNULL(SUM(`B`.`COUNTCASH`),0) AS `COUNT_CASH`,
          IFNULL(SUM(`B`.`ACCEPTCASH`),0) AS `ACCEPT_CASH`,
          IFNULL(SUM(`B`.`UNACCEPTCASH`),0) AS `UNACCEPT_CASH`,
          (((((IFNULL(SUM(`B`.`RECHRANG`),0) + IFNULL(SUM(`B`.`COUNTCONVERT2`),0)) - IFNULL(SUM(`B`.`AGENTOWNERPAY`),0)) - IFNULL(SUM(`B`.`AGENTPAYSHOW`),0)) - IFNULL(SUM(`B`.`ADDERPAY`),0)) - IFNULL(SUM(`B`.`ADDERPAYSHOW`),0)) AS `ACCEPT_BLANCE`,
          ((IFNULL(SUM(`B`.`CUNPON`),0) - IFNULL(SUM(`B`.`CUNPONPAY`),0)) - IFNULL(SUM(`B`.`CUNPONPAYSHOW`),0)) AS `COUPON_BLANCE`,
          (CASE WHEN (IFNULL(SUM(`B`.`AGENT`),0) > 0) THEN ((IFNULL(SUM(`B`.`AGENT`),0) - IFNULL(SUM(`B`.`AGENTPAY`),0)) - IFNULL(SUM(`B`.`AGENTPAYSHOW`),0)) ELSE 0.000000 END) AS `AGENT_BLANCE`,
          (((IFNULL(SUM(`B`.`INCOME`),0) - IFNULL(SUM(`B`.`COUNTCONVERT1`),0)) - IFNULL(SUM(`B`.`COUNTCASH`),0)) + IFNULL(SUM(`B`.`SHOWINCOME`),0)) AS `INCOME_BLANCE`
        FROM `CORE_MEMBER_INFO` `A`
        LEFT JOIN ACCOUNT_INFO_TEMP_V `B` ON `A`.`MEMBER_ID` = `B`.`MEMBER_ID`
        <dynamic prepend="where">
            <isNotNull prepend="" property="memberId">
               A.MEMBER_ID = #memberId#
            </isNotNull>
         </dynamic>
  </select>
  <select id="findAccountInfoByEmail" resultMap="ibatorgenerated_BaseResultMap" parameterClass="java.util.HashMap">
      select IFNULL(MEMBER_ID,0)MEMBER_ID, IFNULL(COUNT_ACCOUNT,0)COUNT_ACCOUNT, IFNULL(COUNT_COUPON,0)COUNT_COUPON, IFNULL(COUNT_AGENT,0)COUNT_AGENT, IFNULL(COUNT_PAY,0)COUNT_PAY,
        IFNULL(ADVERTISER_PAY,0)ADVERTISER_PAY, IFNULL(AGENT_PAY,0)AGENT_PAY, IFNULL(COUPON_PAY,0)COUPON_PAY, IFNULL(INCOME,0)INCOME, IFNULL(COUNT_CONVERT,0)COUNT_CONVERT, IFNULL(COUNT_CASH,0)COUNT_CASH, IFNULL(ACCEPT_CASH,0)ACCEPT_CASH,
        IFNULL(UNACCEPT_CASH,0)UNACCEPT_CASH, IFNULL(ACCEPT_BLANCE,0)ACCEPT_BLANCE, IFNULL(COUPON_BLANCE,0)COUPON_BLANCE, IFNULL(AGENT_BLANCE,0)AGENT_BLANCE, IFNULL(INCOME_BLANCE,0)INCOME_BLANCE
      from ACCOUNT_INFO_VIEW
      where
        MEMBER_ID = (SELECT MEMBER_ID
                     FROM CORE_MEMBER_INFO
                     WHERE EMAIL = '$email$' limit 1)
  </select>
   <select id="findByTyleListByTypeKey" resultClass="com.mitian.airad.model.SysConfig" parameterClass="com.mitian.airad.model.SysConfig" >
    select  IFNULL(SYS_KEY,'0') sysKey, IFNULL(SYS_VAL,'0') sysVal
    from SYS_CONFIG
    where SYS_TYPE = #sysType# 
  </select>
  <insert id="ibatorgenerated_insert" parameterClass="com.mitian.airad.model.AccountInfoView" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Feb 22 13:53:49 CST 2011.
    -->
    insert into ACCOUNT_INFO_VIEW (MEMBER_ID, COUNT_ACCOUNT, COUNT_COUPON, COUNT_AGENT, COUNT_PAY,
      ADVERTISER_PAY, AGENT_PAY, COUPON_PAY, INCOME, COUNT_CONVERT, COUNT_CASH, ACCEPT_CASH,
      UNACCEPT_CASH, ACCEPT_BLANCE, COUPON_BLANCE, AGENT_BLANCE, INCOME_BLANCE)
    values (#memberId:LONG#, #countAccount:DECIMAL#, #countCoupon:DECIMAL#, #countAgent:DECIMAL#,
      #countPay:DECIMAL#, #advertiserPay:DECIMAL#, #agentPay:DECIMAL#, #couponPay:DECIMAL#,
      #income:DECIMAL#, #countConvert:DECIMAL#, #countCash:DECIMAL#, #acceptCash:DECIMAL#,
      #unacceptCash:DECIMAL#, #acceptBlance:DECIMAL#, #couponBlance:DECIMAL#, #agentBlance:DECIMAL#,
      #incomeBlance:DECIMAL#)
  </insert>
  <insert id="ibatorgenerated_insertSelective" parameterClass="com.mitian.airad.model.AccountInfoView" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Feb 22 13:53:49 CST 2011.
    -->
    insert into ACCOUNT_INFO_VIEW
    <dynamic prepend="(" >
      <isNotNull prepend="," property="memberId" >
        MEMBER_ID
      </isNotNull>
      <isNotNull prepend="," property="countAccount" >
        COUNT_ACCOUNT
      </isNotNull>
      <isNotNull prepend="," property="countCoupon" >
        COUNT_COUPON
      </isNotNull>
      <isNotNull prepend="," property="countAgent" >
        COUNT_AGENT
      </isNotNull>
      <isNotNull prepend="," property="countPay" >
        COUNT_PAY
      </isNotNull>
      <isNotNull prepend="," property="advertiserPay" >
        ADVERTISER_PAY
      </isNotNull>
      <isNotNull prepend="," property="agentPay" >
        AGENT_PAY
      </isNotNull>
      <isNotNull prepend="," property="couponPay" >
        COUPON_PAY
      </isNotNull>
      <isNotNull prepend="," property="income" >
        INCOME
      </isNotNull>
      <isNotNull prepend="," property="countConvert" >
        COUNT_CONVERT
      </isNotNull>
      <isNotNull prepend="," property="countCash" >
        COUNT_CASH
      </isNotNull>
      <isNotNull prepend="," property="acceptCash" >
        ACCEPT_CASH
      </isNotNull>
      <isNotNull prepend="," property="unacceptCash" >
        UNACCEPT_CASH
      </isNotNull>
      <isNotNull prepend="," property="acceptBlance" >
        ACCEPT_BLANCE
      </isNotNull>
      <isNotNull prepend="," property="couponBlance" >
        COUPON_BLANCE
      </isNotNull>
      <isNotNull prepend="," property="agentBlance" >
        AGENT_BLANCE
      </isNotNull>
      <isNotNull prepend="," property="incomeBlance" >
        INCOME_BLANCE
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(" >
      <isNotNull prepend="," property="memberId" >
        #memberId:LONG#
      </isNotNull>
      <isNotNull prepend="," property="countAccount" >
        #countAccount:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="countCoupon" >
        #countCoupon:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="countAgent" >
        #countAgent:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="countPay" >
        #countPay:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="advertiserPay" >
        #advertiserPay:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="agentPay" >
        #agentPay:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="couponPay" >
        #couponPay:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="income" >
        #income:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="countConvert" >
        #countConvert:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="countCash" >
        #countCash:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="acceptCash" >
        #acceptCash:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="unacceptCash" >
        #unacceptCash:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="acceptBlance" >
        #acceptBlance:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="couponBlance" >
        #couponBlance:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="agentBlance" >
        #agentBlance:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="incomeBlance" >
        #incomeBlance:DECIMAL#
      </isNotNull>
      )
    </dynamic>
  </insert>
</sqlMap>