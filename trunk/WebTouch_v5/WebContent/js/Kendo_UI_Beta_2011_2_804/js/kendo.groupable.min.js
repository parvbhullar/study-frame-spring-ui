(function(a,b){function m(){h.is(":empty")&&h.html(f)}function l(){k=a.map(a(".t-group-indicator",h),function(b){b=a(b);var c=b.offset().left;return{left:c,right:c+b.outerWidth(),element:b}})}var c=b.kendo,d=c.ui.Component,e=a.proxy,f="Drag a column header and drop it here to group by that column",g=c.template('<div class="t-group-indicator" data-field="${data.field}" data-dir="${data.dir || "asc"}"><a href="#" class="t-link"><span class="t-icon t-arrow-${(data.dir || "asc") == "asc" ? "up" : "down"}-small">(sorted ${(data.dir || "asc") == "asc" ? "ascending": "descending"})</span>${data.field}</a><a class="t-button t-button-icon t-button-bare"><span class="t-icon t-group-delete"></span></a></div>',{useWithBlock:!1}),h,i=function(b){return a('<div class="t-header t-drag-clue" />').html(b.data("field")).prepend('<span class="t-icon t-drag-status t-denied" />')},j=a('<div class="t-grouping-dropclue"/>'),k=[],n=d.extend({init:function(b,c){var f=this;d.fn.init.call(f,b,c),h=a(f.options.groupContainer,f.element).kendoDropTarget({dragenter:function(a){a.draggable.hint.find(".t-drag-status").removeClass("t-denied").addClass("t-add"),j.css({top:3,left:0}).appendTo(h)},dragleave:function(a){a.draggable.hint.find(".t-drag-status").removeClass("t-add").addClass("t-denied"),j.remove()}}).kendoDraggable({filter:"div.t-group-indicator",hint:i,dragend:function(a){f._dragEnd(this,a)},dragstart:function(a){var b=a.currentTarget,c=parseInt(b.css("marginLeft")),d=b.position().left-c;l(),j.css({top:3,left:d}).appendTo(h),this.hint.find(".t-drag-status").removeClass("t-denied").addClass("t-add")},drag:e(f._drag,f)}).delegate(".t-button","click",function(b){b.preventDefault(),f._removeIndicator(a(this).parent())}).delegate(".t-link","click",function(b){var c=a(this).parent(),d=f.buildIndicator(c.data("field"),c.data("dir")=="asc"?"desc":"asc");c.before(d).remove(),f._change(),b.preventDefault()}),f.element.kendoDraggable({filter:f.options.filter,hint:i,dragend:function(a){f._dragEnd(this,a)},dragstart:function(a){var b,c,d,e=a.currentTarget.data("field");f.indicator(e)?a.preventDefault():(l(),k.length?(b=k[k.length-1].element,c=parseInt(b.css("marginRight")),d=b.position().left+b.outerWidth()+c):d=0,j.css({top:3,left:d}).appendTo(h),this.hint.find(".t-drag-status").removeClass("t-denied").addClass("t-add"))},drag:e(f._drag,f)}),f.dataSource=f.options.dataSource,f.dataSource&&f.dataSource.bind("change",function(){h.empty().append(a.map(this.group()||[],function(a){return f.buildIndicator(a.field,a.dir)}).join("")),m()})},options:{filter:"th"},indicator:function(b){return a.grep(a(".t-group-indicator",h),function(c){return a(c).data("field")===b})[0]},buildIndicator:function(a,b){return g({field:a,dir:b})},descriptors:function(){return a.map(a(".t-group-indicator",h),function(b){b=a(b);return{field:b.data("field"),dir:b.data("dir")}})},_removeIndicator:function(a){a.remove(),m(),this._change()},_change:function(){var a=this;a.dataSource&&a.dataSource.group(a.descriptors())},_dropCuePosition:function(b){if(!!j.is(":visible")&&k.length!=0){var c=k[k.length-1],d=c.right,e=parseInt(c.element.css("marginLeft")),f=parseInt(c.element.css("marginRight"));b>=d?b={left:c.element.position().left+c.element.outerWidth()+f,element:c.element,before:!1}:(b=a.grep(k,function(a){return a.left<=b&&b<=a.right})[0],b&&(b={left:b.element.position().left-e,element:b.element,before:!0}));return b}},_drag:function(a){var b=this._dropCuePosition(a.pageX);b&&j.css({left:b.left})},_canDrop:function(a,b,c){var d=a.next();return a[0]!==b[0]&&(!d[0]||b[0]!==d[0]||c>d.position().left)},_dragEnd:function(b,c){var d=this,e=c.currentTarget.data("field"),f=d.indicator(e),g=k[k.length-1],i;b.dropped?g?(i=d._dropCuePosition(j.offset().left+parseInt(g.element.css("marginLeft"))+parseInt(g.element.css("marginRight"))),d._canDrop(a(f),i.element,i.left)&&(i.before?i.element.before(f||d.buildIndicator(e)):i.element.after(f||d.buildIndicator(e)),d._change())):(h.append(d.buildIndicator(e)),d._change()):f&&d._removeIndicator(a(f)),j.remove(),k=[]}});c.ui.plugin("Groupable",n)})(jQuery,window)