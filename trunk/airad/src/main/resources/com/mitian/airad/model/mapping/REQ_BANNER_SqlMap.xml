<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="REQ_BANNER" >
  <resultMap id="ibatorgenerated_BaseResultMap" class="com.mitian.airad.model.ReqBanner" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Mar 08 12:38:18 CST 2011.
    -->
    <result column="BANNER_REQ_ID" property="bannerReqId" jdbcType="INTEGER" />
    <result column="AD_ID" property="adId" jdbcType="INTEGER" />
    <result column="REQ_TIME" property="reqTime" jdbcType="TIMESTAMP" />
    <result column="PROVINCE" property="province" jdbcType="SMALLINT" />
    <result column="CITY" property="city" jdbcType="SMALLINT" />
    <result column="AREA" property="area" jdbcType="SMALLINT" />
    <result column="CAMPAIGN_ID" property="campaignId" jdbcType="INTEGER" />
    <result column="AD_GROUP_ID" property="adGroupId" jdbcType="INTEGER" />
    <result column="ADVERTISER_ID" property="advertiserId" jdbcType="INTEGER" />
    <result column="DEV_ID" property="devId" jdbcType="INTEGER" />
    <result column="AGENT_ID" property="agentId" jdbcType="INTEGER" />
    <result column="FLAG" property="flag" jdbcType="CHAR" />
    <result column="APP_CODE" property="appCode" jdbcType="VARCHAR" />
    <result column="DEVICE_SCREEN_WIDTH" property="deviceScreenWidth" jdbcType="CHAR" />
    <result column="DEVICE_SCREEN_HEIGHT" property="deviceScreenHeight" jdbcType="CHAR" />
    <result column="BANNER_ONLINE_IP" property="bannerOnlineIp" jdbcType="VARCHAR" />
    <result column="BANNER_ONLINE_USER_AGENT" property="bannerOnlineUserAgent" jdbcType="VARCHAR" />
    <result column="LONGITUDE" property="longitude" jdbcType="VARCHAR" />
    <result column="LATITUDE" property="latitude" jdbcType="VARCHAR" />
  </resultMap>
  
  <!-- 根据广告ID,查询出此广告出现的次数 -->
  <select id="ibatorgenerated_selectCountByAdId">
    select count(AD_ID) from REQ_BANNER where AD_ID = #adId#
  </select>
  
  <select id="ibatorgenerated_selectByPrimaryKey" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.mitian.airad.model.ReqBanner" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Mar 08 12:38:18 CST 2011.
    -->
    select BANNER_REQ_ID, AD_ID, REQ_TIME, PROVINCE, CITY, AREA, CAMPAIGN_ID, AD_GROUP_ID,
      ADVERTISER_ID, DEV_ID, AGENT_ID, FLAG, APP_CODE, DEVICE_SCREEN_WIDTH, DEVICE_SCREEN_HEIGHT,
      BANNER_ONLINE_IP, BANNER_ONLINE_USER_AGENT, LONGITUDE, LATITUDE
    from REQ_BANNER
    where BANNER_REQ_ID = #bannerReqId:INTEGER#
  </select>
  <delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="com.mitian.airad.model.ReqBanner" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Mar 08 12:38:18 CST 2011.
    -->
    delete from REQ_BANNER
    where BANNER_REQ_ID = #bannerReqId:INTEGER#
  </delete>
  <insert id="ibatorgenerated_insert" parameterClass="com.mitian.airad.model.ReqBanner" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Mar 08 12:38:18 CST 2011.
    -->
    insert into REQ_BANNER (BANNER_REQ_ID, AD_ID, REQ_TIME, PROVINCE, CITY, AREA, CAMPAIGN_ID,
      AD_GROUP_ID, ADVERTISER_ID, DEV_ID, AGENT_ID, FLAG, APP_CODE, DEVICE_SCREEN_WIDTH,
      DEVICE_SCREEN_HEIGHT, BANNER_ONLINE_IP, BANNER_ONLINE_USER_AGENT, LONGITUDE, LATITUDE)
    values (#bannerReqId:INTEGER#, #adId:INTEGER#, #reqTime:TIMESTAMP#, #province:SMALLINT#,
      #city:SMALLINT#, #area:SMALLINT#, #campaignId:INTEGER#, #adGroupId:INTEGER#,
      #advertiserId:INTEGER#, #devId:INTEGER#, #agentId:INTEGER#, #flag:CHAR#, #appCode:VARCHAR#,
      #deviceScreenWidth:CHAR#, #deviceScreenHeight:CHAR#, #bannerOnlineIp:VARCHAR#,
      #bannerOnlineUserAgent:VARCHAR#, #longitude:VARCHAR#, #latitude:VARCHAR#)
  </insert>
  <insert id="ibatorgenerated_insertSelective" parameterClass="com.mitian.airad.model.ReqBanner" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Mar 08 12:38:18 CST 2011.
    -->
    insert into REQ_BANNER
    <dynamic prepend="(" >
      <isNotNull prepend="," property="bannerReqId" >
        BANNER_REQ_ID
      </isNotNull>
      <isNotNull prepend="," property="adId" >
        AD_ID
      </isNotNull>
      <isNotNull prepend="," property="reqTime" >
        REQ_TIME
      </isNotNull>
      <isNotNull prepend="," property="province" >
        PROVINCE
      </isNotNull>
      <isNotNull prepend="," property="city" >
        CITY
      </isNotNull>
      <isNotNull prepend="," property="area" >
        AREA
      </isNotNull>
      <isNotNull prepend="," property="campaignId" >
        CAMPAIGN_ID
      </isNotNull>
      <isNotNull prepend="," property="adGroupId" >
        AD_GROUP_ID
      </isNotNull>
      <isNotNull prepend="," property="advertiserId" >
        ADVERTISER_ID
      </isNotNull>
      <isNotNull prepend="," property="devId" >
        DEV_ID
      </isNotNull>
      <isNotNull prepend="," property="agentId" >
        AGENT_ID
      </isNotNull>
      <isNotNull prepend="," property="flag" >
        FLAG
      </isNotNull>
      <isNotNull prepend="," property="appCode" >
        APP_CODE
      </isNotNull>
      <isNotNull prepend="," property="deviceScreenWidth" >
        DEVICE_SCREEN_WIDTH
      </isNotNull>
      <isNotNull prepend="," property="deviceScreenHeight" >
        DEVICE_SCREEN_HEIGHT
      </isNotNull>
      <isNotNull prepend="," property="bannerOnlineIp" >
        BANNER_ONLINE_IP
      </isNotNull>
      <isNotNull prepend="," property="bannerOnlineUserAgent" >
        BANNER_ONLINE_USER_AGENT
      </isNotNull>
      <isNotNull prepend="," property="longitude" >
        LONGITUDE
      </isNotNull>
      <isNotNull prepend="," property="latitude" >
        LATITUDE
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(" >
      <isNotNull prepend="," property="bannerReqId" >
        #bannerReqId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="adId" >
        #adId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="reqTime" >
        #reqTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="province" >
        #province:SMALLINT#
      </isNotNull>
      <isNotNull prepend="," property="city" >
        #city:SMALLINT#
      </isNotNull>
      <isNotNull prepend="," property="area" >
        #area:SMALLINT#
      </isNotNull>
      <isNotNull prepend="," property="campaignId" >
        #campaignId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="adGroupId" >
        #adGroupId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="advertiserId" >
        #advertiserId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="devId" >
        #devId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="agentId" >
        #agentId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="flag" >
        #flag:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="appCode" >
        #appCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="deviceScreenWidth" >
        #deviceScreenWidth:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="deviceScreenHeight" >
        #deviceScreenHeight:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="bannerOnlineIp" >
        #bannerOnlineIp:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="bannerOnlineUserAgent" >
        #bannerOnlineUserAgent:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="longitude" >
        #longitude:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="latitude" >
        #latitude:VARCHAR#
      </isNotNull>
      )
    </dynamic>
  </insert>
  <update id="ibatorgenerated_updateByPrimaryKeySelective" parameterClass="com.mitian.airad.model.ReqBanner" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Mar 08 12:38:18 CST 2011.
    -->
    update REQ_BANNER
    <dynamic prepend="set" >
      <isNotNull prepend="," property="adId" >
        AD_ID = #adId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="reqTime" >
        REQ_TIME = #reqTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="province" >
        PROVINCE = #province:SMALLINT#
      </isNotNull>
      <isNotNull prepend="," property="city" >
        CITY = #city:SMALLINT#
      </isNotNull>
      <isNotNull prepend="," property="area" >
        AREA = #area:SMALLINT#
      </isNotNull>
      <isNotNull prepend="," property="campaignId" >
        CAMPAIGN_ID = #campaignId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="adGroupId" >
        AD_GROUP_ID = #adGroupId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="advertiserId" >
        ADVERTISER_ID = #advertiserId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="devId" >
        DEV_ID = #devId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="agentId" >
        AGENT_ID = #agentId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="flag" >
        FLAG = #flag:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="appCode" >
        APP_CODE = #appCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="deviceScreenWidth" >
        DEVICE_SCREEN_WIDTH = #deviceScreenWidth:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="deviceScreenHeight" >
        DEVICE_SCREEN_HEIGHT = #deviceScreenHeight:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="bannerOnlineIp" >
        BANNER_ONLINE_IP = #bannerOnlineIp:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="bannerOnlineUserAgent" >
        BANNER_ONLINE_USER_AGENT = #bannerOnlineUserAgent:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="longitude" >
        LONGITUDE = #longitude:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="latitude" >
        LATITUDE = #latitude:VARCHAR#
      </isNotNull>
    </dynamic>
    where BANNER_REQ_ID = #bannerReqId:INTEGER#
  </update>
  <update id="ibatorgenerated_updateByPrimaryKey" parameterClass="com.mitian.airad.model.ReqBanner" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Mar 08 12:38:18 CST 2011.
    -->
    update REQ_BANNER
    set AD_ID = #adId:INTEGER#,
      REQ_TIME = #reqTime:TIMESTAMP#,
      PROVINCE = #province:SMALLINT#,
      CITY = #city:SMALLINT#,
      AREA = #area:SMALLINT#,
      CAMPAIGN_ID = #campaignId:INTEGER#,
      AD_GROUP_ID = #adGroupId:INTEGER#,
      ADVERTISER_ID = #advertiserId:INTEGER#,
      DEV_ID = #devId:INTEGER#,
      AGENT_ID = #agentId:INTEGER#,
      FLAG = #flag:CHAR#,
      APP_CODE = #appCode:VARCHAR#,
      DEVICE_SCREEN_WIDTH = #deviceScreenWidth:CHAR#,
      DEVICE_SCREEN_HEIGHT = #deviceScreenHeight:CHAR#,
      BANNER_ONLINE_IP = #bannerOnlineIp:VARCHAR#,
      BANNER_ONLINE_USER_AGENT = #bannerOnlineUserAgent:VARCHAR#,
      LONGITUDE = #longitude:VARCHAR#,
      LATITUDE = #latitude:VARCHAR#
    where BANNER_REQ_ID = #bannerReqId:INTEGER#
  </update>
  <!-- 查看广告展示是否千次展示wendong.Gao -->
  <select  id="showAdCount" parameterClass="com.mitian.airad.model.ReqBanner" resultClass="int">
   select count(*)count from REQ_BANNER where FLAG = '0' and AD_ID = #adId# and APP_CODE = #appCode# group by ad_id,app_code
  </select>
  <!-- 修改APPCODE ADID 为条件的展示数，修改完成后增加点击费用wendong.Gao -->
  <update id="statusCountUpdate" parameterClass="com.mitian.airad.model.ReqBanner" >
    update REQ_BANNER set FLAG = '1'
    where app_Code = #appCode# and AD_ID = #adId#
  </update>
  <!-- 查找出大于count数的广告ID -->
  <select id="show_adid" parameterClass="com.mitian.airad.model.ReqBanner" resultClass="com.mitian.airad.model.ReqBanner">
  SELECT T.AD_ID adId,T.count count from (
  SELECT COUNT(AD_ID) count,AD_ID  FROM REQ_BANNER where FLAG = '0'  GROUP BY AD_ID
  ) T  where T.count  <![CDATA[ >= ]]>$count$ 
  </select>
  <!-- 根据广告ID查找出APPCODE进行分成 -->
  <select id="findByAdIdAppCode" parameterClass="com.mitian.airad.model.ReqBanner" resultClass="com.mitian.airad.model.ReqBanner">
  SELECT COUNT(A.AD_ID) count ,A.APP_CODE appCode ,B.MEMBER_ID memberId FROM REQ_BANNER A
  LEFT JOIN CORE_APP B ON A.APP_CODE=B.APP_CODE 
  WHERE AD_ID=#adId# GROUP BY A.APP_CODE
  </select>
  <!-- 将展示计费过的数据改FLAG为1 -->
  <update id="updateByFlag" parameterClass="com.mitian.airad.model.ReqBanner" >
  update REQ_BANNER set FLAG='1'
  </update>
</sqlMap>