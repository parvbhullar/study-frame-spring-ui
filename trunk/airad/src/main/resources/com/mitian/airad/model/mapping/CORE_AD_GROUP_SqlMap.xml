<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="CORE_AD_GROUP">
  <resultMap class="com.mitian.airad.model.CoreAdGroup" id="ibatorgenerated_BaseResultMap">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Jan 25 17:28:52 CST 2011.
    -->
    <result column="AD_GROUP_ID" jdbcType="INTEGER" property="adGroupId" />
    <result column="CAMPAIGN_ID" jdbcType="INTEGER" property="campaignId" />
    <result column="AD_GROUP_NAME" jdbcType="VARCHAR" property="adGroupName" />
    <result column="AD_TAG_TYPE" jdbcType="CHAR" property="adTagType" />
    <result column="AD_LOCL_TYPE" jdbcType="CHAR" property="adLoclType" />
    <result column="AD_LOCL_INFO" jdbcType="VARCHAR" property="adLoclInfo" />
    <result column="AD_FLOW_INFO" jdbcType="VARCHAR" property="adFlowInfo" />
    <result column="CHANGCE_INFO" jdbcType="VARCHAR" property="changceInfo" />
    <result column="AD_TAG_SEX" jdbcType="CHAR" property="adTagSex" />
    <result column="AD_TAG_AGE" jdbcType="CHAR" property="adTagAge" />
    <result column="AD_TAG_SOFT_TYPE" jdbcType="CHAR" property="adTagSoftType" />
    <result column="AD_TAG_SP" jdbcType="CHAR" property="adTagSp" />
    <result column="BLOCKING" jdbcType="CHAR" property="blocking" />
    <result column="SUSPEND_TYPE" jdbcType="CHAR" property="suspendType" />
    <result column="ADD_OPER" jdbcType="VARCHAR" property="addOper" />
    <result column="ADD_TIME" jdbcType="TIMESTAMP" property="addTime" />
    <result column="UPD_OPER" jdbcType="VARCHAR" property="updOper" />
    <result column="UPD_TIME" jdbcType="TIMESTAMP" property="updTime" />
    <result column="DEL_OPER" jdbcType="VARCHAR" property="delOper" />
    <result column="DEL_TIME" jdbcType="TIMESTAMP" property="delTime" />
    <result column="DEL_FLAG" jdbcType="CHAR" property="delFlag" />
    <result column="MEMBER_ID" jdbcType="LONG" property="memberId" />
    <result column="AD_TAG_SP_VS" jdbcType="CHAR" property="adTagSpVs" />
  </resultMap>
   <resultMap id="ibatorgenerated_BaseResultMap_ext_campaignName" class="com.mitian.airad.model.CoreAdGroup" extends="ibatorgenerated_BaseResultMap">
    <result column="CAMPAIGN_NAME" property="campaignName" jdbcType="VARCHAR" />
  </resultMap>
  <resultMap id="ibatorgenerated_BaseResultMap_adGroupDetial" class="com.mitian.airad.model.CoreAdGroup">
    <result column="CNT" jdbcType="INTEGER" property="cnt" />
    <result column="SUSPEND_TYPE" jdbcType="CHAR" property="suspendType" />
    <result column="AD_GROUP_ID" jdbcType="INTEGER" property="adGroupId" />
    <result column="CAMPAIGN_ID" jdbcType="INTEGER" property="campaignId" />
    <result column="AD_GROUP_NAME" jdbcType="VARCHAR" property="adGroupName" />
    <result column="ADD_TIME" property="statisticTime" jdbcType="TIMESTAMP" />
    <result column="CLICK_NUM" property="clickNum" jdbcType="INTEGER" />
    <result column="SHOW_NUM" property="showNum" jdbcType="INTEGER" />
    <result column="COST" property="cost" jdbcType="DECIMAL" />
    <result column="AVG_CLICK" property="avgClick" jdbcType="DECIMAL" />
    <result column="CLICK_RATE" property="clickRate" jdbcType="INTEGER" />
  </resultMap>
  <!--根据CAMPAIGN_ID查询所有的广告组信息 gaowendong增加 -->

  <select id="selectAdGroupAll" parameterClass="com.mitian.airad.model.CoreCampaign" resultMap="ibatorgenerated_BaseResultMap">

    select AD_GROUP_ID, CAMPAIGN_ID, AD_GROUP_NAME, AD_TAG_TYPE, AD_LOCL_TYPE, AD_LOCL_INFO,
      AD_FLOW_INFO, CHANGCE_INFO, AD_TAG_SEX, AD_TAG_AGE, AD_TAG_SOFT_TYPE, AD_TAG_SP, BLOCKING,
      SUSPEND_TYPE, ADD_OPER, ADD_TIME, UPD_OPER, UPD_TIME, DEL_OPER, DEL_TIME, DEL_FLAG, MEMBER_ID,
      AD_TAG_SP_VS
    from CORE_AD_GROUP
    where CAMPAIGN_ID = #campaignId:INTEGER# AND MEMBER_ID=#memberId:LONG# and (DEL_FLAG  is null OR DEL_FLAG !='1')

  </select>
 <select id="ibatorgenerated_selectByPrimaryKey" parameterClass="com.mitian.airad.model.CoreAdGroup" resultMap="ibatorgenerated_BaseResultMap">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Jan 25 17:28:52 CST 2011.
    -->
    select AD_GROUP_ID, CAMPAIGN_ID, AD_GROUP_NAME, AD_TAG_TYPE, AD_LOCL_TYPE, AD_LOCL_INFO,
      AD_FLOW_INFO, CHANGCE_INFO, AD_TAG_SEX, AD_TAG_AGE, AD_TAG_SOFT_TYPE, AD_TAG_SP, BLOCKING,
      SUSPEND_TYPE, ADD_OPER, ADD_TIME, UPD_OPER, UPD_TIME, DEL_OPER, DEL_TIME, DEL_FLAG, MEMBER_ID,
      AD_TAG_SP_VS
    from CORE_AD_GROUP
    where AD_GROUP_ID = #adGroupId:INTEGER# and MEMBER_ID=#memberId:LONG#
  </select>
   <!-- 查询（条数） -->
  <select id="findCount" resultClass="java.lang.Integer" parameterClass="java.util.HashMap">
      select count(*) from CORE_AD_GROUP  WHERE (DEL_FLAG  is null OR DEL_FLAG !='1') AND MEMBER_ID=#memberId#
      <isNotEmpty prepend="AND" property="adGroupName">
          AD_GROUP_NAME like  '%$adGroupName$%'
           <isNotNull property="escape">
           $escape$
           </isNotNull>
      </isNotEmpty>
 </select>
   <!-- 查询时间段所有统计分页 -->
    <select id="ibatorgenerated_selectAllGroupByTimeSlot" resultMap="ibatorgenerated_BaseResultMap_adGroupDetial" parameterClass="java.util.HashMap" >
      select IFNULL(c.CNT,0) CNT,a.SUSPEND_TYPE,a.AD_GROUP_ID, a.AD_GROUP_NAME,a.CAMPAIGN_ID, IFNULL(b.COST,0)COST, IFNULL(b.SHOW_NUM,0)SHOW_NUM, IFNULL( b.CLICK_NUM,0)CLICK_NUM,
      IFNULL( b.CLICK_RATE,0)CLICK_RATE,  IFNULL( b.AVG_CLICK,0)AVG_CLICK,b.ADD_TIME ADD_TIME
      from  CORE_AD_GROUP a
      LEFT JOIN (SELECT COUNT(AD_ID)  CNT,AD_GROUP_ID  FROM CORE_AD  WHERE  MEMBER_ID=#memberId# AND (DEL_FLAG  is null OR DEL_FLAG !='1') GROUP BY AD_GROUP_ID)c
      ON c. AD_GROUP_ID=a.AD_GROUP_ID
      left join (SELECT AD_GROUP_ID,SUM(SHOW_NUM) SHOW_NUM,SUM(CLICK_NUM) CLICK_NUM,
        CASE WHEN IFNULL(SUM(SHOW_NUM),0)>0
        THEN SUM(CLICK_NUM ) / SUM(SHOW_NUM)
        ELSE 0 END CLICK_RATE,SUM(SHOW_MONEY+CLICK_MONEY) COST,
        CASE WHEN IFNULL(SUM(CLICK_NUM),0)>0
        THEN SUM(CLICK_MONEY ) / SUM(CLICK_NUM)
        ELSE 0 END AVG_CLICK,ADD_TIME
        from STAT_AD  where ADVERTISER_ID=#memberId#
        <isNotNull prepend="and" property="startTime">
        <![CDATA[
             ADD_TIME>=#startTime#
        ]]>
        </isNotNull>
        <isNotNull prepend="and" property="endTime">
        <![CDATA[
             ADD_TIME <= #endTime#
        ]]>
        </isNotNull>
        GROUP BY AD_GROUP_ID) b
        on a.AD_GROUP_ID=b.AD_GROUP_ID
        WHERE (a.DEL_FLAG  is null OR a.DEL_FLAG !='1') AND a.MEMBER_ID=#memberId#
         <isNotEmpty prepend="AND" property="campaignId">
            a.CAMPAIGN_ID=#campaignId#
         </isNotEmpty>
         <isNotEmpty prepend="AND" property="adGroupName">
            a.AD_GROUP_NAME like  '%$adGroupName$%'
         </isNotEmpty>
        GROUP BY a.AD_GROUP_ID
        <dynamic prepend="order by">
        a.ADD_TIME DESC
        </dynamic>
        <isNotEmpty property="fromRecord">
          limit $fromRecord$,$pageSize$
        </isNotEmpty>
  </select>
  <!-- 查询所有的广告组信息 -->
    <select id="ibatorgenerated_selectAllGroup" resultMap="ibatorgenerated_BaseResultMap_adGroupDetial" parameterClass="java.util.HashMap" >
      select IFNULL(c.CNT,0) CNT,a.SUSPEND_TYPE,a.AD_GROUP_ID, a.AD_GROUP_NAME,a.CAMPAIGN_ID, IFNULL(b.COST,0)COST, IFNULL(b.SHOW_NUM,0)SHOW_NUM, IFNULL( b.CLICK_NUM,0)CLICK_NUM,
      IFNULL( b.CLICK_RATE,0)CLICK_RATE,  IFNULL( b.AVG_CLICK,0)AVG_CLICK,a.ADD_TIME
      from  CORE_AD_GROUP a
      LEFT JOIN (SELECT COUNT(AD_ID)  CNT,AD_GROUP_ID  FROM CORE_AD  WHERE  MEMBER_ID=#memberId# AND DEL_FLAG!=1 GROUP BY AD_GROUP_ID)c
      ON c. AD_GROUP_ID=a.AD_GROUP_ID
      left join (SELECT AD_GROUP_ID,SUM(SHOW_NUM) SHOW_NUM,SUM(CLICK_NUM) CLICK_NUM,
        CASE WHEN IFNULL(SUM(SHOW_NUM),0)>0
        THEN SUM(CLICK_NUM ) / SUM(SHOW_NUM)
        ELSE 0 END CLICK_RATE,SUM(SHOW_MONEY+CLICK_MONEY) COST,
        CASE WHEN IFNULL(SUM(CLICK_NUM),0)>0
        THEN SUM(CLICK_MONEY ) / SUM(CLICK_NUM)
        ELSE 0 END AVG_CLICK,ADD_TIME
        from STAT_AD   GROUP BY AD_GROUP_ID) b
        on a.AD_GROUP_ID=b.AD_GROUP_ID
      WHERE (a.DEL_FLAG  is null OR a.DEL_FLAG !='1') AND a.MEMBER_ID=#memberId#
      <isNotEmpty prepend="AND" property="campaignId">
     a.CAMPAIGN_ID=#campaignId#
    </isNotEmpty>
     <isNotEmpty prepend="AND" property="adGroupName">
    a.AD_GROUP_NAME like  '%$adGroupName$%'
     <isNotNull property="escape">
           $escape$
           </isNotNull>
    </isNotEmpty>
    GROUP BY a.AD_GROUP_ID
    <dynamic prepend="order by">
        a.ADD_TIME DESC
    </dynamic>
    <isNotEmpty property="fromRecord">
      limit $fromRecord$,$pageSize$
    </isNotEmpty>
  </select>

   <!-- 根据会员id 查询所 有的广告组信息 -->
    <select id="ibatorgenerated_selectAllGroupByMemberId" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.mitian.airad.model.CoreAdGroup" >
     select AD_GROUP_ID, CAMPAIGN_ID, AD_GROUP_NAME, AD_TAG_TYPE, AD_LOCL_TYPE, AD_LOCL_INFO,
      AD_FLOW_INFO, CHANGCE_INFO, AD_TAG_SEX, AD_TAG_AGE, AD_TAG_SOFT_TYPE, AD_TAG_SP, BLOCKING,
      SUSPEND_TYPE, ADD_OPER, ADD_TIME, UPD_OPER, UPD_TIME, DEL_OPER, DEL_TIME, DEL_FLAG, MEMBER_ID,
      AD_TAG_SP_VS
    from CORE_AD_GROUP
    where MEMBER_ID = #memberId#
  </select>
  <insert id="ibatorgenerated_insert" parameterClass="com.mitian.airad.model.CoreAdGroup">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Jan 25 17:28:52 CST 2011.
    -->
    insert into CORE_AD_GROUP (AD_GROUP_ID, CAMPAIGN_ID, AD_GROUP_NAME, AD_TAG_TYPE, AD_LOCL_TYPE,
      AD_LOCL_INFO, AD_FLOW_INFO, CHANGCE_INFO, AD_TAG_SEX, AD_TAG_AGE, AD_TAG_SOFT_TYPE, AD_TAG_SP,
      BLOCKING, SUSPEND_TYPE, ADD_OPER, ADD_TIME, UPD_OPER, UPD_TIME, DEL_OPER, DEL_TIME, DEL_FLAG,
      MEMBER_ID, AD_TAG_SP_VS)
    values (#adGroupId:INTEGER#, #campaignId:INTEGER#, #adGroupName:VARCHAR#, #adTagType:CHAR#,
      #adLoclType:CHAR#, #adLoclInfo:VARCHAR#, #adFlowInfo:VARCHAR#, #changceInfo:VARCHAR#,
      #adTagSex:CHAR#, #adTagAge:CHAR#, #adTagSoftType:CHAR#, #adTagSp:CHAR#, #blocking:CHAR#,
      #suspendType:CHAR#, #addOper:VARCHAR#, #addTime:TIMESTAMP#, #updOper:VARCHAR#,
      #updTime:TIMESTAMP#, #delOper:VARCHAR#, #delTime:TIMESTAMP#, #delFlag:CHAR#,
      #memberId:LONG#, #adTagSpVs:CHAR#)
      <selectKey resultClass="int" keyProperty="adGroupId" type="post" >
            SELECT @@IDENTITY AS ID
       </selectKey>
  </insert>
  <insert id="ibatorgenerated_insertSelective" parameterClass="com.mitian.airad.model.CoreAdGroup">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Jan 25 17:28:52 CST 2011.
    -->
    insert into CORE_AD_GROUP
    <dynamic prepend="(">
      <isNotNull prepend="," property="campaignId">
        CAMPAIGN_ID
      </isNotNull>
      <isNotNull prepend="," property="adGroupName">
        AD_GROUP_NAME
      </isNotNull>
      <isNotNull prepend="," property="adTagType">
        AD_TAG_TYPE
      </isNotNull>
      <isNotNull prepend="," property="adLoclType">
        AD_LOCL_TYPE
      </isNotNull>
      <isNotNull prepend="," property="adLoclInfo">
        AD_LOCL_INFO
      </isNotNull>
      <isNotNull prepend="," property="adFlowInfo">
        AD_FLOW_INFO
      </isNotNull>
      <isNotNull prepend="," property="changceInfo">
        CHANGCE_INFO
      </isNotNull>
      <isNotNull prepend="," property="adTagSex">
        AD_TAG_SEX
      </isNotNull>
      <isNotNull prepend="," property="adTagAge">
        AD_TAG_AGE
      </isNotNull>
      <isNotNull prepend="," property="adTagSoftType">
        AD_TAG_SOFT_TYPE
      </isNotNull>
      <isNotNull prepend="," property="adTagSp">
        AD_TAG_SP
      </isNotNull>
      <isNotNull prepend="," property="blocking">
        BLOCKING
      </isNotNull>
      <isNotNull prepend="," property="suspendType">
        SUSPEND_TYPE
      </isNotNull>
      <isNotNull prepend="," property="addOper">
        ADD_OPER
      </isNotNull>
      <isNotNull prepend="," property="addTime">
        ADD_TIME
      </isNotNull>
      <isNotNull prepend="," property="updOper">
        UPD_OPER
      </isNotNull>
      <isNotNull prepend="," property="updTime">
        UPD_TIME
      </isNotNull>
      <isNotNull prepend="," property="delOper">
        DEL_OPER
      </isNotNull>
      <isNotNull prepend="," property="delTime">
        DEL_TIME
      </isNotNull>
      <isNotNull prepend="," property="delFlag">
        DEL_FLAG
      </isNotNull>
      <isNotNull prepend="," property="memberId">
        MEMBER_ID
      </isNotNull>
      <isNotNull prepend="," property="adTagSpVs">
        AD_TAG_SP_VS
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(">
      <isNotNull prepend="," property="campaignId">
        #campaignId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="adGroupName">
        #adGroupName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="adTagType">
        #adTagType:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="adLoclType">
        #adLoclType:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="adLoclInfo">
        #adLoclInfo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="adFlowInfo">
        #adFlowInfo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="changceInfo">
        #changceInfo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="adTagSex">
        #adTagSex:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="adTagAge">
        #adTagAge:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="adTagSoftType">
        #adTagSoftType:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="adTagSp">
        #adTagSp:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="blocking">
        #blocking:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="suspendType">
        #suspendType:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="addOper">
        #addOper:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="addTime">
        #addTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="updOper">
        #updOper:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="updTime">
        #updTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="delOper">
        #delOper:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="delTime">
        #delTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="delFlag">
        #delFlag:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="memberId">
        #memberId:LONG#
      </isNotNull>
      <isNotNull prepend="," property="adTagSpVs">
        #adTagSpVs:CHAR#
      </isNotNull>
      )
    </dynamic>
    <selectKey resultClass="int" keyProperty="adGroupId" type="post" >
               SELECT @@IDENTITY AS ID
           </selectKey>
  </insert>
  <update id="ibatorgenerated_updateByPrimaryKeySelective" parameterClass="com.mitian.airad.model.CoreAdGroup">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Jan 25 17:28:52 CST 2011.
    -->
    update CORE_AD_GROUP
    <dynamic prepend="set">
      <isNotNull prepend="," property="campaignId">
        CAMPAIGN_ID = #campaignId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="adGroupName">
        AD_GROUP_NAME = #adGroupName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="adTagType">
        AD_TAG_TYPE = #adTagType:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="adLoclType">
        AD_LOCL_TYPE = #adLoclType:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="adLoclInfo">
        AD_LOCL_INFO = #adLoclInfo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="adFlowInfo">
        AD_FLOW_INFO = #adFlowInfo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="changceInfo">
        CHANGCE_INFO = #changceInfo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="adTagSex">
        AD_TAG_SEX = #adTagSex:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="adTagAge">
        AD_TAG_AGE = #adTagAge:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="adTagSoftType">
        AD_TAG_SOFT_TYPE = #adTagSoftType:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="adTagSp">
        AD_TAG_SP = #adTagSp:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="blocking">
        BLOCKING = #blocking:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="suspendType">
        SUSPEND_TYPE = #suspendType:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="addOper">
        ADD_OPER = #addOper:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="addTime">
        ADD_TIME = #addTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="updOper">
        UPD_OPER = #updOper:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="updTime">
        UPD_TIME = #updTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="delOper">
        DEL_OPER = #delOper:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="delTime">
        DEL_TIME = #delTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="delFlag">
        DEL_FLAG = #delFlag:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="adTagSpVs">
        AD_TAG_SP_VS = #adTagSpVs:CHAR#
      </isNotNull>
    </dynamic>
    where AD_GROUP_ID = #adGroupId:INTEGER# and MEMBER_ID = #memberId:LONG# and (DEL_FLAG  is null OR DEL_FLAG !='1')
  </update>

  <!-- 根据会员id分页查询广告组列表 -->
    <select id="ibatorgenerated_selectGroupByMemberIdByPage" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.mitian.airad.model.CoreAdGroup" >
     select AD_GROUP_ID, CAMPAIGN_ID, AD_GROUP_NAME, AD_TAG_TYPE, AD_LOCL_TYPE, AD_LOCL_INFO,
      AD_FLOW_INFO, CHANGCE_INFO, AD_TAG_SEX, AD_TAG_AGE, AD_TAG_SOFT_TYPE, AD_TAG_SP, BLOCKING,
      SUSPEND_TYPE, ADD_OPER, ADD_TIME, UPD_OPER, UPD_TIME, DEL_OPER, DEL_TIME, DEL_FLAG, MEMBER_ID,
      AD_TAG_SP_VS
    from CORE_AD_GROUP
    where MEMBER_ID = #memberId#
  </select>
</sqlMap>