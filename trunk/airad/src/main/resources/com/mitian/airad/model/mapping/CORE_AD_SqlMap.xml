<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="CORE_AD">
    	<resultMap id="ibatorgenerated_BaseResultMap" class="com.mitian.airad.model.CoreAd">
        <!--
            WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify. This element was
            generated on Sat Mar 12 17:16:12 CST 2011.
        -->
        <result column="AD_ID" property="adId" jdbcType="INTEGER" />
        <result column="WAP_ID" property="wapId" jdbcType="INTEGER" />
        <result column="AD_GROUP_ID" property="adGroupId" jdbcType="INTEGER" />
        <result column="RICH_ID" property="richId" jdbcType="INTEGER" />
        <result column="BANNER_ID" property="bannerId" jdbcType="INTEGER" />
        <result column="AD_NAME" property="adName" jdbcType="VARCHAR" />
        <result column="AD_DETAIL_INFO" property="adDetailInfo" jdbcType="VARCHAR" />
        <result column="SUSPEND_TYPE" property="suspendType" jdbcType="CHAR" />
        <result column="AD_OFFER" property="adOffer" jdbcType="DECIMAL" />
        <result column="AD_TYPE" property="adType" jdbcType="CHAR" />
        <result column="AD_CHILD_NUM" property="adChildNum" jdbcType="INTEGER" />
        <result column="FLAG" property="flag" jdbcType="CHAR" />
        <result column="BLOCKING" property="blocking" jdbcType="CHAR" />
        <result column="ADD_OPER" property="addOper" jdbcType="VARCHAR" />
        <result column="ADD_TIME" property="addTime" jdbcType="TIMESTAMP" />
        <result column="UPD_OPER" property="updOper" jdbcType="VARCHAR" />
        <result column="UPD_TIME" property="updTime" jdbcType="TIMESTAMP" />
        <result column="DEL_OPER" property="delOper" jdbcType="VARCHAR" />
        <result column="DEL_TIME" property="delTime" jdbcType="TIMESTAMP" />
        <result column="DEL_FLAG" property="delFlag" jdbcType="CHAR" />
        <result column="MEMBER_ID" property="memberId" jdbcType="LONG" />
        <result column="CAMPAIGN_ID" property="campaignId" jdbcType="INTEGER" />
        <result column="BACKGROUND" property="background" jdbcType="INTEGER" />
    </resultMap>
    <resultMap id="ibatorgenerated_BaseResultMap_adDetial" class="com.mitian.airad.model.CoreAd">
        <result column="FLAG" property="flag" jdbcType="CHAR" />
        <result column="BLOCKING" property="blocking" jdbcType="CHAR" />
        <result column="AD_ID" property="adId" jdbcType="INTEGER" />
        <result column="AD_OFFER" property="adOffer" jdbcType="DECIMAL" />
        <result column="AD_NAME" property="adName" jdbcType="VARCHAR" />
        <result column="ADD_TIME" property="addTime" jdbcType="TIMESTAMP" />
        <result column="SUSPEND_TYPE" jdbcType="CHAR" property="suspendType" />
        <result column="AD_GROUP_ID" jdbcType="INTEGER" property="adGroupId" />
        <result column="CAMPAIGN_ID" jdbcType="INTEGER" property="campaignId" />
        <result column="CLICK_NUM" property="clickNum" jdbcType="INTEGER" />
        <result column="SHOW_NUM" property="showNum" jdbcType="INTEGER" />
        <result column="COST" property="cost" jdbcType="DECIMAL" />
        <result column="AVG_CLICK" property="avgClick" jdbcType="DECIMAL" />
        <result column="CLICK_RATE" property="clickRate" jdbcType="INTEGER" />
  </resultMap>
  <!--根据广告id查询数据和用户id   孙悦平-->
    <select id="ibatorgenerated_selectByPrimaryKeyMemberId" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.mitian.airad.model.CoreAd">
        <!--
            WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify. This element was
            generated on Sat Mar 12 17:16:12 CST 2011.
        -->
        select AD_ID, WAP_ID, AD_GROUP_ID, RICH_ID, BANNER_ID, AD_NAME, AD_DETAIL_INFO, SUSPEND_TYPE, AD_OFFER, AD_TYPE,
        AD_CHILD_NUM, FLAG, BLOCKING, ADD_OPER, ADD_TIME, UPD_OPER, UPD_TIME, DEL_OPER, DEL_TIME, DEL_FLAG, MEMBER_ID,
        CAMPAIGN_ID,BACKGROUND from CORE_AD where AD_ID = #adId:INTEGER# and MEMBER_ID = #memberId:LONG# 
    </select>
    <select id="selectAdAll" parameterClass="com.mitian.airad.model.CoreAdGroup" resultMap="ibatorgenerated_BaseResultMap">
        <!--根据AD_GROUP_ID查询所有的广告组信息 gaowendong增加    -->
        select AD_ID, WAP_ID, AD_GROUP_ID, RICH_ID, BANNER_ID, AD_NAME, AD_DETAIL_INFO, SUSPEND_TYPE, AD_OFFER, AD_TYPE,AD_CHILD_NUM,
        FLAG, BLOCKING, ADD_OPER, ADD_TIME, UPD_OPER, UPD_TIME, DEL_OPER, DEL_TIME, DEL_FLAG, MEMBER_ID,CAMPAIGN_ID,BACKGROUND from
        CORE_AD where AD_GROUP_ID = #adGroupId:INTEGER# and MEMBER_ID=#memberId:LONG# and (DEL_FLAG  is null OR DEL_FLAG !='1')
    </select>
 <!-- 查询时间段所有统计分页（条数） -->
  <select id="findCount" resultClass="java.lang.Integer" parameterClass="java.util.HashMap">
      select count(*) from CORE_AD   WHERE (DEL_FLAG  is null OR DEL_FLAG !='1') AND MEMBER_ID=#memberId# 
       <isNotEmpty prepend="AND" property="adGroupId">
        AD_GROUP_ID=#adGroupId#
        </isNotEmpty>
       <isNotEmpty prepend="AND" property="adName">
        AD_NAME like  '%$adName$%' 
         <isNotNull property="escape">
           $escape$
           </isNotNull>
        </isNotEmpty>
 </select>
 <!--查询时间段所有统计分页 -->
    <select id="selectAdAllByTimeSlot" parameterClass="java.util.HashMap" resultMap="ibatorgenerated_BaseResultMap_adDetial">
         select 
         a.AD_ID,a.AD_GROUP_ID,a.AD_NAME, a.SUSPEND_TYPE, a.AD_OFFER,a.ADD_TIME,a.CAMPAIGN_ID,a.BLOCKING,a.FLAG,
         IFNULL(b.COST,0)COST, IFNULL(b.SHOW_NUM,0)SHOW_NUM, IFNULL( b.CLICK_NUM,0)CLICK_NUM,
         IFNULL( b.CLICK_RATE,0)CLICK_RATE,  IFNULL( b.AVG_CLICK,0)AVG_CLICK,a.ADD_TIME
         from  CORE_AD a left join 
         (SELECT AD_ID,AD_GROUP_ID,SUM(SHOW_NUM) SHOW_NUM,SUM(CLICK_NUM) CLICK_NUM,
         CASE WHEN IFNULL(SUM(SHOW_NUM),0)>0 
         THEN SUM(CLICK_NUM ) / SUM(SHOW_NUM)
         ELSE 0 END CLICK_RATE,SUM(SHOW_MONEY+CLICK_MONEY) COST,
         CASE WHEN IFNULL(SUM(CLICK_NUM),0)>0 
         THEN SUM(CLICK_MONEY ) / SUM(CLICK_NUM)
         ELSE 0 END AVG_CLICK,ADD_TIME
         from STAT_AD where 1=1
       <isNotNull prepend="and" property="startTime">
        <![CDATA[
             ADD_TIME>=#startTime#
        ]]>
        </isNotNull>
        <isNotNull prepend="and" property="endTime">
        <![CDATA[
             ADD_TIME <= #endTime#
        ]]>
        </isNotNull>
        
         GROUP BY AD_ID) b 
         on a.AD_ID=b.AD_ID
         WHERE (a.DEL_FLAG  is null OR a.DEL_FLAG !='1') AND a.MEMBER_ID=#memberId#
         <isNotEmpty prepend="AND" property="adGroupId">
            a.AD_GROUP_ID=#adGroupId#
         </isNotEmpty>
         <isNotEmpty prepend="AND" property="adName">
            a.AD_NAME like  '%$adName$%'
         </isNotEmpty>
        GROUP BY a.AD_ID
         <dynamic prepend="order by">
        <isNotNull property="desc">
            a.ADD_TIME DESC
        </isNotNull>
        <isNull property="desc">
            a.ADD_TIME ASC
        </isNull>
         </dynamic>
        <isNotEmpty property="fromRecord">
         limit $fromRecord$,$pageSize$
        </isNotEmpty>
    </select>

    <!--根据广告组ID查询所有的广告组信息  wangzhongwei -->
    <select id="selectAdAllByAdGroupId" parameterClass="java.util.HashMap" resultMap="ibatorgenerated_BaseResultMap_adDetial">
         select 
         a.AD_ID,a.AD_GROUP_ID,a.AD_NAME, a.SUSPEND_TYPE, a.AD_OFFER,a.ADD_TIME,a.CAMPAIGN_ID,a.BLOCKING,a.FLAG,
         IFNULL(b.COST,0)COST, IFNULL(b.SHOW_NUM,0)SHOW_NUM, IFNULL( b.CLICK_NUM,0)CLICK_NUM,
         IFNULL( b.CLICK_RATE,0)CLICK_RATE,  IFNULL( b.AVG_CLICK,0)AVG_CLICK,a.ADD_TIME
         from  CORE_AD a left join 
         (SELECT AD_ID,AD_GROUP_ID,SUM(SHOW_NUM) SHOW_NUM,SUM(CLICK_NUM) CLICK_NUM,
         CASE WHEN IFNULL(SUM(SHOW_NUM),0)>0 
         THEN SUM(CLICK_NUM ) / SUM(SHOW_NUM)
         ELSE 0 END CLICK_RATE,SUM(SHOW_MONEY+CLICK_MONEY) COST,
         CASE WHEN IFNULL(SUM(CLICK_NUM),0)>0 
         THEN SUM(CLICK_MONEY ) / SUM(CLICK_NUM)
         ELSE 0 END AVG_CLICK,ADD_TIME
         from STAT_AD  where ADVERTISER_ID=#memberId#  GROUP BY AD_ID) b 
         on a.AD_ID=b.AD_ID
         WHERE (a.DEL_FLAG  is null OR a.DEL_FLAG !='1') AND a.MEMBER_ID=#memberId#  
        <isNotEmpty prepend="AND" property="adGroupId">
        a.AD_GROUP_ID=#adGroupId#
        </isNotEmpty>
         <isNotEmpty prepend="AND" property="adName">
        a.AD_NAME like  '%$adName$%'  
         <isNotNull property="escape">
           $escape$
           </isNotNull>
        </isNotEmpty>
        GROUP BY a.AD_ID
        <dynamic prepend="order by">
        <isNotNull property="desc">
            a.ADD_TIME DESC
        </isNotNull>
        <isNull property="desc">
            a.ADD_TIME ASC
        </isNull>
         </dynamic>
        <isNotEmpty property="fromRecord">
          limit $fromRecord$,$pageSize$
        </isNotEmpty>
    </select>
    <!--根据会员ID查询所有的广告信息  -->
    <select id="selectAdAllByMemberId" parameterClass="java.lang.Long" resultMap="ibatorgenerated_BaseResultMap"> select AD_ID, WAP_ID,
        AD_GROUP_ID, RICH_ID, BANNER_ID, AD_NAME, AD_DETAIL_INFO, SUSPEND_TYPE, AD_OFFER, AD_TYPE,AD_CHILD_NUM, FLAG, BLOCKING,
        ADD_OPER, ADD_TIME, UPD_OPER, UPD_TIME, DEL_OPER, DEL_TIME, DEL_FLAG, MEMBER_ID,CAMPAIGN_ID,BACKGROUND from CORE_AD where
        MEMBER_ID = #memberId# 
    </select>
    <insert id="ibatorgenerated_insert" parameterClass="com.mitian.airad.model.CoreAd">
        <!--
            WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify. This element was
            generated on Sat Mar 12 17:16:12 CST 2011.
        -->
        insert into CORE_AD (AD_ID, WAP_ID, AD_GROUP_ID, RICH_ID, BANNER_ID, AD_NAME, AD_DETAIL_INFO, SUSPEND_TYPE,
        AD_OFFER, AD_TYPE, AD_CHILD_NUM, FLAG, BLOCKING, ADD_OPER, ADD_TIME, UPD_OPER, UPD_TIME, DEL_OPER, DEL_TIME,
        DEL_FLAG, MEMBER_ID, CAMPAIGN_ID, BACKGROUND) values (#adId:INTEGER#, #wapId:INTEGER#, #adGroupId:INTEGER#,
        #richId:INTEGER#, #bannerId:INTEGER#, #adName:VARCHAR#, #adDetailInfo:VARCHAR#, #suspendType:CHAR#,
        #adOffer:DECIMAL#, #adType:CHAR#, #adChildNum:INTEGER#, #flag:CHAR#, #blocking:CHAR#, #addOper:VARCHAR#,
        #addTime:TIMESTAMP#, #updOper:VARCHAR#, #updTime:TIMESTAMP#, #delOper:VARCHAR#, #delTime:TIMESTAMP#,
        #delFlag:CHAR#, #memberId:LONG#, #campaignId:INTEGER#, #background:INTEGER#)
    </insert>
    <insert id="ibatorgenerated_insertSelective" parameterClass="com.mitian.airad.model.CoreAd">
        <!--
            WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify. This element was
            generated on Sat Mar 12 17:16:12 CST 2011.
        -->
        insert into CORE_AD
        <dynamic prepend="(">
            <isNotNull prepend="," property="adId"> AD_ID</isNotNull>
            <isNotNull prepend="," property="wapId"> WAP_ID</isNotNull>
            <isNotNull prepend="," property="adGroupId"> AD_GROUP_ID</isNotNull>
            <isNotNull prepend="," property="richId"> RICH_ID</isNotNull>
            <isNotNull prepend="," property="bannerId"> BANNER_ID</isNotNull>
            <isNotNull prepend="," property="adName"> AD_NAME</isNotNull>
            <isNotNull prepend="," property="adDetailInfo"> AD_DETAIL_INFO</isNotNull>
            <isNotNull prepend="," property="suspendType"> SUSPEND_TYPE</isNotNull>
            <isNotNull prepend="," property="adOffer"> AD_OFFER</isNotNull>
            <isNotNull prepend="," property="adType"> AD_TYPE</isNotNull>
            <isNotNull prepend="," property="adChildNum">AD_CHILD_NUM</isNotNull>
            <isNotNull prepend="," property="flag"> FLAG</isNotNull>
            <isNotNull prepend="," property="blocking"> BLOCKING</isNotNull>
            <isNotNull prepend="," property="addOper"> ADD_OPER</isNotNull>
            <isNotNull prepend="," property="addTime"> ADD_TIME</isNotNull>
            <isNotNull prepend="," property="updOper"> UPD_OPER</isNotNull>
            <isNotNull prepend="," property="updTime"> UPD_TIME</isNotNull>
            <isNotNull prepend="," property="delOper"> DEL_OPER</isNotNull>
            <isNotNull prepend="," property="delTime"> DEL_TIME</isNotNull>
            <isNotNull prepend="," property="delFlag"> DEL_FLAG</isNotNull>
            <isNotNull prepend="," property="memberId"> MEMBER_ID</isNotNull>
            <isNotNull prepend="," property="campaignId"> CAMPAIGN_ID</isNotNull>
            <isNotNull prepend="," property="background"> BACKGROUND</isNotNull>
            <isNotNull prepend="," property="paymentType"> PAYMENT_TYPE</isNotNull>
            )
        </dynamic>
        values
        <dynamic prepend="(">
            <isNotNull prepend="," property="adId"> #adId:INTEGER#</isNotNull>
            <isNotNull prepend="," property="wapId"> #wapId:INTEGER#</isNotNull>
            <isNotNull prepend="," property="adGroupId"> #adGroupId:INTEGER#</isNotNull>
            <isNotNull prepend="," property="richId"> #richId:INTEGER#</isNotNull>
            <isNotNull prepend="," property="bannerId"> #bannerId:INTEGER#</isNotNull>
            <isNotNull prepend="," property="adName"> #adName:VARCHAR#</isNotNull>
            <isNotNull prepend="," property="adDetailInfo"> #adDetailInfo:VARCHAR#</isNotNull>
            <isNotNull prepend="," property="suspendType"> #suspendType:CHAR#</isNotNull>
            <isNotNull prepend="," property="adOffer"> #adOffer:DECIMAL#</isNotNull>
            <isNotNull prepend="," property="adType"> #adType:CHAR#</isNotNull>
            <isNotNull prepend="," property="adChildNum"> #adChildNum:INTEGER#</isNotNull>
            <isNotNull prepend="," property="flag"> #flag:CHAR#</isNotNull>
            <isNotNull prepend="," property="blocking"> #blocking:CHAR#</isNotNull>
            <isNotNull prepend="," property="addOper"> #addOper:VARCHAR#</isNotNull>
            <isNotNull prepend="," property="addTime"> #addTime:TIMESTAMP#</isNotNull>
            <isNotNull prepend="," property="updOper"> #updOper:VARCHAR#</isNotNull>
            <isNotNull prepend="," property="updTime"> #updTime:TIMESTAMP#</isNotNull>
            <isNotNull prepend="," property="delOper"> #delOper:VARCHAR#</isNotNull>
            <isNotNull prepend="," property="delTime"> #delTime:TIMESTAMP#</isNotNull>
            <isNotNull prepend="," property="delFlag"> #delFlag:CHAR#</isNotNull>
            <isNotNull prepend="," property="memberId"> #memberId:LONG#</isNotNull>
            <isNotNull prepend="," property="campaignId"> #campaignId:INTEGER#</isNotNull>
            <isNotNull prepend="," property="background"> #background:INTEGER#</isNotNull>
            <isNotNull prepend="," property="paymentType">#paymentType:VARCHAR#</isNotNull>
            )
        </dynamic>
        <selectKey resultClass="int" keyProperty="adId" type="post"> SELECT @@IDENTITY AS ID</selectKey>
    </insert>
    <update id="ibatorgenerated_updateByPrimaryKeySelective" parameterClass="com.mitian.airad.model.CoreAd">
        <!--
            WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify. This element was
            generated on Sat Mar 12 17:16:12 CST 2011.
        -->
        update CORE_AD
        <dynamic prepend="set">
            <isNotNull prepend="," property="wapId"> WAP_ID = #wapId:INTEGER#</isNotNull>
            <isNotNull prepend="," property="adGroupId"> AD_GROUP_ID = #adGroupId:INTEGER#</isNotNull>
            <isNotNull prepend="," property="richId"> RICH_ID = #richId:INTEGER#</isNotNull>
            <isNotNull prepend="," property="bannerId"> BANNER_ID = #bannerId:INTEGER#</isNotNull>
            <isNotNull prepend="," property="adName"> AD_NAME = #adName:VARCHAR#</isNotNull>
            <isNotNull prepend="," property="adDetailInfo"> AD_DETAIL_INFO = #adDetailInfo:VARCHAR#
            </isNotNull>
            <isNotNull prepend="," property="suspendType"> SUSPEND_TYPE = #suspendType:CHAR#</isNotNull>
            <isNotNull prepend="," property="adOffer"> AD_OFFER = #adOffer:DECIMAL#</isNotNull>
            <isNotNull prepend="," property="adType"> AD_TYPE = #adType:CHAR#</isNotNull>
            <isNotNull prepend="," property="adChildNum"> AD_CHILD_NUM = #adChildNum:INTEGER#</isNotNull>
            <isNotNull prepend="," property="flag"> FLAG = #flag:CHAR#</isNotNull>
            <isNotNull prepend="," property="blocking"> BLOCKING = #blocking:CHAR#</isNotNull>
            <isNotNull prepend="," property="addOper"> ADD_OPER = #addOper:VARCHAR#</isNotNull>
            <isNotNull prepend="," property="addTime"> ADD_TIME = #addTime:TIMESTAMP#</isNotNull>
            <isNotNull prepend="," property="updOper"> UPD_OPER = #updOper:VARCHAR#</isNotNull>
            <isNotNull prepend="," property="updTime"> UPD_TIME = #updTime:TIMESTAMP#</isNotNull>
            <isNotNull prepend="," property="delOper"> DEL_OPER = #delOper:VARCHAR#</isNotNull>
            <isNotNull prepend="," property="delTime"> DEL_TIME = #delTime:TIMESTAMP#</isNotNull>
            <isNotNull prepend="," property="delFlag"> DEL_FLAG = #delFlag:CHAR#</isNotNull>
            <isNotNull prepend="," property="memberId"> MEMBER_ID = #memberId:LONG#</isNotNull>
            <isNotNull prepend="," property="campaignId"> CAMPAIGN_ID = #campaignId:INTEGER#</isNotNull>
            <isNotNull prepend="," property="background"> BACKGROUND = #background:INTEGER#</isNotNull>
            <isNotNull prepend="," property="paymentType"> PAYMENT_TYPE = #paymentType:VARCHAR#</isNotNull>
        </dynamic>
        where AD_ID = #adId:INTEGER# AND MEMBER_ID=#memberId:LONG# and DEL_FLAG !='1'
    </update>

  <resultMap class="com.mitian.airad.model.CoreAd4Index" id="coreAd4IndexMapping">
    <result column="AD_ID" jdbcType="INTEGER" property="adId" />
    <result column="AD_NAME" jdbcType="VARCHAR" property="adName" />
    <result column="AD_OFFER" jdbcType="DECIMAL" property="adOffer" />
    <result column="DEL_FLAG" jdbcType="CHAR" property="delFlag" />
    <result column="AD_TAG_SEX" jdbcType="CHAR" property="adTagSex" />
    <result column="AD_TAG_AGE" jdbcType="CHAR" property="adTagAge" />
    <result column="AD_TAG_SOFT_TYPE" jdbcType="CHAR" property="adTagSoftType" />
    <result column="AD_TAG_SP" jdbcType="CHAR" property="adTagSp" />
    <result column="GEOGRAPHICAL_POSITION" property="geographicalPosition" jdbcType="LONGVARCHAR" />
    <result column="START_TIME" jdbcType="TIMESTAMP" property="startTime" />
    <result column="END_TIME" jdbcType="TIMESTAMP" property="endTime" />
    <result column="UPD_TIME" jdbcType="TIMESTAMP" property="updTime" />
  </resultMap>  
  
    <resultMap id="ibatorgenerated_BaseResultMap_AD_Detial" class="com.mitian.airad.model.CoreAd">
        <result column="BLOCKING_COUNT" property="blockingCount" jdbcType="INTEGER" />
        <result column="ISSU_COUNT" property="issuCount" jdbcType="INTEGER" />
        <result column="SUSPEND_COUNT" property="suspendCount" jdbcType="INTEGER" />
        <result column="DRAFT_COUNT" property="draftCount" jdbcType="INTEGER" />
        <result column="CHECK_COUNT" property="checkCount" jdbcType="INTEGER" />
        <result column="CHECK_PASS_COUNT" property="checkPassCount" jdbcType="INTEGER" />
        <result column="CHECK_NO_COUNT" property="checkNoCount" jdbcType="INTEGER" />
        <result column="AD_COUNT" property="adCount" jdbcType="INTEGER" />
    </resultMap>
     <select id="selectAdAllByCampaign" parameterClass="com.mitian.airad.model.CoreAd" resultMap="ibatorgenerated_BaseResultMap_AD_Detial">
        <!--根据CAMPAIGN_ID查询所有的广告组信息    -->
        SELECT 
              SUM(IF(BLOCKING=1,1,0))  BLOCKING_COUNT 
              ,SUM(IF(SUSPEND_TYPE=1 and BLOCKING=0,1,0)) SUSPEND_COUNT
              ,SUM(IF(SUSPEND_TYPE=0 and BLOCKING=0 and FLAG=0,1,0)) DRAFT_COUNT
              ,SUM(IF(SUSPEND_TYPE=0 and BLOCKING=0 and FLAG=1,1,0)) CHECK_COUNT
              ,SUM(IF(SUSPEND_TYPE=0 and BLOCKING=0 and FLAG=2,1,0)) CHECK_PASS_COUNT
              ,SUM(IF(SUSPEND_TYPE=0 and BLOCKING=0 and FLAG=3,1,0)) CHECK_NO_COUNT
              ,SUM(IF(SUSPEND_TYPE=0 and BLOCKING=0 and FLAG=4 ,1,0)) ISSU_COUNT
              ,COUNT(AD_ID) AD_COUNT
              FROM CORE_AD where CAMPAIGN_ID = #campaignId# AND (DEL_FLAG  is null OR DEL_FLAG !='1') and MEMBER_ID=#memberId#
    </select>
    <select id="selectAdAllByAdGroup" parameterClass="com.mitian.airad.model.CoreAd" resultMap="ibatorgenerated_BaseResultMap_AD_Detial">
        <!--根据AD_GROUP_ID查询所有的广告组信息    -->
        SELECT 
              SUM(IF(BLOCKING=1,1,0))  BLOCKING_COUNT 
              ,SUM(IF(SUSPEND_TYPE=1 and BLOCKING=0,1,0)) SUSPEND_COUNT
              ,SUM(IF(SUSPEND_TYPE=0 and BLOCKING=0 and FLAG=0,1,0)) DRAFT_COUNT
              ,SUM(IF(SUSPEND_TYPE=0 and BLOCKING=0 and FLAG=1,1,0)) CHECK_COUNT
              ,SUM(IF(SUSPEND_TYPE=0 and BLOCKING=0 and FLAG=2,1,0)) CHECK_PASS_COUNT
              ,SUM(IF(SUSPEND_TYPE=0 and BLOCKING=0 and FLAG=3,1,0)) CHECK_NO_COUNT
              ,SUM(IF(SUSPEND_TYPE=0 and BLOCKING=0 and FLAG=4 ,1,0)) ISSU_COUNT
              ,COUNT(AD_ID) AD_COUNT
              FROM CORE_AD where AD_GROUP_ID = #adGroupId# AND (DEL_FLAG  is null OR DEL_FLAG !='1') and MEMBER_ID=#memberId#
    </select>
    <resultMap id="shopperAdMap" class="com.mitian.airad.model.CoreAd">
        <result column="AD_ID" property="adId" jdbcType="INTEGER" />
        <result column="AD_NAME" property="adName" jdbcType="VARCHAR" />
        <result column="START_TIME" property="startTime" jdbcType="TIMESTAMP" />
         <result column="END_TIME" property="endTime" jdbcType="TIMESTAMP" />
        <result column="AD_TAG_SP" property="platform" jdbcType="CHAR" />
        <result column="SHOW_NUM" property="showNum" jdbcType="INTEGER" />
        <result column="CLICK_NUM" property="clickNum" jdbcType="INTEGER" />
        <result column="CLICK_RATE" property="clickRate" jdbcType="INTEGER" />
         <result column="FLAG" property="flag" jdbcType="CHAR" />
         <result column="BLOCKING" property="blocking" jdbcType="CHAR" />
          <result column="SUSPEND_TYPE" property="suspendType" jdbcType="CHAR" />
  </resultMap>
    <select id="queryList4Shopper" parameterClass="com.mitian.airad.model.CoreAd" resultMap="shopperAdMap">
select ca.AD_ID, ca.AD_NAME,  ca.FLAG,ca.BLOCKING,ca.SUSPEND_TYPE , cc.START_TIME, cc.END_TIME, cg.AD_TAG_SP,
          b.SHOW_NUM, b.CLICK_NUM, b.CLICK_RATE
from CORE_AD_GROUP cg,
        CORE_CAMPAIGN cc,
        CORE_AD ca
     left join
       (SELECT AD_ID AD_ID,
               SUM(SHOW_NUM) SHOW_NUM,
               SUM(CLICK_NUM) CLICK_NUM,
               CASE
                 WHEN IFNULL(
                        SUM(SHOW_NUM), 0) > 0
                 THEN
                   SUM(CLICK_NUM) / SUM(SHOW_NUM)
                 ELSE
                   0
               END
                 CLICK_RATE
        from STAT_AD sa
        where sa.ADVERTISER_ID = #memberId#
        GROUP BY AD_ID) b
     on ca.AD_ID = b.AD_ID
where ca.MEMBER_ID = #memberId#
and   cg.MEMBER_ID = cc.MEMBER_ID
and   cg.MEMBER_ID = ca.MEMBER_ID
and   ca.AD_GROUP_ID = cg.AD_GROUP_ID
and   ca.CAMPAIGN_ID = cc.CAMPAIGN_ID
and   cg.CAMPAIGN_ID = cc.CAMPAIGN_ID
and   (ca.DEL_FLAG is null
OR      ca.DEL_FLAG != '1')
       <isNotNull prepend="and" property="startTime">
        <![CDATA[
             cc.START_TIME>=#startTime#
        ]]>
        </isNotNull>
        <isNotNull prepend="and" property="endTime">
        <![CDATA[
             cc.END_TIME <= #endTime#
        ]]>
        </isNotNull>
         <isNotEmpty prepend="AND" property="adName">
            ca.AD_NAME like  '%$adName$%'
         </isNotEmpty>
        GROUP BY ca.AD_ID order by
            ca.ADD_TIME $sortType$ limit $offset$,#limit#
    </select>
      <select id="getTotalShowCount"  parameterClass="LONG" resultClass="INTEGER">
      SELECT SUM(SHOW_NUM)
        from STAT_AD sa
        where sa.ADVERTISER_ID = #memberId#
      </select>
</sqlMap>