<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="BSS_PERSONAL_SHARE" >
  <resultMap id="ibatorgenerated_BaseResultMap" class="com.mitian.airad.model.BssPersonalShare" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Mar 09 14:38:56 CST 2011.
    -->
    <result column="SHARE_ID" property="shareId" jdbcType="INTEGER" />
    <result column="SHARE_TYPE" property="shareType" jdbcType="CHAR" />
    <result column="SHARE_MEMBER_ID" property="shareMemberId" jdbcType="INTEGER" />
    <result column="SHARE_PERCENT" property="sharePercent" jdbcType="CHAR" />
    <result column="SHARE_MEMO" property="shareMemo" jdbcType="VARCHAR" />
    <result column="ADDER_ID" property="adderId" jdbcType="INTEGER" />
    <result column="ADDER_NAME" property="adderName" jdbcType="VARCHAR" />
    <result column="ADD_TIME" property="addTime" jdbcType="TIMESTAMP" />
  </resultMap>
  
  <resultMap class="com.mitian.airad.model.AgentMemberExtend" id="ibatorgenerated_memberAgentMap">
   <!--  根据条件 查询出代理商用户   --> 
  <result column="MEMBER_ID" property="memberId" jdbcType="LONG" /> 
  <result column="EMAIL" property="email" jdbcType="VARCHAR" /> 
  <result column="ADDTIME" property="addtime" jdbcType="TIMESTAMP" /> 
  <result column="SHARE_PERCENT" property="sharePercent" jdbcType="VARCHAR" /> 
  <result column="SHARE_MEMO" property="shareMemo" jdbcType="VARCHAR" /> 
  </resultMap>
  
  
   <select id="ibatorgenerated_selectAgentList" resultMap="ibatorgenerated_memberAgentMap">
  <!-- 
      查询出所有状态为正常的代理商,如果该代理商已经被设置了分成数值,则查出,若没设,返回空
  --> 
  select cmi.member_id,cmi.email,bps.addtime,bps.share_percent,bps.share_memo from CORE_MEMBER_INFO cmi left join ( select * from ( select tb1.share_member_id,tb2.addtime,tb2.share_percent,tb2.share_memo from (select share_member_id,max(add_time) addtime 
  from BSS_PERSONAL_SHARE group by share_member_id ) tb1 inner join (select share_member_id,add_time addtime,share_percent,share_memo from BSS_PERSONAL_SHARE) tb2 on tb1.share_member_id = tb2.share_member_id where tb1.addtime = tb2.addtime) bps) bps on cmi.member_id = bps.share_member_id where cmi.member_type = 4 and cmi.MEMBER_STATUS = 1 and email like '%$email$%' 
  </select>
  
  
  <!-- 根据memberId查询最新记录 -->
  <select id="ibatorgenerated_selectByMemberId" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.mitian.airad.model.BssPersonalShare" >
    select SHARE_ID, SHARE_TYPE, SHARE_MEMBER_ID, SHARE_PERCENT, SHARE_MEMO, ADDER_ID, ADDER_NAME,
    ADD_TIME
    from BSS_PERSONAL_SHARE
    where SHARE_MEMBER_ID = #shareMemberId# order by ADD_TIME DESC limit 1 
  </select>
  <select id="ibatorgenerated_selectByPrimaryKey" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.mitian.airad.model.BssPersonalShare" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Mar 09 14:38:56 CST 2011.
    -->
    select SHARE_ID, SHARE_TYPE, SHARE_MEMBER_ID, SHARE_PERCENT, SHARE_MEMO, ADDER_ID, ADDER_NAME,
      ADD_TIME
    from BSS_PERSONAL_SHARE
    where SHARE_ID = #shareId:INTEGER#
  </select>
  <delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="com.mitian.airad.model.BssPersonalShare" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Mar 09 14:38:56 CST 2011.
    -->
    delete from BSS_PERSONAL_SHARE
    where SHARE_ID = #shareId:INTEGER#
  </delete>
  <insert id="ibatorgenerated_insert" parameterClass="com.mitian.airad.model.BssPersonalShare" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Mar 09 14:38:56 CST 2011.
    -->
    insert into BSS_PERSONAL_SHARE (SHARE_ID, SHARE_TYPE, SHARE_MEMBER_ID, SHARE_PERCENT,
      SHARE_MEMO, ADDER_ID, ADDER_NAME, ADD_TIME)
    values (#shareId:INTEGER#, #shareType:CHAR#, #shareMemberId:INTEGER#, #sharePercent:CHAR#,
      #shareMemo:VARCHAR#, #adderId:INTEGER#, #adderName:VARCHAR#, #addTime:TIMESTAMP#)
  </insert>
  <insert id="ibatorgenerated_insertSelective" parameterClass="com.mitian.airad.model.BssPersonalShare" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Mar 09 14:38:56 CST 2011.
    -->
    insert into BSS_PERSONAL_SHARE
    <dynamic prepend="(" >
      <isNotNull prepend="," property="shareId" >
        SHARE_ID
      </isNotNull>
      <isNotNull prepend="," property="shareType" >
        SHARE_TYPE
      </isNotNull>
      <isNotNull prepend="," property="shareMemberId" >
        SHARE_MEMBER_ID
      </isNotNull>
      <isNotNull prepend="," property="sharePercent" >
        SHARE_PERCENT
      </isNotNull>
      <isNotNull prepend="," property="shareMemo" >
        SHARE_MEMO
      </isNotNull>
      <isNotNull prepend="," property="adderId" >
        ADDER_ID
      </isNotNull>
      <isNotNull prepend="," property="adderName" >
        ADDER_NAME
      </isNotNull>
      <isNotNull prepend="," property="addTime" >
        ADD_TIME
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(" >
      <isNotNull prepend="," property="shareId" >
        #shareId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="shareType" >
        #shareType:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="shareMemberId" >
        #shareMemberId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="sharePercent" >
        #sharePercent:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="shareMemo" >
        #shareMemo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="adderId" >
        #adderId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="adderName" >
        #adderName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="addTime" >
        #addTime:TIMESTAMP#
      </isNotNull>
      )
    </dynamic>
  </insert>
  <update id="ibatorgenerated_updateByPrimaryKeySelective" parameterClass="com.mitian.airad.model.BssPersonalShare" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Mar 09 14:38:56 CST 2011.
    -->
    update BSS_PERSONAL_SHARE
    <dynamic prepend="set" >
      <isNotNull prepend="," property="shareType" >
        SHARE_TYPE = #shareType:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="shareMemberId" >
        SHARE_MEMBER_ID = #shareMemberId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="sharePercent" >
        SHARE_PERCENT = #sharePercent:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="shareMemo" >
        SHARE_MEMO = #shareMemo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="adderId" >
        ADDER_ID = #adderId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="adderName" >
        ADDER_NAME = #adderName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="addTime" >
        ADD_TIME = #addTime:TIMESTAMP#
      </isNotNull>
    </dynamic>
    where SHARE_ID = #shareId:INTEGER#
  </update>
  <update id="ibatorgenerated_updateByPrimaryKey" parameterClass="com.mitian.airad.model.BssPersonalShare" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Mar 09 14:38:56 CST 2011.
    -->
    update BSS_PERSONAL_SHARE
    set SHARE_TYPE = #shareType:CHAR#,
      SHARE_MEMBER_ID = #shareMemberId:INTEGER#,
      SHARE_PERCENT = #sharePercent:CHAR#,
      SHARE_MEMO = #shareMemo:VARCHAR#,
      ADDER_ID = #adderId:INTEGER#,
      ADDER_NAME = #adderName:VARCHAR#,
      ADD_TIME = #addTime:TIMESTAMP#
    where SHARE_ID = #shareId:INTEGER#
  </update>
  <select id="findByMemberId" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.mitian.airad.model.BssPersonalShare" >
    
    select SHARE_ID, SHARE_TYPE, SHARE_MEMBER_ID, SHARE_PERCENT, SHARE_MEMO, ADDER_ID, ADDER_NAME,
      ADD_TIME
    from BSS_PERSONAL_SHARE
    where SHARE_MEMBER_ID = #shareMemberId# and SHARE_TYPE = #shareType#
  </select>
</sqlMap>