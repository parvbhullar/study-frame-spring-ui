<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="ADINFO_VIEW" >
  <resultMap id="ibatorgenerated_BaseResultMap" class="com.mitian.airad.model.AdinfoView" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Feb 22 14:56:16 CST 2011.
    -->
    <result column="AD_ID" property="adId" jdbcType="INTEGER" />
    <result column="AD_TYPE" property="adType" jdbcType="CHAR" />
    <result column="AD_GROUP_ID" property="adGroupId" jdbcType="INTEGER" />
    <result column="CAMPAIGN_ID" property="campaignId" jdbcType="INTEGER" />
    <result column="ADVERTISER_ID" property="advertiserId" jdbcType="INTEGER" />
    <result column="AGENT_ID" property="agentId" jdbcType="INTEGER" />
  </resultMap>
  <!-- 根据APPCODE查出开发者的ID -->
  <select id="findToAppMemberId" parameterClass="com.mitian.airad.model.AdinfoView" resultClass="com.mitian.airad.model.AdinfoView">
  select IFNULL(MEMBER_ID,0) memberId from CORE_APP where APP_CODE = #appCode#
  </select>
   <select id="findByAdInfo" parameterClass="com.mitian.airad.model.AdinfoView" resultClass="com.mitian.airad.model.AdinfoView">
   <!--  select  IFNULL(E.MEMBER_ID,0) agentId,IFNULL(E.ADVERTISER_NUM,0) advertiserId ,IFNULL(D.AD_TYPE,'') adType ,IFNULL(D.AD_ID,0) adId 
   from CORE_AGENT_RELATION E INNER JOIN CORE_AD D ON D.MEMBER_ID = E.ADVERTISER_NUM 
   WHERE  D.AD_ID= 1 GROUP BY  E.ADVERTISER_NUM
  
     select  IFNULL(E.MEMBER_ID,0) agentId,IFNULL(D.MEMBER_ID,0) advertiserId ,IFNULL(D.AD_TYPE,'') adType ,IFNULL(D.AD_ID,0) adId 
   from CORE_AD D left JOIN CORE_AGENT_RELATION E ON D.MEMBER_ID = E.ADVERTISER_NUM 
   WHERE  D.AD_ID= #adId# GROUP BY  D.MEMBER_ID
    -->
   SELECT  
   IFNULL(E.MEMBER_ID,-1) agentId
   ,IFNULL(D.MEMBER_ID,-1) advertiserId 
   ,IFNULL(D.AD_TYPE,'') adType 
   ,IFNULL(D.AD_ID,-1) adId 
  ,A.AD_GROUP_ID adGroupId
  ,B.CAMPAIGN_ID campaignId
   from CORE_AD D 
    LEFT JOIN CORE_AD_GROUP A ON D.AD_GROUP_ID = D.AD_GROUP_ID
    LEFT JOIN CORE_CAMPAIGN B ON B.CAMPAIGN_ID = A.CAMPAIGN_ID
    LEFT JOIN CORE_AGENT_RELATION E ON D.MEMBER_ID = E.ADVERTISER_NUM 
   WHERE  D.AD_ID= #adId# GROUP BY  D.MEMBER_ID
  </select>
  
</sqlMap>