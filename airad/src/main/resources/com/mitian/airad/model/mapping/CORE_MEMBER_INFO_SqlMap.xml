<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="CORE_MEMBER_INFO">
     <resultMap id="ibatorgenerated_BaseResultMap" class="com.mitian.airad.model.CoreMemberInfo" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jan 28 17:43:40 CST 2011.
    -->
    <result column="MEMBER_ID" property="memberId" jdbcType="LONG" />
    <result column="ACC_ID" property="accId" jdbcType="INTEGER" />
    <result column="ADVERTISER_ID" property="advertiserId" jdbcType="INTEGER" />
    <result column="EMAIL" property="email" jdbcType="VARCHAR" />
    <result column="PASSWORD" property="password" jdbcType="VARCHAR" />
    <result column="MOBILE" property="mobile" jdbcType="VARCHAR" />
    <result column="ADDRESS" property="address" jdbcType="VARCHAR" />
    <result column="ZIP" property="zip" jdbcType="CHAR" />
    <result column="QQ" property="qq" jdbcType="VARCHAR" />
    <result column="MSN" property="msn" jdbcType="VARCHAR" />
    <result column="PHONE" property="phone" jdbcType="VARCHAR" />
    <result column="COMPANY_NAME" property="companyName" jdbcType="VARCHAR" />
    <result column="REGISTER_TIME" property="registerTime" jdbcType="TIMESTAMP" />
    <result column="ACTIVE_TIME" property="activeTime" jdbcType="TIMESTAMP" />
    <result column="ACTIVE_CODE" property="activeCode" jdbcType="VARCHAR" />
    <result column="MEMBER_TYPE" property="memberType" jdbcType="CHAR" />
    <result column="MEMBER_STATUS" property="memberStatus" jdbcType="CHAR" />
    <result column="IP_ADDRESS" property="ipAddress" jdbcType="CHAR" />
    <result column="UPD_TIME" property="updTime" jdbcType="TIMESTAMP" />
    <result column="DEL_OPER" property="delOper" jdbcType="VARCHAR" />
    <result column="DEL_TIME" property="delTime" jdbcType="TIMESTAMP" />
    <result column="DEL_FLAG" property="delFlag" jdbcType="CHAR" />
  </resultMap>
   <select id="selectMemberInfoByStatus" resultMap="ibatorgenerated_BaseResultMap" parameterClass="java.lang.String" >
    select MEMBER_ID, ACC_ID, ADVERTISER_ID, EMAIL, PASSWORD, MOBILE, ADDRESS, ZIP, QQ, MSN, PHONE,
      COMPANY_NAME, REGISTER_TIME, ACTIVE_TIME, ACTIVE_CODE, MEMBER_TYPE, MEMBER_STATUS, IP_ADDRESS,
      UPD_TIME, DEL_OPER, DEL_TIME, DEL_FLAG
    from CORE_MEMBER_INFO
    where MEMBER_TYPE in ($memberType$)
  </select>
    <!--
       查询所有未删除会员
    -->
   <select id="selectAll" resultMap="ibatorgenerated_BaseResultMap" parameterClass="java.util.Map" >

    select MEMBER_ID, ACC_ID, ADVERTISER_ID, EMAIL, PASSWORD, MOBILE, ADDRESS, ZIP, QQ, MSN, PHONE,
      COMPANY_NAME, REGISTER_TIME, ACTIVE_TIME, ACTIVE_CODE, MEMBER_TYPE, MEMBER_STATUS, IP_ADDRESS,
      UPD_TIME, DEL_OPER, DEL_TIME, DEL_FLAG
    from CORE_MEMBER_INFO
    where DEL_FLAG = 0
    <isNotNull prepend="and" property="email" >
        EMAIL like '%$email$%'
      </isNotNull>
      <isNotNull prepend="and" property="memberStatus" >
        MEMBER_STATUS = #memberStatus#
      </isNotNull>
      <isNotNull prepend="or" property="memberStatusPlural" >
        MEMBER_STATUS = #memberStatusPlural#
      </isNotNull>
      <dynamic prepend="order by">
    <isNotEmpty property="taxis">
           REGISTER_TIME $taxis$
    </isNotEmpty>
    </dynamic>
  </select>
  
  <!-- 根据email，status查询会员数量 -->
  <select id="selectCountByEmailAndStatus" resultClass="int" parameterClass="java.util.Map" >
    select count(*)
    from CORE_MEMBER_INFO
    where DEL_FLAG = 0
    <isNotNull prepend="and" property="email" >
        EMAIL like '%$email$%'
      </isNotNull>
      <isNotNull prepend="and" property="memberStatus" >
        MEMBER_STATUS = #memberStatus#
      </isNotNull>
      <isNotNull prepend="or" property="memberStatusPlural" >
        MEMBER_STATUS = #memberStatusPlural#
      </isNotNull>
  </select>
  
      <!--
         通过广告商id查询代理商信息
    -->
   <select id="selectByAdvertiserId" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.mitian.airad.model.CoreMemberInfo" >

    select MEMBER_ID, ACC_ID, ADVERTISER_ID, EMAIL, PASSWORD, MOBILE, ADDRESS, ZIP, QQ, MSN, PHONE,
      COMPANY_NAME, REGISTER_TIME, ACTIVE_TIME, ACTIVE_CODE, MEMBER_TYPE, MEMBER_STATUS, IP_ADDRESS,
      UPD_TIME, DEL_OPER, DEL_TIME, DEL_FLAG
    from CORE_MEMBER_INFO
    where ADVERTISER_ID = #advertiserId:INTEGER#
  </select>
  <resultMap class="com.mitian.airad.model.CoreMemberInfo"  id="memberInfoWithBss" extends="ibatorgenerated_BaseResultMap">
   <result column="MEMBER_ID" property="memberId" jdbcType="LONG" />
    <result column="ACC_ID" property="accId" jdbcType="INTEGER" />
    <result column="ADVERTISER_ID" property="advertiserId" jdbcType="INTEGER" />
     <result column="MEMBER_TYPE" property="memberType" jdbcType="CHAR"  javaType="Integer"/>
    <result column="MEMBER_STATUS" property="memberStatus" jdbcType="CHAR" />
    <result column="DEL_FLAG" property="delFlag" jdbcType="CHAR" />
    <result column="SHAREPERCENT" property="sharePercent" jdbcType="VARCHAR" />
  </resultMap>
  
  <select id="getByAppCode" resultMap="memberInfoWithBss" parameterClass="java.util.Map" >
   select c.MEMBER_ID, c.ACC_ID, c.ADVERTISER_ID, c.MEMBER_TYPE, c.MEMBER_STATUS, c.DEL_FLAG,b.SHARE_PERCENT
    from CORE_MEMBER_INFO c left join BSS_PERSONAL_SHARE b on  (c.MEMBER_ID=b.SHARE_MEMBER_ID )
    where c.MEMBER_ID = (select member_id from CORE_APP where APP_CODE=#appCode#) 
  </select>
  
  <select id="getByMemberId" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.mitian.airad.model.CoreMemberInfo" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jan 28 17:43:40 CST 2011.
    -->
    select MEMBER_ID, ACC_ID, ADVERTISER_ID, EMAIL, PASSWORD, MOBILE, ADDRESS, ZIP, QQ, MSN, PHONE,
      COMPANY_NAME, REGISTER_TIME, ACTIVE_TIME, ACTIVE_CODE, MEMBER_TYPE, MEMBER_STATUS, IP_ADDRESS,
      UPD_TIME, DEL_OPER, DEL_TIME, DEL_FLAG
    from CORE_MEMBER_INFO
    where MEMBER_ID = #memberId:LONG#
  </select>
  <delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="com.mitian.airad.model.CoreMemberInfo" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jan 28 17:43:40 CST 2011.
    -->
    delete from CORE_MEMBER_INFO
    where MEMBER_ID = #memberId:LONG#
  </delete>
  <insert id="ibatorgenerated_insert" parameterClass="com.mitian.airad.model.CoreMemberInfo" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jan 28 17:43:40 CST 2011.
    -->
    insert into CORE_MEMBER_INFO (MEMBER_ID, ACC_ID, ADVERTISER_ID, EMAIL, PASSWORD, MOBILE,
      ADDRESS, ZIP, QQ, MSN, PHONE, COMPANY_NAME, REGISTER_TIME, ACTIVE_TIME, ACTIVE_CODE, MEMBER_TYPE,
      MEMBER_STATUS, IP_ADDRESS, UPD_TIME, DEL_OPER, DEL_TIME, DEL_FLAG)
    values (#memberId:LONG#, #accId:INTEGER#, #advertiserId:INTEGER#, #email:VARCHAR#,
      #password:VARCHAR#, #mobile:VARCHAR#, #address:VARCHAR#, #zip:CHAR#, #qq:VARCHAR#,
      #msn:VARCHAR#, #phone:VARCHAR#, #companyName:VARCHAR#, #registerTime:TIMESTAMP#,
      #activeTime:TIMESTAMP#, #activeCode:VARCHAR#, #memberType:CHAR#, #memberStatus:CHAR#,
      #ipAddress:CHAR#, #updTime:TIMESTAMP#, #delOper:VARCHAR#, #delTime:TIMESTAMP#, #delFlag:CHAR#)
  </insert>
  <insert id="ibatorgenerated_insertSelective" parameterClass="com.mitian.airad.model.CoreMemberInfo" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jan 28 17:43:40 CST 2011.
    -->
    insert into CORE_MEMBER_INFO
    <dynamic prepend="(" >
      <isNotNull prepend="," property="memberId" >
        MEMBER_ID
      </isNotNull>
      <isNotNull prepend="," property="accId" >
        ACC_ID
      </isNotNull>
      <isNotNull prepend="," property="advertiserId" >
        ADVERTISER_ID
      </isNotNull>
      <isNotNull prepend="," property="email" >
        EMAIL
      </isNotNull>
      <isNotNull prepend="," property="password" >
        PASSWORD
      </isNotNull>
      <isNotNull prepend="," property="mobile" >
        MOBILE
      </isNotNull>
      <isNotNull prepend="," property="address" >
        ADDRESS
      </isNotNull>
      <isNotNull prepend="," property="zip" >
        ZIP
      </isNotNull>
      <isNotNull prepend="," property="qq" >
        QQ
      </isNotNull>
      <isNotNull prepend="," property="msn" >
        MSN
      </isNotNull>
      <isNotNull prepend="," property="phone" >
        PHONE
      </isNotNull>
      <isNotNull prepend="," property="companyName" >
        COMPANY_NAME
      </isNotNull>
      <isNotNull prepend="," property="registerTime" >
        REGISTER_TIME
      </isNotNull>
      <isNotNull prepend="," property="activeTime" >
        ACTIVE_TIME
      </isNotNull>
      <isNotNull prepend="," property="activeCode" >
        ACTIVE_CODE
      </isNotNull>
      <isNotNull prepend="," property="memberType" >
        MEMBER_TYPE
      </isNotNull>
      <isNotNull prepend="," property="memberStatus" >
        MEMBER_STATUS
      </isNotNull>
      <isNotNull prepend="," property="ipAddress" >
        IP_ADDRESS
      </isNotNull>
      <isNotNull prepend="," property="updTime" >
        UPD_TIME
      </isNotNull>
      <isNotNull prepend="," property="delOper" >
        DEL_OPER
      </isNotNull>
      <isNotNull prepend="," property="delTime" >
        DEL_TIME
      </isNotNull>
      <isNotNull prepend="," property="delFlag" >
        DEL_FLAG
      </isNotNull>
      <isNotNull prepend="," property="promotionId" >
        PROMOTION_ID
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(" >
      <isNotNull prepend="," property="memberId" >
        #memberId:LONG#
      </isNotNull>
      <isNotNull prepend="," property="accId" >
        #accId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="advertiserId" >
        #advertiserId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="email" >
        #email:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="password" >
        #password:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="mobile" >
        #mobile:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="address" >
        #address:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="zip" >
        #zip:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="qq" >
        #qq:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="msn" >
        #msn:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="phone" >
        #phone:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="companyName" >
        #companyName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="registerTime" >
        #registerTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="activeTime" >
        #activeTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="activeCode" >
        #activeCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="memberType" >
        #memberType:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="memberStatus" >
        #memberStatus:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="ipAddress" >
        #ipAddress:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="updTime" >
        #updTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="delOper" >
        #delOper:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="delTime" >
        #delTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="delFlag" >
        #delFlag:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="promotionId" >
        #promotionId:INTEGER#
      </isNotNull>
      )
    </dynamic>
   <selectKey resultClass="Long" keyProperty="memberId" type="post" >
            SELECT @@IDENTITY AS ID
       </selectKey> 
  </insert>
  <update id="ibatorgenerated_updateByPrimaryKeySelective" parameterClass="com.mitian.airad.model.CoreMemberInfo" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jan 28 17:43:40 CST 2011.
    -->
    update CORE_MEMBER_INFO
    <dynamic prepend="set" >
      <isNotNull prepend="," property="accId" >
        ACC_ID = #accId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="advertiserId" >
        ADVERTISER_ID = #advertiserId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="email" >
        EMAIL = #email:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="password" >
        PASSWORD = #password:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="mobile" >
        MOBILE = #mobile:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="address" >
        ADDRESS = #address:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="zip" >
        ZIP = #zip:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="qq" >
        QQ = #qq:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="msn" >
        MSN = #msn:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="phone" >
        PHONE = #phone:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="companyName" >
        COMPANY_NAME = #companyName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="registerTime" >
        REGISTER_TIME = #registerTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="activeTime" >
        ACTIVE_TIME = #activeTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="activeCode" >
        ACTIVE_CODE = #activeCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="memberType" >
        MEMBER_TYPE = #memberType:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="memberStatus" >
        MEMBER_STATUS = #memberStatus:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="ipAddress" >
        IP_ADDRESS = #ipAddress:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="updTime" >
        UPD_TIME = #updTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="delOper" >
        DEL_OPER = #delOper:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="delTime" >
        DEL_TIME = #delTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="delFlag" >
        DEL_FLAG = #delFlag:CHAR#
      </isNotNull>
    </dynamic>
    where MEMBER_ID = #memberId:LONG#
  </update>
  <update id="ibatorgenerated_updateByPrimaryKey" parameterClass="com.mitian.airad.model.CoreMemberInfo" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jan 28 17:43:40 CST 2011.
    -->
    update CORE_MEMBER_INFO
    set ACC_ID = #accId:INTEGER#,
      ADVERTISER_ID = #advertiserId:INTEGER#,
      EMAIL = #email:VARCHAR#,
      PASSWORD = #password:VARCHAR#,
      MOBILE = #mobile:VARCHAR#,
      ADDRESS = #address:VARCHAR#,
      ZIP = #zip:CHAR#,
      QQ = #qq:VARCHAR#,
      MSN = #msn:VARCHAR#,
      PHONE = #phone:VARCHAR#,
      COMPANY_NAME = #companyName:VARCHAR#,
      REGISTER_TIME = #registerTime:TIMESTAMP#,
      ACTIVE_TIME = #activeTime:TIMESTAMP#,
      ACTIVE_CODE = #activeCode:VARCHAR#,
      MEMBER_TYPE = #memberType:CHAR#,
      MEMBER_STATUS = #memberStatus:CHAR#,
      IP_ADDRESS = #ipAddress:CHAR#,
      UPD_TIME = #updTime:TIMESTAMP#,
      DEL_OPER = #delOper:VARCHAR#,
      DEL_TIME = #delTime:TIMESTAMP#,
      DEL_FLAG = #delFlag:CHAR#
    where MEMBER_ID = #memberId:LONG#
  </update>

    <select id="selectByEmail" parameterClass="java.lang.String" resultMap="ibatorgenerated_BaseResultMap">
        select MEMBER_ID,ADVERTISER_ID, EMAIL, PASSWORD, MOBILE, ADDRESS, ZIP, QQ, MSN, PHONE,
        COMPANY_NAME, REGISTER_TIME, ACTIVE_TIME, ACTIVE_CODE, MEMBER_TYPE,ACC_ID,
        MEMBER_STATUS, IP_ADDRESS, UPD_TIME, DEL_OPER, DEL_TIME, DEL_FLAG
        from CORE_MEMBER_INFO
        where EMAIL = #email:VARCHAR#
    </select>
 <update id="updateMemberType" parameterClass="com.mitian.airad.model.CoreMemberInfo" >
 update CORE_MEMBER_INFO set MEMBER_TYPE = #memberType:CHAR# where MEMBER_ID = #memberId:LONG# 
 </update>
</sqlMap>
