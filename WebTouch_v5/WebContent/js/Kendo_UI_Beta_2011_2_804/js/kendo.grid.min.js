(function(a,b){function B(a,b){var c=a.template,d=a.field;c||(a.encoded===!0?c="${"+(b.useWithBlock?"":b.paramName+".")+d+"}":c=b.begin+"="+(b.useWithBlock?"":b.paramName+".")+d+b.end);return c}function A(a){if(a===0)return"";return Array(a+1).join('<td class="t-group-cell"></td>')}var c=window.kendo,d=c.ui,e=c.data.DataSource,f=c.ui.Groupable,g=c.support.tbodyInnerHtml,h=d.Component,i=c.keys,j=a.isPlainObject,k=a.extend,l=a.map,m=a.isArray,n=a.proxy,o="requestStart",p="error",q="tr:not(.t-grouping-row):visible",r=q+">td:not(.t-group-cell)",s=r+":first",t="change",u="dataBound",v="t-state-focused",w="t-focusable",x="t-state-selected",y="string",z=h.extend({init:function(a,b){var c=this;h.fn.init.call(c,a,b),c.dataSource=b.dataSource,c.dataSource.bind(t,n(c.refresh,c)),c.wrap()},options:{itemHeight:a.noop},wrap:function(){var b=this,d=c.support.scrollbar()+1,e=b.element;e.css({width:"auto",paddingRight:d,overflow:"hidden"}),b.content=e.children().first(),b.wrapper=b.content.wrap('<div class="t-virtual-scrollable-wrap"/>').parent().bind("DOMMouseScroll",n(b._wheelScroll,b)).bind("mousewheel",n(b._wheelScroll,b)),b.verticalScrollbar=a('<div class="t-scrollbar t-scrollbar-vertical" />').css({width:d}).appendTo(e).bind("scroll",n(b._scroll,b))},_wheelScroll:function(b){var c=this,d=c.verticalScrollbar.scrollTop(),e=b.originalEvent,f;b.preventDefault(),e.wheelDelta?f=e.wheelDelta:e.detail?f=-e.detail:a.browser.opera&&(f=-e.wheelDelta),c.verticalScrollbar.scrollTop(d+ -f)},_scroll:function(a){var b=this,c=a.currentTarget.scrollTop,d=b.dataSource,e=b.itemHeight,f=d.skip()||0,g=b.rangeStart||f,h=b.element.innerHeight(),i=!!(b._scrollbarTop&&b._scrollbarTop>c),j=Math.max(Math.floor(c/e),0),k=Math.max(j+Math.floor(h/e),0);b._scrollTop=c-g*e,b._scrollbarTop=c,b._fetch(j,k,i)||(b.wrapper[0].scrollTop=b._scrollTop)},_fetch:function(a,b,c){var d=this,e=d.dataSource,f=d.itemHeight,g=e.take(),h=d.rangeStart||e.skip()||0,i=Math.floor(a/g)*g,j=!1,k=.33;a<h?(j=!0,h=Math.max(0,b-g),d._scrollTop=(a-h)*f,d._page(h,g)):b>=h+g&&!c?(j=!0,h=a,d._scrollTop=f,d._page(h,g)):d._fetching||(a<i+g-g*k&&a>g&&e.prefetch(i-g,g),b>i+g*k&&e.prefetch(i+g,g));return j},_page:function(a,b){var d=this,e=d.dataSource;clearTimeout(d._timeout),d._fetching=!0,d.rangeStart=a,e.inRange(a,b)?e.range(a,b):(c.ui.progress(d.wrapper,!0),d._timeout=setTimeout(function(){e.range(a,b)},100))},refresh:function(){var a=this,b="",d=25e4,e;c.ui.progress(a.wrapper,!1),clearTimeout(a._timeout),a._fetching=!1,e=a.itemHeight=a.options.itemHeight()||0,totalHeight=a.dataSource.total()*e;for(idx=0;idx<Math.round(totalHeight/d);idx++)b+='<div style="width:1px;height:'+d+'px"></div>';totalHeight%d&&(b+='<div style="width:1px;height:'+totalHeight%d+'px"></div>'),a.verticalScrollbar.html(b),a.wrapper[0].scrollTop=a._scrollTop}}),C=h.extend({init:function(a,b){var c=this;b=m(b)?{dataSource:b}:b,h.fn.init.call(c,a,b),c._element(),c._columns(c.options.columns),c._dataSource(),c._tbody(),c._pageable(),c._groupable(),c._thead(),c._templates(),c._navigatable(),c._selectable(),c.options.autoBind&&c.dataSource.query(),c.bind([t,u],c.options)},options:{columns:[],autoBind:!0,scrollable:!0,groupable:!1,dataSource:{}},_element:function(){var b=this,c=b.element;c.is("table")||(c=a("<table />").appendTo(b.element)),b.table=c.attr("cellspacing",0),b._wrapper()},_groupable:function(){var b=this,c=b.wrapper,d=b.options.groupable;d&&(c.has("div.t-grouping-header")[0]||a("<div />").addClass("t-grouping-header").prependTo(c),b.groupable=new f(c,{filter:"th:not(.t-group-cell)",groupContainer:"div.t-grouping-header",dataSource:b.dataSource})),b.table.delegate(".t-grouping-row .t-collapse, .t-grouping-row .t-expand","click",function(c){c.preventDefault();var d=a(this),e=d.closest("tr");d.hasClass("t-collapse")?b.collapseGroup(e):b.expandGroup(e)})},_selectable:function(){var a=this,b,d,e=a.options.selectable;e&&(b=typeof e===y&&e.toLowerCase().indexOf("multiple")>-1,d=typeof e===y&&e.toLowerCase().indexOf("cell")>-1,a.selectable=new c.ui.Selectable(a.table,{filter:d?r:q,multiple:b,change:function(){a.trigger(t)}}),a.options.navigatable&&a.wrapper.keydown(function(c){if(c.keyCode===i.SPACEBAR){var e=a.current();e=d?e:e.parent(),b?c.ctrlKey?e.hasClass(x)&&(e.removeClass(x),e=null):a.selectable.clear():a.selectable.clear(),a.selectable.value(e)}}))},clearSelection:function(){var a=this;a.selectable.clear(),a.trigger(t)},select:function(b){var c=this,d=c.selectable;b=a(b);if(b.length)d.options.multiple||(d.clear(),b=b.first()),d.value(b);else return d.value()},current:function(a){var c=this,d=c._current;if(a===b||!a.length)return c._current;if(!d||d[0]!==a[0])a.addClass(v),d&&d.removeClass(v),c._current=a,c._scrollTo(a.parent()[0])},_scrollTo:function(a){var b=this.tbody.closest("div.t-grid-content")[0];if(!!a&&!!b){var c=a.offsetTop,d=a.offsetHeight,e=b.scrollTop,f=b.clientHeight,g=c+d;b.scrollTop=e>c?c:g>e+f?g-f:e}},_navigatable:function(){var b=this,c=b.wrapper,d=b.table.addClass(w),e=n(b.current,b),f="."+w+" "+r,g=function(b){e(a(b.currentTarget)),b.type=="click"&&c.focus()};b.options.navigatable&&(c.bind({focus:function(){b._current&&b._current.is(":visible")?b._current.addClass(v):e(b.table.find(s))},focusout:function(){b._current&&b._current.removeClass(v)},keydown:function(a){var c=a.keyCode,f=b.current(),g=b.dataSource,h=b.options.pageable,j=!1;i.UP===c?(e(f?f.parent().prevAll(q).first().children().eq(f.index()):d.find(s)),j=!0):i.DOWN===c?(e(f?f.parent().nextAll(q).first().children().eq(f.index()):d.find(s)),j=!0):i.LEFT===c?(e(f?f.prev(":not(.t-group-cell)"):d.find(s)),j=!0):i.RIGHT===c?(e(f?f.next():d.find(s)),j=!0):h&&i.PAGEUP==c?(b._current=null,g.page(g.page()+1),j=!0):h&&i.PAGEDOWN==c&&(b._current=null,g.page(g.page()-1),j=!0),j&&a.preventDefault()}}),a.browser.msie?c.delegate(f,"click",g):c.delegate(f,"mousedown",g))},_wrapper:function(){var a=this,b=a.table,c=a.options.height||b.css("height"),d=a.element;d.is("div")||(d=d.wrap("<div />").parent()),a.wrapper=d.addClass("t-grid t-widget").attr("tabIndex",Math.max(b.attr("tabIndex")||0,0)),b.removeAttr("tabIndex"),c&&c!=="0px"&&(a.wrapper.css("height",c),b.css("height","auto"))},_tbody:function(){var b=this,c=b.table,d;d=c.find(">tbody"),d.length||(d=a("<tbody />").appendTo(c)),b.tbody=d},_scrollable:function(){var b=this,d,e,f=b.options,g=b.wrapper.innerHeight(),h=f.scrollable,i=c.support.scrollbar();h&&(d=b.wrapper.children().filter(".t-grid-header"),d[0]||(d=a('<div class="t-grid-header" />').insertBefore(b.table)),d.css("padding-right",h.virtual?i+1:i),e=a('<table cellspacing="0" />'),e.append(b.thead),d.empty().append(a('<div class="t-grid-header-wrap" />').append(e)),b.content=b.table.parent(),b.content.is(".t-virtual-scrollable-wrap")&&(b.content=b.content.parent()),b.content.is(".t-grid-content, .t-virtual-scrollable-wrap")||(b.content=b.table.wrap('<div class="t-grid-content" />').parent(),h!==!0&&h.virtual&&new z(b.content,{dataSource:b.dataSource,itemHeight:n(b._calculateRowHeight,b)})),g-=d.outerHeight(),b.pager&&(g-=b.pager.element.outerHeight()),f.groupable&&(g-=a(".t-grouping-header").outerHeight()),b.content.height(g))},_calculateRowHeight:function(){var a=this,b=a._rowHeight;a._rowHeight||(a._rowHeight=b=a.table.outerHeight()/a.table[0].rows.length,a._sum=b,a._measures=1,totalHeight=Math.round(a.dataSource.total()*b));var c=a.table.outerHeight()/a.table[0].rows.length;b!==c&&(a._measures++,a._sum+=c,a._rowHeight=a._sum/a._measures);return b},_dataSource:function(){var a=this,c=a.options,d=c.dataSource;d=m(d)?{data:d}:d,j(d)&&(k(d,{table:a.table,fields:a.columns}),c.data&&(d.data=c.data),pageable=c.pageable,j(pageable)&&pageable.pageSize!==b&&(d.pageSize=pageable.pageSize)),a.dataSource=e.create(d).bind(t,n(a.refresh,a)).bind(o,n(a._requestStart,a)).bind(p,n(a._error,a))},_error:function(){this._progress(!1)},_requestStart:function(){this._progress(!0)},_pageable:function(){var b=this,d,e=b.options.pageable;e&&(d=b.wrapper.children("div.t-grid-pager"),d.length||(d=a('<div class="t-grid-pager"/>').appendTo(b.wrapper)),typeof e=="object"&&e instanceof c.ui.Pageable?b.pager=e:b.pager=new c.ui.Pageable(d,k({},e,{dataSource:b.dataSource})))},_sortable:function(){var a=this,b=a.options.sortable;b&&a.thead.find("th").kendoSortable(k({},b,{dataSource:a.dataSource}))},_columns:function(b){var c=this,d=c.table,e=d.find("col");b=b.length?b:l(d.find("th"),function(b,c){var b=a(b),d=b.data("field");d||(d=b.text().replace(/\s|[^A-z0-9]/g,""));return{field:d,template:b.data("template"),width:e.eq(c).css("width")}}),c.columns=l(b,function(a){a=typeof a===y?{field:a}:a;return k({encoded:!0},a)})},_compositeTmpl:function(a,b){var d=this,e=[],f,g,h=(d.dataSource.group()||[]).length;h>0&&e.push(function(){return A(h)});for(f=0,g=d.columns.length;f<g;f++)e.push(c.template(B(d.columns[f],b)));return function(b){var c=[a],d,f;for(d=0,f=e.length;d<f;d++)c.push("<td>"),c.push(e[d](b)),c.push("</td>");return c.join("")+"</tr>"}},_tmpl:function(b,d){var e=this,f=k({},c.Template,e.options.templateSettings),g,h,i,j=(e.dataSource.group()||[]).length;if(!d){d=b,j>0&&(d+=A(j));for(g=0,h=e.columns.length;g<h;g++){i=B(e.columns[g],f);if(a.isFunction(i))return e._compositeTmpl(b,f);d+="<td>"+i+"</td>"}d+="</tr>"}return c.template(d,f)},_templates:function(){var a=this,b=a.options;a.rowTemplate=a._tmpl("<tr>",b.rowTemplate),a.altRowTemplate=a._tmpl('<tr class="t-alt">',b.altRowTemplate||b.rowTemplate)},_thead:function(){var b=this,c=b.columns,d,e,f="",g=b.table.find("thead"),h,i;g.length||(g=a("<thead/>").insertBefore(b.tbody)),h=b.table.find("tr").filter(":has(th)"),h.length||(h=g.children().first(),h.length||(h=a("<tr/>")));if(!h.children().length){for(d=0,e=c.length;d<e;d++)i=c[d],f+="<th data-field='"+i.field+"'>"+(i.title||i.field)+"</th>";h.html(f)}h.find("th").addClass("t-header"),b.options.scrollable||g.addClass("t-grid-header"),h.appendTo(g),b.thead=g,b._sortable(),b._scrollable(),b._updateCols()},_updateCols:function(){var b=this,d=b.thead.parent().add(b.table),e=d.find("colgroup"),f,g=l(b.columns,function(a){f=a.width;if(f&&parseInt(f)!=0)return c.format('<col style="width:{0}"/>',f);return"<col />"}),h=(b.dataSource.group()||[]).length;e.length&&e.remove(),e=a("<colgroup></colgroup>").append(a(Array(h+1).join('<col class="t-group-col">')+g.join(""))),d.prepend(e)},_autoColumns:function(a){if(a){var b=this,c;for(c in a)b.columns.push({field:c});b._thead(),b._templates()}},_rowsHtml:function(a){var b=this,c="",d,e,f=b.rowTemplate,g=b.altRowTemplate;for(d=0,e=a.length;d<e;d++)d%2?c+=g(a[d]):c+=f(a[d]);return c},_groupRowHtml:function(a,b,c){var d=this,e="",f,g,h=a.items;e+='<tr class="t-grouping-row">'+A(c)+'<td colspan="'+b+'">'+'<p class="t-reset">'+'<a class="t-icon t-collapse" href="#"></a>'+a.field+": "+a.value+"</p></td></tr>";if(a.hasSubgroups)for(f=0,g=h.length;f<g;f++)e+=d._groupRowHtml(h[f],b-1,c+1);else e+=d._rowsHtml(h);return e},collapseGroup:function(b){b=a(b).find(".t-icon").addClass("t-expand").removeClass("t-collapse").end();var c=b.find(".t-group-cell").length;b.nextUntil(function(){return a(".t-group-cell",this).length<=c}).hide()},expandGroup:function(b){b=a(b).find(".t-icon").addClass("t-collapse").removeClass("t-expand").end();var c=this,d=b.find(".t-group-cell").length;b.nextAll("tr").each(function(){var b=a(this),e=b.find(".t-group-cell").length;if(e<=d)return!1;e==d+1&&(b.show(),b.hasClass("t-grouping-row")&&b.find(".t-icon").hasClass("t-collapse")&&c.expandGroup(b))})},_updateHeader:function(b){var c=this,d=c.thead.find("th.t-group-cell"),e=d.length;b>e?a(Array(b-e+1).join('<th class="t-group-cell t-header">&nbsp;</th>')).prependTo(c.thead.find("tr")):b<e&&(e=e-b,a(a.grep(d,function(a,b){return e>b})).remove())},_firstDataItem:function(a,b){a&&b&&(a.hasSubgroups?a=this._firstDataItem(a.items[0],b):a=a.items[0]);return a},_progress:function(a){var b=this,d=b.element.find(".t-grid-content"),e=b.element.is("table")?b.element.parent():d.length?d:b.element;c.ui.progress(e,a)},refresh:function(){var b=this,c,d,e="",f=b.dataSource.view(),h,i,j=(b.dataSource.group()||[]).length,k=j+b.columns.length;b._progress(!1),b.columns.length||(b._autoColumns(b._firstDataItem(f[0],j)),k=j+b.columns.length),b._group=j>0||b._group,b._group&&(b._templates(),b._updateHeader(j),b._updateCols(),b._group=j>0);if(j>0)for(d=0,c=f.length;d<c;d++)e+=b._groupRowHtml(f[d],k,0);else e+=b._rowsHtml(f);g?b.tbody[0].innerHTML=e:(i=document.createElement("div"),i.innerHTML="<table><tbody>"+e+"</tbody></table>",h=i.firstChild.firstChild,b.table[0].replaceChild(h,b.tbody[0]),b.tbody=a(h)),b.trigger(u)}});d.plugin("Grid",C),d.plugin("VirtualScrollable",z)})(jQuery)