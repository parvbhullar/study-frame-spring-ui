(function(a,b,c){function F(){var b={};a("input[name^='__RequestVerificationToken']").each(function(){b[this.name]=this.value});return b}function E(b){return a(b.target).closest(".t-file")}function D(a){typeof console!="undefined"&&console.log&&console.log(a)}function C(a){return a.children(".t-icon").is(".t-loading, .t-success, .t-fail")}function B(a,b,c){var d,e;a.bind("dragenter",function(a){b(),e=new Date,d||(d=setInterval(function(){var a=new Date-e;a>100&&(c(),clearInterval(d),d=null)},100))}).bind("dragover",function(a){e=new Date})}function A(a){a.stopPropagation(),a.preventDefault()}function z(b,c,d){try{var e=a.parseJSON(b);c(e)}catch(f){d()}}function y(b,c){if(!!c._supportsRemove()){var d=b.data("fileNames"),e=a.map(d,function(a){return a.name});c._submitRemove(e,function(a,e,f){c._removeFileEntry(b),c.trigger(i,{operation:"remove",files:d,response:a,XMLHttpRequest:f})},function(a,b,b){var e=c.trigger(j,{operation:"remove",files:d,XMLHttpRequest:a});D("Server response: "+a.responseText),e||c._alert("Error! Remove operation failed. Unexpected response - see console.")})}}function x(a){var b=a.lastIndexOf("\\");return b!=-1?a.substr(b+1):a}function w(a){var b=a.match(f);return b?b[0]:""}function v(a){var b=a.name||a.fileName;return{name:b,extension:w(b),size:a.size||a.fileSize,rawFile:a}}function u(b){return a.map(b,function(a){return v(a)})}function t(a){var b=a[0];return b.files?u(b.files):[{name:x(b.value),extension:w(b.value),size:null}]}function s(b){return a.map(t(b),function(a){return a.name}).join(", ")}var d=b.kendo,e=d.ui.Component,f=/\.([^\.]+)$/,g="select",h="upload",i="success",j="error",k="complete",l="cancel",m="load",n="remove",o=e.extend({init:function(b,d){var f=this;e.fn.init.call(f,b,d),f.name=b.name,f.multiple=f.options.multiple,f.localization=f.options.localization;var m=f.element;f.wrapper=m.closest(".t-upload"),f.wrapper.length==0&&(f.wrapper=f._wrapInput(m)),f._activeInput(m),f.toggle(f.options.enabled),m.closest("form").bind({submit:a.proxy(f._onParentFormSubmit,f),reset:a.proxy(f._onParentFormReset,f)}),f.options.async.saveUrl!=c?f._module=f._supportsFormData()?new r(f):new q(f):f._module=new p(f),f._supportsDrop()&&f._setupDropZone(),f.wrapper.delegate(".t-upload-action","click",a.proxy(f._onFileAction,f)).delegate(".t-upload-selected","click",a.proxy(f._onUploadSelected,f)).delegate(".t-file","t:progress",a.proxy(f._onFileProgress,f)).delegate(".t-file","t:upload-success",a.proxy(f._onUploadSuccess,f)).delegate(".t-file","t:upload-error",a.proxy(f._onUploadError,f)),f.bind([g,h,i,j,k,l,n],f.options)},options:{enabled:!0,multiple:!0,showFileList:!0,async:{},localization:{select:"Select...",cancel:"Cancel",retry:"Retry",remove:"Remove",uploadSelectedFiles:"Upload files",dropFilesHere:"drop files here to upload",statusUploading:"uploading",statusUploaded:"uploaded",statusFailed:"failed"}},enable:function(){this.toggle(!0)},disable:function(){this.toggle(!1)},toggle:function(a){a=typeof a=="undefined"?a:!a,this.wrapper.toggleClass("t-state-disabled",a)},_addInput:function(b){var c=this;b.insertAfter(c.element).data("kendoUpload",c),a(c.element).hide().removeAttr("id"),c._activeInput(b)},_activeInput:function(b){var c=this,d=c.wrapper;c.element=b,b.attr("multiple",c._supportsMultiple()?c.multiple:!1).attr("autocomplete","off").click(function(a){d.hasClass("t-state-disabled")&&a.preventDefault()}).change(a.proxy(c._onInputChange,c))},_onInputChange:function(b){var c=a(b.target),d=this.trigger(g,{files:t(c)});d||c.trigger("t:select")},_onDrop:function(b){var c=b.originalEvent.dataTransfer,d=this,e=c.files;A(b);if(e.length>0){var f=d.trigger(g,{files:e});f||a(".t-dropzone",d.wrapper).trigger("t:select",[e])}},_enqueueFile:function(b,c){var d=this,e,f,g=a(".t-upload-files",d.wrapper);g.length==0&&(g=a("<ul class='t-upload-files t-reset'></ul>").appendTo(d.wrapper),d.options.showFileList||g.hide()),e=a(".t-file",g),f=a("<li class='t-file'><span class='t-icon'></span><span class='t-filename'>"+b+"</span></li>").appendTo(g).data(c),d.multiple||e.trigger("t:remove");return f},_removeFileEntry:function(b){var c=b.closest(".t-upload-files");a(".t-file",c).length==1?(c.remove(),this._hideUploadButton()):b.remove()},_fileAction:function(a,b){var c={remove:"t-delete",cancel:"t-cancel",retry:"t-retry"};!c.hasOwnProperty(b)||(this._clearFileAction(a),a.append(this._renderAction(c[b],this.localization[b]).addClass("t-upload-action")))},_fileState:function(a,b){var c=this.localization,d={uploading:{cssClass:"t-loading",text:c.statusUploading},uploaded:{cssClass:"t-success",text:c.statusUploaded},failed:{cssClass:"t-fail",text:c.statusFailed}},e=d[b];if(e){var f=a.children(".t-icon").text(e.text);f[0].className="t-icon "+e.cssClass}},_renderAction:function(b,c){return b!=""?a("<button type='button' class='t-button t-button-icontext'><span class='t-icon "+b+"'></span>"+c+"</button>"):a("<button type='button' class='t-button'>"+c+"</button>")},_clearFileAction:function(a){a.find(".t-upload-action").remove()},_onFileAction:function(b){var c=this;if(!c.wrapper.hasClass("t-state-disabled")){var d=a(b.target).closest(".t-upload-action"),e=d.find(".t-icon"),f=d.closest(".t-file"),g={files:f.data("fileNames")};e.hasClass("t-delete")?c.trigger(n,g)||f.trigger("t:remove"):e.hasClass("t-cancel")?(c.trigger(l,g),f.trigger("t:cancel")):e.hasClass("t-retry")&&f.trigger("t:retry")}return!1},_onUploadSelected:function(){this.wrapper.trigger("t:saveSelected");return!1},_onFileProgress:function(b,c){var d=a(".t-progress-status",b.target);d.length==0&&(d=a("<span class='t-progress'><span class='t-progress-status' style='width: 0;'></span></span>").appendTo(a(".t-filename",b.target)).find(".t-progress-status")),d.width(c+"%")},_onUploadSuccess:function(a,b,c){var d=E(a);this._fileState(d,"uploaded"),this.trigger(i,{files:d.data("fileNames"),response:b,operation:"upload",XMLHttpRequest:c}),this._supportsRemove()?this._fileAction(d,n):this._clearFileAction(d),this._checkAllComplete()},_onUploadError:function(a,b){var c=E(a);this._fileState(c,"failed"),this._fileAction(c,"retry");var d=this.trigger(j,{operation:"upload",files:c.data("fileNames"),XMLHttpRequest:b});D("Server response: "+b.responseText),d||this._alert("Error! Upload failed. Unexpected server response - see console."),this._checkAllComplete()},_showUploadButton:function(){var b=a(".t-upload-selected",this.wrapper);b.length==0&&(b=this._renderAction("",this.localization.uploadSelectedFiles).addClass("t-upload-selected")),this.wrapper.append(b)},_hideUploadButton:function(){a(".t-upload-selected",this.wrapper).remove()},_onParentFormSubmit:function(){this.element.trigger("t:abort");if(!this.element.value){var c=a(this.element),d=c.parent();c.detach(),b.setTimeout(function(){d.append(c)},0)}},_onParentFormReset:function(){a(".t-file",this.wrapper).trigger("t:remove")},_supportsFormData:function(){return typeof FormData!="undefined"},_supportsMultiple:function(){return!a.browser.opera},_supportsDrop:function(){var a=this._userAgent().toLowerCase(),b=/chrome/.test(a),d=!b&&/safari/.test(a),e=d&&/windows/.test(a);return!e&&this._supportsFormData()&&this.options.async.saveUrl!=c},_userAgent:function(){return navigator.userAgent},_setupDropZone:function(){a(".t-upload-button",this.wrapper).wrap("<div class='t-dropzone'></div>");var b=a(".t-dropzone",this.wrapper).append(a("<em>"+this.localization.dropFilesHere+"</em>")).bind({dragenter:A,dragover:function(a){a.preventDefault()},drop:a.proxy(this._onDrop,this)});B(b,function(){b.addClass("t-dropzone-hovered")},function(){b.removeClass("t-dropzone-hovered")}),B(a(document),function(){b.addClass("t-dropzone-active")},function(){b.removeClass("t-dropzone-active")})},_supportsRemove:function(){return this.options.async.removeUrl!=c},_submitRemove:function(b,c,d){var e=a.extend({},F());e.fileNames=b,a.ajax({type:"POST",dataType:"json",url:this.options.async.removeUrl,traditional:!0,data:e,success:c,error:d})},_alert:function(a){alert(a)},_wrapInput:function(a){a.wrap("<div class='t-widget t-upload'><div class='t-button t-upload-button'></div></div>"),a.closest(".t-button").append("<span>"+this.localization.select+"</span>");return a.closest(".t-upload")},_checkAllComplete:function(){a(".t-file .t-icon.t-loading",this.wrapper).length==0&&this.trigger(k)}}),p=function(b){this.name="syncUploadModule",this.element=b.wrapper,this.upload=b,this.element.bind("t:select",a.proxy(this.onSelect,this)).bind("t:remove",a.proxy(this.onRemove,this)).closest("form").attr("enctype","multipart/form-data").attr("encoding","multipart/form-data")};p.prototype={onSelect:function(b){var c=this.upload,d=a(b.target);c._addInput(d.clone().val(""));var e=c._enqueueFile(s(d),{relatedInput:d});c._fileAction(e,n)},onRemove:function(a){var b=E(a);b.data("relatedInput").remove(),this.upload._removeFileEntry(b)}};var q=function(b){this.name="iframeUploadModule",this.element=b.wrapper,this.upload=b,this.iframes=[],this.element.bind("t:select",a.proxy(this.onSelect,this)).bind("t:cancel",a.proxy(this.onCancel,this)).bind("t:retry",a.proxy(this.onRetry,this)).bind("t:remove",a.proxy(this.onRemove,this)).bind("t:saveSelected",a.proxy(this.onSaveSelected,this)).bind("t:abort",a.proxy(this.onAbort,this))};q.prototype={onSelect:function(b){var c=this.upload,d=a(b.target),e=this.prepareUpload(d);c.options.async.autoUpload?this.performUpload(e):(c._supportsRemove()&&this.upload._fileAction(e,n),c._showUploadButton())},prepareUpload:function(b){var c=this.upload,d=a(c.element);c._addInput(b.clone().val(""));var e=this.createFrame(c.name+"_"+this.iframes.length);this.registerFrame(e);var f=this.createForm(c.options.async.saveUrl,e.attr("name")).append(d),g=c._enqueueFile(s(b),{frame:e,relatedInput:d,fileNames:t(b)});e.data({form:f,file:g});return g},performUpload:function(b){var c={files:b.data("fileNames")},d=b.data("frame"),e=this.upload;if(!e.trigger(h,c)){e._hideUploadButton(),d.appendTo(document.body);var f=d.data("form").appendTo(document.body);c.data=a.extend({},c.data,F());for(var g in c.data){var i=f.find("input[name='"+g+"']");i.length==0&&(i=a("<input>",{type:"hidden",name:g}).appendTo(f)),i.val(c.data[g])}e._fileAction(b,l),e._fileState(b,"uploading"),d.one("load",a.proxy(this.onIframeLoad,this)),f[0].submit()}else e._removeFileEntry(d.data("file")),this.cleanupFrame(d),this.unregisterFrame(d)},onSaveSelected:function(b){var c=this;a(".t-file",this.element).each(function(){var b=a(this),d=C(b);d||c.performUpload(b)})},onIframeLoad:function(b){var c=a(b.target);try{var d=c.contents().text()}catch(b){d="Error trying to get server response: "+b}this.processResponse(c,d)},processResponse:function(b,c){var d=b.data("file"),e=this,f={responseText:c};z(c,function(c){a.extend(f,{statusText:"OK",status:"200"}),d.trigger("t:upload-success",[c,f]),e.cleanupFrame(b),e.unregisterFrame(b)},function(){a.extend(f,{statusText:"error",status:"500"}),d.trigger("t:upload-error",[f])})},onCancel:function(b){var c=a(b.target).data("frame");this.stopFrameSubmit(c),this.cleanupFrame(c),this.unregisterFrame(c),this.upload._removeFileEntry(c.data("file"))},onRetry:function(a){var b=E(a);this.performUpload(b)},onRemove:function(a){var b=E(a),c=b.data("frame");c?(this.unregisterFrame(c),this.upload._removeFileEntry(b),this.cleanupFrame(c)):y(b,this.upload)},onAbort:function(){var b=this.element,c=this;a.each(this.iframes,function(){a("input",this.data("form")).appendTo(b),c.stopFrameSubmit(this[0]),this.data("form").remove(),this.remove()}),this.iframes=[]},createFrame:function(b){return a("<iframe name='"+b+"'"+" id='"+b+"'"+" style='display:none;' />")},createForm:function(b,c){return a("<form enctype='multipart/form-data' method='POST' action='"+b+"'"+" target='"+c+"'"+"/>")},stopFrameSubmit:function(a){typeof a.stop!="undefined"?a.stop():a.document&&(a.document.execCommand("Stop"),a.contentWindow.location.href=a.contentWindow.location.href)},registerFrame:function(a){this.iframes.push(a)},unregisterFrame:function(b){this.iframes=a.grep(this.iframes,function(a){return a.attr("name")!=b.attr("name")})},cleanupFrame:function(a){var b=a.data("form");a.data("file").data("frame",null),setTimeout(function(){b.remove(),a.remove()},1)}};var r=function(b){this.name="formDataUploadModule",this.element=b.wrapper,this.upload=b,this.element.bind("t:select",a.proxy(this.onSelect,this)).bind("t:cancel",a.proxy(this.onCancel,this)).bind("t:remove",a.proxy(this.onRemove,this)).bind("t:retry",a.proxy(this.onRetry,this)).bind("t:saveSelected",a.proxy(this.onSaveSelected,this)).bind("t:abort",a.proxy(this.onAbort,this))};r.prototype={onSelect:function(b,c){var d=this.upload,e=this,f=a(b.target),g=c?u(c):this.inputFiles(f),h=this.prepareUpload(f,g);a.each(h,function(){d.options.async.autoUpload?e.performUpload(this):(d._supportsRemove()&&d._fileAction(this,n),d._showUploadButton())})},prepareUpload:function(b,c){var d=this.enqueueFiles(c);b.is("input")&&(a.each(d,function(){a(this).data("relatedInput",b)}),b.data("relatedFileEntries",d),this.upload._addInput(b.clone().val("")));return d},enqueueFiles:function(a){var b=this.upload;fileEntries=[];for(var c=0;c<a.length;c++){var d=a[c],e=d.name,f=b._enqueueFile(e,{fileNames:[d]});f.data("formData",this.createFormData(a[c])),fileEntries.push(f)}return fileEntries},inputFiles:function(a){return t(a)},performUpload:function(b){var c=this.upload,d=b.data("formData"),e={files:b.data("fileNames")};if(!c.trigger(h,e)){c._fileAction(b,l),c._hideUploadButton(),e.data=a.extend({},e.data,F());for(var f in e.data)d.append(f,e.data[f]);c._fileState(b,"uploading"),this.postFormData(this.upload.options.async.saveUrl,d,b)}else this.removeFileEntry(b)},onSaveSelected:function(b){var c=this;a(".t-file",this.element).each(function(){var b=a(this),d=C(b);d||c.performUpload(b)})},onCancel:function(a){var b=E(a);this.stopUploadRequest(b),this.removeFileEntry(b)},onRetry:function(a){var b=E(a);this.performUpload(b)},onRemove:function(a){var b=E(a);b.children(".t-icon").is(".t-success")?y(b,this.upload):this.removeFileEntry(b)},postFormData:function(a,b,c){var d=new XMLHttpRequest,e=this;c.data("request",d),d.addEventListener("load",function(a){e.onRequestSuccess.call(e,a,c)},!1),d.addEventListener(j,function(a){e.onRequestError.call(e,a,c)},!1),d.upload.addEventListener("progress",function(a){e.onRequestProgress.call(e,a,c)},!1),d.open("POST",a),d.send(b)},createFormData:function(a){var b=new FormData;b.append(this.upload.name,a.rawFile);return b},onRequestSuccess:function(a,b){var c=a.target,d=this;z(c.responseText,function(a){b.trigger("t:upload-success",[a,c]),d.cleanupFileEntry(b)},function(){b.trigger("t:upload-error",[c])})},onRequestError:function(a,b){var c=a.target;b.trigger("t:upload-error",[c])},cleanupFileEntry:function(b){var c=b.data("relatedInput"),d=!0;c&&(a.each(c.data("relatedFileEntries"),function(){this.parent().length>0&&this[0]!=b[0]&&(d=d&&this.children(".t-icon").is(".t-success"))}),d&&c.remove()),b.data("formData",null)},removeFileEntry:function(a){this.cleanupFileEntry(a),this.upload._removeFileEntry(a)},onRequestProgress:function(a,b){var c=Math.round(a.loaded*100/a.total);b.trigger("t:progress",[c])},stopUploadRequest:function(a){a.data("request").abort()}},d.ui.plugin("Upload",o)})(jQuery,window)