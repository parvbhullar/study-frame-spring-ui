<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap>
	<typeAlias alias="receiveMailBean" type="com.ivyinfo.mail.bean.ReceiveMailBean" />
	<typeAlias alias="fileBean" type="com.ivyinfo.mail.bean.FileBean" />
	<typeAlias alias="setupmailBean" type="com.ivyinfo.mail.bean.SetupMailBean" />
	<!-- 查询邮件是否存在 -->
	<select id="findcount" parameterClass="java.util.Map" resultClass="String">
		<![CDATA[
			SELECT count(*) FROM $userlogname$
				WHERE mailId=$uid$ AND mailnumber=$msgno$
		]]>
	</select>
	
	<!-- 添加邮件附件 -->
	<insert id="savefile" parameterClass="fileBean">
		<![CDATA[
			INSERT INTO $logname$(id,mailid,filename,filepath)
			VALUES(#id#,#mailid#,#filename#,#filepath#)
		]]>
	</insert>
	
	<!-- 查找所有的图书 -->
	<select id="findAllFile" parameterClass="java.util.Map" resultClass="fileBean">
		<![CDATA[
			SELECT * FROM $userlogname$ 
				WHERE mailid=#mailid#
		]]>
	</select>
	
	<!-- 查找个人邮件设置 -->
	<select id="findMailSetup" parameterClass="map" resultClass="setupmailBean">
		<![CDATA[
			SELECT * FROM $logname$_t_mail_setup
		]]>
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="id">
				ID = #id#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="addname">
				addname = #addname#
			</isNotEmpty>
		</dynamic>
	</select>
	
	<!-- 添加个人邮件设置 -->
	<insert id="saveMailSetup" parameterClass="setupmailBean">
		<![CDATA[
			INSERT INTO $userlogname$_t_mail_setup(id,addname,logname,logpassword,defaultsendadd,
				receiveallmail,delmail,contentsavelocal,timestemp)
			VALUES(#id#,#addname#,#logname#,#logpassword#,#defaultsendadd#,
				#receiveallmail#,#delmail#,#contentsavelocal#,#timestemp#)
		]]>
	</insert>
	
	<!-- 修改个人邮件设置 -->
	<update id="updateMailSetup" parameterClass="setupmailBean">
		<![CDATA[
			UPDATE $userlogname$_t_mail_setup SET 
			addname=#addname#,logname=#logname#,logpassword=#logpassword#,defaultsendadd=#defaultsendadd#,receiveallmail=#receiveallmail#,
			delmail=#delmail#,contentsavelocal=#contentsavelocal#,timestemp=#timestemp#
			WHERE id=#id#
		]]>
	</update>
	
	<!-- 修改个人邮件账号密码设置 -->
	<update id="updateUserMailSetup" parameterClass="setupmailBean">
		<![CDATA[
			UPDATE $userlogname$_t_mail_setup SET 
			addname=#addname#,logname=#logname#,logpassword=#logpassword#,timestemp=#timestemp#
			WHERE id=#id#
		]]>
	</update>
	
	<!-- 删除个人设置信息 -->
	<delete id="DelMailSetup" parameterClass="map">
		<![CDATA[
			DELETE FROM $logname$_t_mail_setup
		]]>
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="id">
				ID = #id#
			</isNotEmpty>
		</dynamic>
	</delete>
	
	<statement id="FileTable" parameterClass="String">
        CREATE TABLE $logname$_t_mail_file (
		  id int(11) NOT NULL,
		  mailid varchar(50) default NULL,
		  filename varchar(1000) default NULL,
		  filepath varchar(1000) default NULL,
		  remark1               varchar(50),
		    remark2               varchar(50),
		    remark3               varchar(50),
		    remark4               varchar(50),
		    remark5               varchar(50),
		  PRIMARY KEY  (id)
		) ENGINE=MyISAM DEFAULT CHARSET=gbk;
	</statement> 
	
	<statement id="DropFileTable" parameterClass="String">
		DROP TABLE $logname$_t_mail_file;
	</statement>
	
	<statement id="MailSetupTable" parameterClass="String">
		CREATE TABLE $logname$_t_mail_setup (
		  id int(11) NOT NULL,
		  addname varchar(100) default NULL,
		  logname varchar(100) default NULL,
		  logpassword varchar(100) default NULL,
		  defaultsendadd varchar(10) default NULL,
		  receiveallmail varchar(10) default NULL,
		  delmail varchar(10) default NULL,
		  contentsavelocal varchar(10) default NULL,
		  timestemp varchar(20) default NULL,
		  remark1               varchar(50),
		    remark2               varchar(50),
		    remark3               varchar(50),
		    remark4               varchar(50),
		    remark5               varchar(50),
		  PRIMARY KEY  (id)
		) ENGINE=MyISAM DEFAULT CHARSET=gbk;
	</statement>
	
	<statement id="DropMailSetupTable" parameterClass="String">
		DROP TABLE $logname$_t_mail_setup;
	</statement> 
</sqlMap>