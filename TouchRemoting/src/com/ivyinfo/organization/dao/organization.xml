<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap>
	<typeAlias alias="organizationBean" type="com.ivyinfo.organization.bean.OrganizationBean" />
	<typeAlias alias="organizationValidationBean" type="com.ivyinfo.organization.bean.OrganizationValidationBean" />
	<!-- 查找所有的机构 -->
	<select id="findAllOrganization" parameterClass="map" resultClass="organizationBean">
		<![CDATA[
			SELECT *,b.id as contactid,b.remark as contactremark 
			FROM t_sys_organization a 
			LEFT JOIN t_sys_organization_contact b ON a.id = b.organizationid 
		]]>
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="id">
				a.ID = #id#
			</isNotEmpty>
			<isNotNull prepend="AND" property="conname">
				$conname$ $convalue$
			</isNotNull>
		</dynamic>
		<dynamic prepend="order by">
			<isNotNull property="order">
				$order$ $orderby$
			</isNotNull>
		</dynamic>
		<dynamic prepend="limit">
			<isNotNull property="from">
				#from#,#len#
			</isNotNull>
		</dynamic>
	</select>
	
	<!-- 新增机构 -->
	<insert id="saveOrganization" parameterClass="organizationBean">
		<![CDATA[
			INSERT INTO t_sys_organization(id,name,remark,upduserid,timestemp,dirtyflag,meetorgid,czze)
			VALUES(#id#,#name#,#remark#,#upduserid#,#timestemp#,#dirtyflag#,#meetorgid#,#czze#)
		]]>
	</insert>
	<!-- 新增机构 -->
	<insert id="saveOrganizationContact" parameterClass="organizationBean">
		<![CDATA[
			INSERT INTO t_sys_organization_contact(id,organizationid,email,officephone,faxnumber,nationality,province,city,detailedaddress,postcode,remark)
			VALUES(#contactid#,#organizationid#,#email#,#officephone#,#faxnumber#,#nationality#,#province#,#city#,#detailedaddress#,#postcode#,#contactremark#)
		]]>
	</insert>
	
	<!-- 查看机构详细信息 
	<select id="findOrganizationById" parameterClass="int" resultClass="organizationBean">
		<![CDATA[
			SELECT *,b.id as contactid,b.remark as contactremark 
			FROM t_sys_organization a 
			LEFT JOIN t_sys_organization_contact b ON a.id = b.organizationid 
			AND a.ID=#id#
		]]>
	</select>-->
	
	<!-- 修改机构信息 -->
	<update id="updateOrganization" parameterClass="organizationBean">
		<![CDATA[
			UPDATE t_sys_organization SET 
			name=#name#,remark=#remark#,upduserid=#upduserid#,timestemp=#timestemp#,dirtyflag=#dirtyflag# 
			WHERE id=#id#
		]]>
	</update>
	<!-- 修改机构信息 -->
	<update id="updateOrganizationContact" parameterClass="organizationBean">
		<![CDATA[
			UPDATE t_sys_organization_contact SET 
			email=#email#,officephone=#officephone#,faxnumber=#faxnumber#,nationality=#nationality#,province=#province#,city=#city#,detailedaddress=#detailedaddress#,postcode=#postcode#,remark=#contactremark# 
			WHERE organizationid=#id#
		]]>
	</update>
	
	<!-- 删除机构信息 -->
	<delete id="deleteOrganization" parameterClass="int">
		<![CDATA[
			DELETE FROM t_sys_organization WHERE ID=#id#
		]]>
	</delete>
	<!-- 删除机构信息 -->
	<delete id="deleteOrganizationContact" parameterClass="String">
		<![CDATA[
			DELETE FROM t_sys_organization_contact WHERE organizationid=#id#
		]]>
	</delete>
	
	<!-- 查找机构总记录数 -->
	<select id="organizationcount" resultClass="String">
		<![CDATA[
			SELECT count(*) 
			FROM t_sys_organization a 
			LEFT JOIN t_sys_organization_contact b ON a.id = b.organizationid 
		]]>
		<dynamic prepend="WHERE">
			<isNotNull prepend="AND" property="conname">
				$conname$ $convalue$
			</isNotNull>
		</dynamic>
	</select>
	
	<!-- 查找机构名称是否重复 -->
	<select id="orgname" parameterClass="map" resultClass="String">
		<![CDATA[
			SELECT count(*) 
			FROM t_sys_organization  
		]]>
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="orgname">
				NAME = #orgname#
			</isNotEmpty>
		</dynamic>
	</select>
	
	<!-- 查找验证信息机构名称是否重复 -->
	<select id="vorgname" parameterClass="map" resultClass="String">
		<![CDATA[
			SELECT count(*) 
			FROM t_sys_organization_validation  
		]]>
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="orgname">
				NAME = #orgname#
			</isNotEmpty>
		</dynamic>
	</select>
	
	<!-- 新增机构验证信息表 -->
	<insert id="saveOrganizationValidation" parameterClass="organizationValidationBean">
		<![CDATA[
			INSERT INTO t_sys_organization_validation(id,name,email,officephone,faxnumber,nationality,province,city,
				detailedaddress,postcode,registertime,validationcode,validationtime,logname,logpassword)
			VALUES(#id#,#name#,#email#,#officephone#,#faxnumber#,#nationality#,#province#,#city#,
				#detailedaddress#,#postcode#,#registertime#,#validationcode#,#validationtime#,#logname#,#logpassword#)
		]]>
	</insert>
	
	<!-- 修改机构验证信息表 -->
	<update id="updOrganizationValidation" parameterClass="organizationValidationBean">
		<![CDATA[
			UPDATE t_sys_organization_validation SET 
			validationcode=#validationcode#,validationtime=#validationtime# 
			WHERE id=#id#
		]]>
	</update>
	
	<!-- 删除机构验证信息表 -->
	<delete id="delOrganizationValidation" parameterClass="int">
		<![CDATA[
			DELETE FROM t_sys_organization_validation WHERE ID=#id#
		]]>
	</delete>
	
	<!-- 查找验证信息表 -->
	<select id="findAllOrgValidation" parameterClass="map" resultClass="OrganizationValidationBean">
		<![CDATA[
			SELECT * FROM t_sys_organization_validation
		]]>
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="id">
				ID = #id#
			</isNotEmpty>
		</dynamic>
	</select>
	
	<!-- 根据id和验证码查找验证信息表 -->
	<select id="findOrgValidation" parameterClass="map" resultClass="OrganizationValidationBean">
		<![CDATA[
			SELECT * FROM t_sys_organization_validation
		]]>
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="orgid">
				ID = #orgid#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="validationcode">
				validationcode = #validationcode#
			</isNotEmpty>
		</dynamic>
	</select>
	
	<!-- 修改机构冲值总额信息 -->
	<update id="UpdOrgCZZE" parameterClass="map">
		<![CDATA[
			UPDATE t_sys_organization SET 
			czze=#czze# 
			WHERE id=#id#
		]]>
	</update>
	
</sqlMap>